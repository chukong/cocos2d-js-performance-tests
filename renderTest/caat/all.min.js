var GS=window.GS||{};GS.Widget=GS.Widget||{},GS.Timer=GS.Timer||{},GS.Input=GS.Input||{},GS.Math=GS.Math||{},GS.WebGL=GS.WebGL||{},GS.WebGL.UNPACK_PREMULTIPLY_ALPHA_WEBGL=!1,GS.WebGL.MIPMAP=!1,GS.WebGL.ANTIALIAS=!1,GS.WebGL.CTX_ALPHA=!1,GS.Plugin=GS.Plugin||{},GS.Path=GS.Path||{},GS.Object=function(){return this._superclass=null,this},GS.Object.prototype={},GS.Object.prototype.constructor=GS.Object,GS.Object.extend=function(derivative,new_pr){var obj=Object.create(this.prototype);for(var pr in new_pr)new_pr.hasOwnProperty(pr)&&(obj[pr]=new_pr[pr]);derivative._superclass=this.prototype,derivative.extend=this.extend,derivative.prototype=obj,derivative.prototype.constructor=derivative},GS.FloatArray=function(size,defaultValue){var a,i;if(defaultValue=defaultValue||0,window.Float32Array){if(a=new Float32Array(size),defaultValue)for(i=0;size>i;i++)a[i]=defaultValue}else for(a=new Array(size),i=0;size>i;i++)a[i]=defaultValue;return a},GS.UInt16Array=function(size,defaultValue){var a,i;if(defaultValue=defaultValue||0,window.Uint16Array){if(a=new Uint16Array(size),defaultValue)for(i=0;size>i;i++)a[i]=defaultValue}else for(a=new Array(size),i=0;size>i;i++)a[i]=defaultValue;return a},function(){if("undefined"==typeof window.performance&&(window.performance={}),!window.performance.now){var nowOffset=Date.now();performance.timing&&performance.timing.navigationStart&&(nowOffset=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-nowOffset}}}(),GS.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},function(){"use strict";GS.Math.Matrix={_workingMatrix:GS.FloatArray(9,0),IDENTITY:[],notEquals:function(m0,m1){return m0[0]!==m1[0]||m0[1]!==m1[1]||m0[2]!==m1[2]||m0[3]!==m1[3]||m0[4]!==m1[4]||m0[5]!==m1[5]||m0[6]!==m1[6]||m0[7]!==m1[7]||m0[8]!==m1[8]},create:function(){var matrix=GS.FloatArray(9);return GS.Math.Matrix.identity(matrix),matrix},createTranslate:function(tx,ty,matrix){return matrix=matrix||this.create(),matrix[2]=tx,matrix[5]=ty,matrix},createRotate:function(angle,matrix){return matrix=matrix||this.create(),matrix[0]=Math.cos(angle),matrix[1]=-Math.sin(angle),matrix[3]=Math.sin(angle),matrix[4]=Math.cos(angle),matrix},createScale:function(sx,sy,matrix){return matrix=matrix||this.create(),matrix[0]=sx,matrix[4]=sy,matrix},identity:function(matrix){return matrix[0]=1,matrix[1]=0,matrix[2]=0,matrix[3]=0,matrix[4]=1,matrix[5]=0,matrix[6]=0,matrix[7]=0,matrix[8]=1,matrix},copy:function(src,dst){dst[0]=src[0],dst[1]=src[1],dst[2]=src[2],dst[3]=src[3],dst[4]=src[4],dst[5]=src[5],dst[6]=0,dst[7]=0,dst[8]=1},multiply:function(m0,m1){var mm0=m1[0],mm1=m1[1],mm2=m1[2],mm3=m1[3],mm4=m1[4],mm5=m1[5],tm0=m0[0],tm1=m0[1],tm2=m0[2];m0[0]=tm0*mm0+tm1*mm3,m0[1]=tm0*mm1+tm1*mm4,m0[2]=tm0*mm2+tm1*mm5+tm2;var tm3=m0[3],tm4=m0[4],tm5=m0[5];m0[3]=tm3*mm0+tm4*mm3,m0[4]=tm3*mm1+tm4*mm4,m0[5]=tm3*mm2+tm4*mm5+tm5},setTransform:function(matrix,m00,m01,m10,m11,m02,m12){return matrix[0]=m00,matrix[3]=m01,matrix[1]=m10,matrix[4]=m11,matrix[2]=m02,matrix[5]=m12,matrix[6]=0,matrix[7]=0,matrix[8]=1,matrix},transform:function(matrix,m00,m01,m10,m11,m02,m12){return GS.Math.Matrix.setTransform(this._workingMatrix,m00,m01,m10,m11,m02,m12),this.multiply(matrix,this._workingMatrix),matrix},inverse:function(inMatrix,outMatrix){var m00=inMatrix[0],m01=inMatrix[1],m02=inMatrix[2],m10=inMatrix[3],m11=inMatrix[4],m12=inMatrix[5],m20=inMatrix[6],m21=inMatrix[7],m22=inMatrix[8];outMatrix=outMatrix||this.identity(GS.FloatArray(9,0));var determinant=m00*(m11*m22-m21*m12)-m10*(m01*m22-m21*m02)+m20*(m01*m12-m11*m02);return 0===determinant?outMatrix:(determinant=1/determinant,outMatrix[0]=(m11*m22-m12*m21)*determinant,outMatrix[1]=(m02*m21-m01*m22)*determinant,outMatrix[3]=(m12*m20-m10*m22)*determinant,outMatrix[4]=(m00*m22-m02*m20)*determinant,outMatrix[6]=(m10*m21-m11*m20)*determinant,outMatrix[7]=(m01*m20-m00*m21)*determinant,outMatrix[2]=(m01*m12-m02*m11)*determinant,outMatrix[5]=(m02*m10-m00*m12)*determinant,outMatrix[8]=(m00*m11-m01*m10)*determinant,outMatrix)},transformRenderingContextSet:function(ctx,m){ctx.setTransform(m[0],m[3],m[1],m[4],m[2],m[5])},transformRenderingContext:function(ctx,m){ctx.transform(m[0],m[3],m[1],m[4],m[2],m[5])},transformPoint:function(point,tm){var x=point.x,y=point.y;return point.x=x*tm[0]+y*tm[1]+tm[2],point.y=x*tm[3]+y*tm[4]+tm[5],point}},GS.Math.Matrix.IDENTITY=GS.Math.Matrix.create()}(),function(){GS.Point=function(x,y){return this.x="undefined"==typeof x?0:x,this.y="undefined"==typeof y?0:y,this};var __GS_PointPrototype={set:function(x,y){return this.x=x,this.y=y,this},perpendicular:function(){var t=this.x;return this.x=-this.y,this.y=t,this},normalize:function(){var v=Math.sqrt(this.x*this.x+this.y*this.y);return v&&(this.x/=v,this.y/=v),this},invert:function(){return this.x=-this.x,this.y=-this.y,this},copy:function(p){return this.x=p.x,this.y=p.y,this},mult:function(v){return this.x*=v,this.y*=v,this},squareModule:function(){return this.x*this.x+this.y*this.y},module:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},dot:function(p){return this.x*p.x+this.y*p.y},sub:function(p){return this.x-=p.x,this.y-=p.y,this},add:function(p){return this.x+=p.x,this.y+=p.y,this},distance:function(p){var x=p.x-this.x,y=p.y-this.y;return Math.sqrt(x*x+y*y)},midPoint:function(p){return this.x=(p.x+this.x)/2,this.y=(p.y+this.y)/2,this},mix:function(p,f){return this.x=(p.x+this.x)*f,this.y=(p.y+this.y)*f,this},clone:function(){return new GS.Point(this.x,this.y)}};GS.Object.extend(GS.Point,__GS_PointPrototype),GS.Point.MidPoint=function(p0,p1){return new GS.Point((p1.x+p0.x)/2,(p1.y+p0.y)/2)},GS.Point.Sub=function(p1,p0){return new GS.Point(p1.x-p0.x,p1.y-p0.y)},GS.Point.Add=function(p0,p1){return new GS.Point(p0.x+p1.x,p0.y+p1.y)},GS.Point.Mult=function(p0,d){return new GS.Point(p0.x*d,p0.y*d)},GS.Point.Distance=function(p0,p1){var x=p1.x-p0.x,y=p1.y-p0.y;return Math.sqrt(x*x+y*y)}}(),function(){GS.Math.Rectangle=function(x,y,w,h){return this.x=0,this.y=0,this.x1=0,this.y1=0,this.width=-1,this.height=-1,4!==arguments.length?this.setEmpty():(this.setLocation(x,y),this.setDimension(w,h)),this},GS.Math.Rectangle.prototype={setEmpty:function(){return this.width=-1,this.height=-1,this.x=0,this.y=0,this.x1=0,this.y1=0,this},setLocation:function(x,y){return this.x=x,this.y=y,this.x1=this.x+this.width,this.y1=this.y+this.height,this},setDimension:function(w,h){return this.width=w,this.height=h,this.x1=this.x+this.width,this.y1=this.y+this.height,this},setBounds:function(x,y,w,h){return this.setLocation(x,y),this.setDimension(w,h),this},contains:function(px,py){return px>=this.x&&px<this.x1&&py>=this.y&&py<this.y1},isEmpty:function(){return-1===this.width&&-1===this.height},union:function(px,py){return this.isEmpty()?(this.x=px,this.x1=px,this.y=py,this.y1=py,this.width=0,void(this.height=0)):(this.x1=this.x+this.width,this.y1=this.y+this.height,py<this.y&&(this.y=py),px<this.x&&(this.x=px),py>this.y1&&(this.y1=py),px>this.x1&&(this.x1=px),this.width=this.x1-this.x,void(this.height=this.y1-this.y))},unionRectangle:function(rectangle){return this.union(rectangle.x,rectangle.y),this.union(rectangle.x1,rectangle.y),this.union(rectangle.x,rectangle.y1),this.union(rectangle.x1,rectangle.y1),this},intersectsWithRect:function(r){return r.isEmpty()||this.isEmpty()?!1:r.x1<=this.x?!1:r.x>=this.x1?!1:r.y1<=this.y?!1:r.y<this.y1},intersectsWithRectByCoords:function(x,y,w,h){if(-1===w||-1===h)return!1;var x1=x+w-1,y1=y+h-1;return x1<this.x?!1:x>this.x1?!1:y1<this.y?!1:y<=this.y1},intersect:function(i,r){return"undefined"==typeof r&&(r=new CAAT.Math.Rectangle),r.x=Math.max(this.x,i.x),r.y=Math.max(this.y,i.y),r.x1=Math.min(this.x1,i.x1),r.y1=Math.min(this.y1,i.y1),r.width=r.x1-r.x,r.height=r.y1-r.y,r}}}(),function(){function tilt(beta,gamma){for(var i=0;i<callbacks.length;i++)callbacks[i](0,beta,gamma)}function tiltAcceleration(acc,accg){for(var i=0;i<callbacksAcceleration.length;i++)callbacksAcceleration[i](acc,accg)}function deviceOrientation(event){tilt(event.alpha,event.beta,event.gamma)}function deviceMotion(event){tiltAcceleration(event.acceleration,event.accelerationIncludingGravity)}function resume(){window.DeviceMotionEvent&&window.addEventListener("devicemotion",deviceMotion,!0),window.DeviceOrientationEvent&&window.addEventListener("deviceorientation",deviceOrientation,!0)}function pause(){window.DeviceMotionEvent&&window.removeEventListener("devicemotion",deviceMotion),window.DeviceOrientationEvent&&window.removeEventListener("deviceorientation",deviceOrientation)}GS.Input.Accelerometer={enable:function(){resume()},disable:function(){pause()},onAxisData:function(callback){callbacks.push(callback)},onAccelerationData:function(callback){callbacksAcceleration.push(callback)}};var callbacks=[],callbacksAcceleration=[]}(),function(){!!navigator.webkitGetGamepads||!!navigator.webkitGamepads}();var GM=window.GM||{};GM.extend=function(subc,superc){var subcp=subc.prototype,f=function(){};f.prototype=superc.prototype,subc.prototype=new f,subc.superclass=superc.prototype,subc.prototype.constructor=subc,superc.prototype.constructor===Object.prototype.constructor&&(superc.prototype.constructor=superc);for(var method in subcp)subcp.hasOwnProperty(method)&&(subc.prototype[method]=subcp[method],superc.prototype[method]&&(subc.prototype[method]=function(fn,fnsuper){return function(){var prevMethod=this.__super;this.__super=fnsuper;var retValue=fn.apply(this,Array.prototype.slice.call(arguments));return this.__super=prevMethod,retValue}}(subc.prototype[method],superc.prototype[method])))},function(){function GestureTouchInfo(){return this.x=-1,this.y=-1,this.z=-1,this.endX=-1,this.endY=-1,this.endZ=-1,this.id=NO_TOUCH_ID,this.reset=function(){this.id=NO_TOUCH_ID},this.initialize=function(id,x,y){this.id=id,this.x=x,this.y=y,this.endX=x,this.endY=y},this.isReleased=function(){return this.id===NO_TOUCH_ID},this.isId=function(id){return this.id===id},this.getId=function(){return this.id},this.setEndPosition=function(x,y,z){this.endX=x,this.endY=y,this.endZ=z},this.dump=function(){console.log("   id:"+this.id)},this}var TIME_TO_HAVE_ALL_FINGERS_IN_GESTURE=150,NO_TOUCH_ID=-1;GM.GestureRecognizer=function(callback){return this.status=GM.GestureRecognizer.STATUS.ST_POSSIBLE,this.touchesInfo=[],this.callback=callback,this},GM.GestureRecognizer.STATUS={ST_POSSIBLE:0,ST_BEGAN:1,ST_MOVED:2,ST_ENDED:3,ST_CANCELED:4,ST_FAILED:5,ST_CHANGED:6},GM.GestureRecognizer.prototype={status:null,id:null,touchesInfo:null,currentTouchIdCount:-1,callback:null,startTime:-1,fingers:0,setId:function(id){this.id=id},getId:function(){return this.id},clearTouchId:function(id){var pos=this.getTouchIdPositionInCaptureArray(id);-1!==pos&&this.touchesInfo[pos].reset()},__setStatus:function(st){this.status=st},setCaptureTouchIdLen:function(n){this.fingers=n,this.touchesInfo=[];for(var i=0;n>i;i++)this.touchesInfo.push(new GestureTouchInfo);this.currentTouchIdCount=0},addTouchInfo:function(ti){this.touchesInfo[this.currentTouchIdCount].initialize(ti.identifier,ti.pageX,ti.pageY),this.currentTouchIdCount+=1},removeTouchInfoById:function(id){for(var i=0;i<this.touchesInfo.length;i++)if(this.touchesInfo[i].getId()===id){var touch=this.touchesInfo.splice(i,1)[0];return touch.reset(),this.touchesInfo.push(touch),void this.currentTouchIdCount--}},getCurrentTouchIdCount:function(){return this.currentTouchIdCount},resetTouchIds:function(){this.currentTouchIdCount=0;for(var i=0;i<this.touchesInfo.length;i++)this.touchesInfo[i].reset();this.log("reset touch ids")},allCapturedTouchIdsReleased:function(){for(var i=0;i<this.touchesInfo.length;i++)if(!this.touchesInfo[i].isReleased())return!1;return!0},getTouchIdPositionInCaptureArray:function(id){if(!this.touchesInfo)return-1;for(var i=0;i<this.touchesInfo.length;i++)if(this.touchesInfo[i].isId(id))return i;return-1},getTouchInfoById:function(id){if(!this.touchesInfo)return-1;for(var i=0;i<this.touchesInfo.length;i++)if(this.touchesInfo[i].isId(id))return this.touchesInfo[i];return null},getGestureElapsedTime:function(){return(new Date).getTime()-this.startTime},touchesBegan:function(e){if(-1===this.startTime&&(this.startTime=(new Date).getTime()),this.getCurrentTouchIdCount()<this.fingers&&this.getGestureElapsedTime()>TIME_TO_HAVE_ALL_FINGERS_IN_GESTURE)return this.log("too much time until i get all the fingers needed."),void this.failed();if(this.getCurrentTouchIdCount()+e.changedTouches.length>this.fingers)return this.log("too many fingers!!"),void this.failed();for(var i=0;i<e.changedTouches.length;i+=1)this.addTouchInfo(e.changedTouches[i]);this.getCurrentTouchIdCount()===this.fingers&&this.__setStatus(GM.GestureRecognizer.STATUS.ST_BEGAN)},touchesMoved:function(){this.__setStatus(GM.GestureRecognizer.STATUS.ST_MOVED)},touchesEnded:function(){this.__setStatus(GM.GestureRecognizer.STATUS.ST_ENDED)},touchesCanceled:function(){this.__setStatus(GM.GestureRecognizer.STATUS.ST_CANCELED),this.failed()},failed:function(){this.__setStatus(GM.GestureRecognizer.STATUS.ST_FAILED)},reset:function(){this.__setStatus(GM.GestureRecognizer.STATUS.ST_POSSIBLE),this.resetTouchIds(),this.startTime=-1},acceptsInput:function(){return!(this.status===GM.GestureRecognizer.STATUS.ST_FAILED||this.status===GM.GestureRecognizer.STATUS.ST_CANCELED||this.status===GM.GestureRecognizer.STATUS.ST_ENDED)},dumpTouchesInfo:function(){for(var i=0;i<this.touchesInfo.length;i+=1)this.touchesInfo[i].dump()},getStatus:function(){return this.status},log:function(){}}}(),function(){var TIME_TO_TAP_FROM_START_TO_END=150,MOVE_THRESHOLD_TO_CANCEL_GESTURE=20;GM.GR_Tap=function(fingers,callback){return GM.GR_Tap.superclass.constructor.call(this,callback),fingers=0|fingers,this.setCaptureTouchIdLen(fingers),this.setId("Tap "+fingers),this},GM.GR_Tap.prototype={fingers:1,touchesMoved:function(e){this.__super(e);for(var i=0;i<e.changedTouches.length;i+=1){var indexId=this.getTouchIdPositionInCaptureArray(e.changedTouches[i].identifier);if(-1!=indexId){var touchInfo=this.touchesInfo[indexId],offsetX=Math.abs(touchInfo.x-e.changedTouches[i].pageX),offsetY=Math.abs(touchInfo.y-e.changedTouches[i].pageY);if(offsetX>MOVE_THRESHOLD_TO_CANCEL_GESTURE||offsetY>MOVE_THRESHOLD_TO_CANCEL_GESTURE)return void this.failed()}}},touchesEnded:function(e){if(this.getCurrentTouchIdCount()!==this.fingers)return void this.failed();var elapsedTime=this.getGestureElapsedTime();if(elapsedTime>TIME_TO_TAP_FROM_START_TO_END)return void this.failed();for(var i=0;i<e.changedTouches.length;i+=1)this.clearTouchId(e.changedTouches[i].identifier);this.allCapturedTouchIdsReleased()&&(this.__super(e),this.callback&&this.callback(this.fingers))}},GM.extend(GM.GR_Tap,GM.GestureRecognizer)}(),function(){var TIME_TO_FIRE_CALLBACK=800;GM.GR_LongTap=function(fingers,callback){return GM.GR_LongTap.superclass.constructor.call(this,fingers,callback),this.setId("LongTap "+fingers),this},GM.GR_LongTap.prototype={timer:null,touchesBegan:function(e){this.__super(e),this.getStatus()===GM.GestureRecognizer.STATUS.ST_BEGAN&&(this.__cancelTimer(),this.timer=setTimeout(this.__fireEvent.bind(this),TIME_TO_FIRE_CALLBACK))},__fireEvent:function(){this.callback&&this.callback(this.fingers)},touchesEnded:function(){this.__cancelTimer()},failed:function(){this.__super(),this.__cancelTimer()},__cancelTimer:function(){this.timer&&(clearTimeout(this.timer),this.timer=0)}},GM.extend(GM.GR_LongTap,GM.GR_Tap)}(),function(){var DOUBLE_TAP_MAX_TIME=200,TIME_TO_TAP_FROM_START_TO_END=100;GM.GR_DoubleTap=function(fingers,callback){return GM.GR_DoubleTap.superclass.constructor.call(this,fingers,callback),this.setId("DoubleTap"),this},GM.GR_DoubleTap.prototype={prevTime:0,touchesEnded:function(e){if(this.getCurrentTouchIdCount()!==this.fingers)return this.prevTime=0,void this.failed();var elapsedTime=this.getGestureElapsedTime();if(elapsedTime>TIME_TO_TAP_FROM_START_TO_END)return this.prevTime=0,void this.failed();for(var i=0;i<e.changedTouches.length;i+=1)this.clearTouchId(e.changedTouches[i].identifier);if(this.allCapturedTouchIdsReleased()){var t=(new Date).getTime();t-this.prevTime<DOUBLE_TAP_MAX_TIME&&this.callback&&this.callback(this.fingers),this.prevTime=t}}},GM.extend(GM.GR_DoubleTap,GM.GR_Tap)}(),function(){var MIN_CONTOUR_RATIO_TO_PINCH5=.94;GM.GR_Pinch5=function(callback){return GM.GR_Pinch5.superclass.constructor.call(this,callback),this.setCaptureTouchIdLen(5),this.setId("Pinch5"),this},GM.GR_Pinch5.prototype={contour:0,started:!1,touchesBegan:function(e){this.__super(e),this.getStatus()===GM.GestureRecognizer.STATUS.ST_BEGAN&&(this.contour=this.__getContourLength())},__getContourLength:function(){for(var ti1,contour=0,ti0=this.touchesInfo[0],i=1;i<=this.touchesInfo.length;i+=1)ti1=this.touchesInfo[i%this.touchesInfo.length],contour+=Math.sqrt((ti1.endX-ti0.endX)*(ti1.endX-ti0.endX)+(ti1.endY-ti0.endY)*(ti1.endY-ti0.endY));return contour},touchesMoved:function(e){var i;if(this.acceptsInput()){if(this.getCurrentTouchIdCount()!==this.fingers)return void this.failed();for(i=0;i<e.changedTouches.length;i+=1){var touch=e.changedTouches[i],id=touch.identifier,touchInfo=this.getTouchInfoById(id);touchInfo&&touchInfo.setEndPosition(touch.pageX,touch.pageY,0)}var contour=this.__getContourLength(),ratio=contour/this.contour;this.started?this.__notify(ratio):contour/this.contour<MIN_CONTOUR_RATIO_TO_PINCH5&&(this.started=!0,this.__notify(ratio))}},__notify:function(ratio){this.callback&&this.callback(ratio)},touchesEnded:function(e){if(!this.started)return void this.failed();if(this.getCurrentTouchIdCount()!==this.fingers)return void this.failed();for(var i=0;i<e.changedTouches.length;i+=1)this.clearTouchId(e.changedTouches[i].identifier);this.allCapturedTouchIdsReleased()&&(this.__super(e),this.callback&&this.callback(0))},reset:function(){this.__super(),this.started=!1}},GM.extend(GM.GR_Pinch5,GM.GestureRecognizer)}(),function(){var DISTANCE_THRESHOLD_TO_BE_PINCHZOOM=20,TIME_TO_START_PINCH_ZOOM=700;GM.PinchZoomInfo=function(scale,rotation,x,y){return this.scale=scale,this.rotation=rotation,this.translate={x:x,y:y},this},GM.GR_PinchZoom=function(callback){return GM.GR_PinchZoom.superclass.constructor.call(this,callback),this.setCaptureTouchIdLen(2),this.setId("Pinch and Zoom"),this},GM.GR_PinchZoom.prototype={__gestureRotation:0,__gestureScale:0,__scale:1,__rotation:0,started:!1,touchesBegan:function(e){if(this.__super(e),this.getStatus()===GM.GestureRecognizer.STATUS.ST_BEGAN){var e0=this.touchesInfo[0],e1=this.touchesInfo[1];this.__scale=1,this.__rotation=0,this.__gestureScale=Math.sqrt((e1.y-e0.y)*(e1.y-e0.y)+(e1.x-e0.x)*(e1.x-e0.x)),this.__gestureRotation=Math.atan2(e1.y-e0.y,e1.x-e0.x)}},__isValidDistance:function(touchInfo){var y=touchInfo.endY-touchInfo.y,x=touchInfo.endX-touchInfo.x;return Math.sqrt(x*x+y*y)>DISTANCE_THRESHOLD_TO_BE_PINCHZOOM},touchesMoved:function(e){var i;if(this.acceptsInput()){if(this.getCurrentTouchIdCount()!==this.fingers)return void this.failed();for(i=0;i<e.changedTouches.length;i+=1){var touch=e.changedTouches[i],id=touch.identifier,touchInfo=this.getTouchInfoById(id);touchInfo&&touchInfo.setEndPosition(touch.pageX,touch.pageY,0)}if(!this.started){if(this.getGestureElapsedTime()>TIME_TO_START_PINCH_ZOOM)return void this.failed();for(i=0;i<this.touchesInfo.length;i++)if(!this.__isValidDistance(this.touchesInfo[i]))return;this.started=!0}this.__super(e);var e0=this.touchesInfo[0],e1=this.touchesInfo[1],gr=Math.atan2(e1.endY-e0.endY,e1.endX-e0.endX);this.__rotation+=gr-this.__gestureRotation,this.__gestureRotation=gr;var gs=Math.sqrt((e1.endY-e0.endY)*(e1.endY-e0.endY)+(e1.endX-e0.endX)*(e1.endX-e0.endX)),sc=this.__scale+gs/this.__gestureScale-1;.2>sc?this.__scale=.2:(this.__scale=sc,this.__gestureScale=gs);var tx=e0.endX-e0.x,ty=e0.endY-e0.y;this.callback&&this.callback(new GM.PinchZoomInfo(this.__scale,180*this.__rotation/Math.PI,tx,ty))}},touchesEnded:function(e){this.allCapturedTouchIdsReleased()?this.__super(e):this.failed()},reset:function(){this.__super(),this.started=!1}},GM.extend(GM.GR_PinchZoom,GM.GestureRecognizer)}(),function(){var ANGLE=Math.PI/12,DISTANCE_THRESHOLD_TO_BE_SWIPE=100,TIME_TO_CONSIDER_VALID_SWIPE=300;GM.GR_Swipe=function(fingers,callback){return GM.GR_Swipe.superclass.constructor.call(this,callback),fingers&&(this.fingers=0|fingers),this.setCaptureTouchIdLen(fingers),this.setId("Swipe "+fingers),this},GM.GR_Swipe.DIRECTION={LEFT:"left",RIGHT:"right",DOWN:"down",UP:"up",CANT_TELL:"can't tell"},GM.GR_Swipe.prototype={touchesEnded:function(e){var i;if(this.getCurrentTouchIdCount()!==this.fingers)return void this.failed();if(this.getGestureElapsedTime()>TIME_TO_CONSIDER_VALID_SWIPE)return void this.failed();for(i=0;i<e.changedTouches.length;i+=1){var touch=e.changedTouches[i],id=touch.identifier,touchInfo=this.getTouchInfoById(id);if(touchInfo&&(touchInfo.setEndPosition(touch.pageX,touch.pageY,0),!this.__isValidDistance(touchInfo)))return void this.failed();this.clearTouchId(id)}if(this.allCapturedTouchIdsReleased()){var swipe_dir=this.__getSwipeDirection(this.touchesInfo[0]);for(i=1;i<this.getCurrentTouchIdCount();i+=1)if(swipe_dir!==this.__getSwipeDirection(this.touchesInfo[i]))return void this.failed();this.__super(e),this.callback&&this.callback(this.fingers,swipe_dir)}},__isValidDistance:function(touchInfo){var y=touchInfo.endY-touchInfo.y,x=touchInfo.endX-touchInfo.x;return Math.sqrt(x*x+y*y)>DISTANCE_THRESHOLD_TO_BE_SWIPE},__getSwipeDirection:function(touchInfo){var yy=touchInfo.endY-touchInfo.y,angle=Math.abs(Math.atan2(yy,touchInfo.endX-touchInfo.x));return angle>=0&&ANGLE>angle?GM.GR_Swipe.DIRECTION.RIGHT:angle<Math.PI&&angle>Math.PI-ANGLE?GM.GR_Swipe.DIRECTION.LEFT:angle>=Math.PI/2-ANGLE&&angle<Math.PI/2+ANGLE?0>yy?GM.GR_Swipe.DIRECTION.UP:GM.GR_Swipe.DIRECTION.DOWN:GM.GR_Swipe.DIRECTION.CANT_TELL}},GM.extend(GM.GR_Swipe,GM.GestureRecognizer)}(),function(){GM.GestureManager=function(target){return this.gestureRecognizerList=[],this.touchIds=[],this.target=null,target&&this.__setTarget(target),this},GM.GestureManager.prototype={__findIdPos:function(id){for(var i=0;i<this.touchIds.length;i++)if(this.touchIds[i]===id)return i;return-1},setTarget:function(target){return this.__setTarget(target)},__setTarget:function(target){this.target&&(this.target.removeEventListener("touchstart"),this.target.removeEventListener("touchmove"),this.target.removeEventListener("touchend"),this.target.removeEventListener("touchcancel"),this.target.removeEventListener("MozTouchDown"),this.target.removeEventListener("MozTouchMove"),this.target.removeEventListener("MozTouchRelease"),this.target.removeEventListener("MozTouchCancel")),this.target=target,target.addEventListener("touchstart",this.__touchStartHandler.bind(this),!1),target.addEventListener("touchmove",this.__touchMoveHandler.bind(this),!1),target.addEventListener("touchend",this.__touchEndHandler.bind(this),!1),target.addEventListener("touchcancel",this.__touchCancelHandler.bind(this),!1),target.addEventListener("MozTouchDown",this.__touchStartHandler.bind(this),!1),target.addEventListener("MozTouchMove",this.__touchMoveHandler.bind(this),!1),target.addEventListener("MozTouchRelease",this.__touchEndHandler.bind(this),!1),target.addEventListener("MozTouchCancel",this.__touchCancelHandler.bind(this),!1)},__touchStartHandler:function(e){e.preventDefault();var i;for(i=0;i<e.changedTouches.length;i+=1){var id=e.changedTouches[i].identifier;-1===this.__findIdPos(id)&&this.touchIds.push(id)}for(i=0;i<this.gestureRecognizerList.length;i+=1)this.gestureRecognizerList[i].acceptsInput()&&this.gestureRecognizerList[i].touchesBegan(e)},__touchMoveHandler:function(e){e.preventDefault();for(var i=0;i<this.gestureRecognizerList.length;i+=1)this.gestureRecognizerList[i].acceptsInput()&&this.gestureRecognizerList[i].touchesMoved(e)},__touchEndHandler:function(e){var i;for(i=0;i<e.changedTouches.length;i+=1){var id=e.changedTouches[i].identifier,pos=this.__findIdPos(id);-1!==pos&&this.touchIds.splice(pos,1)}for(e.preventDefault(),i=0;i<this.gestureRecognizerList.length;i+=1)this.gestureRecognizerList[i].acceptsInput()&&this.gestureRecognizerList[i].touchesEnded(e);this.__shouldReset(e)},__touchCancelHandler:function(e){var i;for(i=0;i<e.changedTouches.length;i+=1){var id=e.changedTouches[i].identifier,pos=this.__findIdPos(id);-1!==pos&&this.touchIds.splice(pos,1)}for(e.preventDefault(),i=0;i<this.gestureRecognizerList.length;i+=1)this.gestureRecognizerList[i].acceptsInput()&&this.gestureRecognizerList[i].touchesCanceled(e);this.__shouldReset(e)},__shouldReset:function(){0===this.touchIds.length&&this.__resetGestureRecognizers()},addGestureRecognizer:function(gr){return this.gestureRecognizerList.push(gr),this},__resetGestureRecognizers:function(){for(var i=0;i<this.gestureRecognizerList.length;i+=1)this.gestureRecognizerList[i].reset()},onTap:function(callback){this.addGestureRecognizer(new GM.GR_Tap(1,callback))},onTap2:function(callback){this.addGestureRecognizer(new GM.GR_Tap(2,callback))},onTap3:function(callback){this.addGestureRecognizer(new GM.GR_Tap(3,callback))},onTap4:function(callback){this.addGestureRecognizer(new GM.GR_Tap(4,callback))},onTap5:function(callback){this.addGestureRecognizer(new GM.GR_Tap(5,callback))},onLongTap:function(callback){this.addGestureRecognizer(new GM.GR_LongTap(1,callback))},onLongTap2:function(callback){this.addGestureRecognizer(new GM.GR_LongTap(2,callback))},onLongTap3:function(callback){this.addGestureRecognizer(new GM.GR_LongTap(3,callback))},onLongTap4:function(callback){this.addGestureRecognizer(new GM.GR_LongTap(4,callback))},onLongTap5:function(callback){this.addGestureRecognizer(new GM.GR_LongTap(5,callback))},onDoubleTap:function(callback){this.addGestureRecognizer(new GM.GR_DoubleTap(1,callback))},onDoubleTap2:function(callback){this.addGestureRecognizer(new GM.GR_DoubleTap(2,callback))},onDoubleTap3:function(callback){this.addGestureRecognizer(new GM.GR_DoubleTap(3,callback))},onDoubleTap4:function(callback){this.addGestureRecognizer(new GM.GR_DoubleTap(4,callback))},onDoubleTap5:function(callback){this.addGestureRecognizer(new GM.GR_DoubleTap(5,callback))},onSwipe:function(callback){this.addGestureRecognizer(new GM.GR_Swipe(1,callback))},onSwipe2:function(callback){this.addGestureRecognizer(new GM.GR_Swipe(2,callback))},onSwipe3:function(callback){this.addGestureRecognizer(new GM.GR_Swipe(3,callback))},onSwipe4:function(callback){this.addGestureRecognizer(new GM.GR_Swipe(4,callback))},onSwipe5:function(callback){this.addGestureRecognizer(new GM.GR_Swipe(5,callback))},onPinchZoom:function(callback){this.addGestureRecognizer(new GM.GR_PinchZoom(callback))},onPinch5:function(callback){this.addGestureRecognizer(new GM.GR_Pinch5(callback))}}}(),function(){function createModifiers(){var obj={};return obj[GS.Input.Keyboard.KEYS.shift]=!1,obj[GS.Input.Keyboard.KEYS.ctrl]=!1,obj[GS.Input.Keyboard.KEYS.alt]=!1,obj[GS.Input.Keyboard.KEYS.command]=!1,obj}function setModifiers(key,down){return key===GS.Input.Keyboard.KEYS.shift?(Modifiers[GS.Input.Keyboard.KEYS.shift]=down,!0):key===GS.Input.Keyboard.KEYS.ctrl?(Modifiers[GS.Input.Keyboard.KEYS.ctrl]=down,!0):key===GS.Input.Keyboard.KEYS.alt?(Modifiers[GS.Input.Keyboard.KEYS.alt]=down,!0):key===GS.Input.Keyboard.KEYS.command||key===GS.Input.Keyboard.KEYS.rcommand?(Modifiers[GS.Input.Keyboard.KEYS.command]=down,!0):!1}function keyDownHandler(evt){var key=evt.which?evt.which:evt.keyCode;if(!setModifiers(key,!0))for(var t=(new Date).getTime(),i=0;i<keyActions.length;i++)keyActions[i].keyDown(key,t)}function keyUpHandler(evt){var key=evt.which?evt.which:evt.keyCode;if(!setModifiers(key,!1))for(var t=(new Date).getTime(),i=0;i<keyActions.length;i++)keyActions[i].keyUp(key,t)}function resume(){window.addEventListener("keydown",keyDownHandler,!1),window.addEventListener("keyup",keyUpHandler,!1)}function pause(){window.removeEventListener("keydown",keyDownHandler,!1),window.removeEventListener("keyup",keyUpHandler,!1)}var __keyAction=0,Key=function(groupKeys){return this._modifiers=createModifiers(),this._keyCode=0,this.__parseKeys(groupKeys),this};Key.prototype={__parseKeys:function(groupKeys){for(var j=0;j<groupKeys.length-1;j++){var keyCode=GS.Input.Keyboard.KEYS[groupKeys[j]];keyCode&&"undefined"!=typeof this._modifiers[keyCode]&&(keyCode===GS.Input.Keyboard.KEYS.rcommand&&(keyCode=GS.Input.Keyboard.KEYS.command),this._modifiers[keyCode]=!0)}this._keyCode=GS.Input.Keyboard.KEYS[groupKeys[groupKeys.length-1]]},match:function(key){for(var m in this._modifiers){if(!this._modifiers.hasOwnProperty(m)||!Modifiers.hasOwnProperty(m))return!1;if(this._modifiers[m]!==Modifiers[m])return!1}return this._keyCode===key}};var KeyAction=function(key,callback,action){return this._keys=[],this._id=__keyAction++,this._currentIdentifiedKeys=0,this._callback=callback,this._action=action,this._lastKeyTime=-1,this.identifyKeys(key.toLowerCase()),this};KeyAction.prototype={identifyKeys:function(key){for(var keyGroups=key.split(" "),i=0;i<keyGroups.length;i++){var groupKeys=keyGroups[i].split("+"),kkey=new Key(groupKeys);this._keys.push(kkey)}},keyDown:function(key,time){("down"===this._action||"sequence"===this._action)&&this.__checkKeys(key,time)},__checkKeys:function(key,time){-1!==this._lastKeyTime&&time-this._lastKeyTime>GS.Input.Keyboard.KEYBOARD_SEQUENCE_THRESHOLD&&(this._currentIdentifiedKeys=0),this._lastKeyTime=time;var keysToCheck=this._keys[this._currentIdentifiedKeys];return keysToCheck.match(key)?(this._currentIdentifiedKeys++,void(this._currentIdentifiedKeys===this._keys.length&&(this._callback(this._id),this._currentIdentifiedKeys=0))):void(this._currentIdentifiedKeys=0)},keyUp:function(key,time){"up"===this._action&&this.__checkKeys(key,time)}};var keyActions=[];GS.Input.Keyboard={KEYBOARD_SEQUENCE_THRESHOLD:1e3,onDown:function(key,callback){var ka=new KeyAction(key,callback,"down");return keyActions.push(ka),ka._id},onUp:function(key,callback){var ka=new KeyAction(key,callback,"up");return keyActions.push(ka),ka._id},removeAction:function(id){for(var i=0;i<keyActions.length;i++)if(keyActions[i]._id===id)return void keyActions.splice(i,1)},createCursorKeys:function(up,down,left,right){return new GS.Input.Keyboard.Cursor(up,down,left,right)},isShiftDown:function(){return Modifiers[GS.Input.Keyboard.KEYS.shift]},isCtrlDown:function(){return Modifiers[GS.Input.Keyboard.KEYS.ctrl]},isAltDown:function(){return Modifiers[GS.Input.Keyboard.KEYS.alt]},isMetaDown:function(){return Modifiers[GS.Input.Keyboard.KEYS.command]},disable:function(){pause()},enable:function(){resume()}},GS.Input.Keyboard.KEYS={enter:13,backspace:8,tab:9,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,command:91,meta:91,select:93,rcommand:93,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,multiply:106,add:107,subtract:109,decimalpoint:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,semicolon:186,equalsign:187,comma:188,dash:189,period:190,forwardslash:191,graveaccent:192,openbracket:219,backslash:220,closebracket:221,singlequote:222,commandright:224},GS.Input.Keyboard.Cursor=function(up,down,left,right){function updown(){_upPressed=!0,me.onUp&&me.onUp(_upPressed),me.onKeyChange&&me.onKeyChange("up",_upPressed)}function upup(){_upPressed=!1,me.onUp&&me.onUp(_upPressed),me.onKeyChange&&me.onKeyChange("up",_upPressed)}function downdown(){_downPressed=!0,me.onDown&&me.onDown(_downPressed),me.onKeyChange&&me.onKeyChange("down",_downPressed)}function downup(){_downPressed=!1,me.onDown&&me.onDown(_downPressed),me.onKeyChange&&me.onKeyChange("down",_downPressed)}function leftdown(){_leftPressed=!0,me.onLeft&&me.onLeft(_leftPressed),me.onKeyChange&&me.onKeyChange("left",_leftPressed)
}function leftup(){_leftPressed=!1,me.onLeft&&me.onLeft(_leftPressed),me.onKeyChange&&me.onKeyChange("left",_leftPressed)}function rightdown(){_rightPressed=!0,me.onRight&&me.onRight(_rightPressed),me.onKeyChange&&me.onKeyChange("right",_rightPressed)}function rightup(){_rightPressed=!1,me.onRight&&me.onRight(_rightPressed),me.onKeyChange&&me.onKeyChange("right",_rightPressed)}this.onUp=null,this.onDown=null,this.onLeft=null,this.onRight=null,this.onKeyChange=null;var i,_upPressed=!1,_downPressed=!1,_leftPressed=!1,_rightPressed=!1,me=this,ups=up.split(" ");for(i=0;i<ups.length;i++)GS.Input.Keyboard.onDown(ups[i],updown),GS.Input.Keyboard.onUp(ups[i],upup);var downs=down.split(" ");for(i=0;i<downs.length;i++)GS.Input.Keyboard.onDown(downs[i],downdown),GS.Input.Keyboard.onUp(downs[i],downup);var lefts=left.split(" ");for(i=0;i<lefts.length;i++)GS.Input.Keyboard.onDown(lefts[i],leftdown),GS.Input.Keyboard.onUp(lefts[i],leftup);var rights=right.split(" ");for(i=0;i<rights.length;i++)GS.Input.Keyboard.onDown(rights[i],rightdown),GS.Input.Keyboard.onUp(rights[i],rightup);return Object.defineProperty(this,"up",{get:function(){return _upPressed},set:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(this,"down",{get:function(){return _downPressed},set:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(this,"left",{get:function(){return _leftPressed},set:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(this,"right",{get:function(){return _rightPressed},set:function(){},enumerable:!0,configurable:!0}),this};var Modifiers=createModifiers();resume()}(),function(){function findActorAtPosition(x,y){if(_captureTree||Queues&&0!==Queues._length){var actor=Queues?Queues.findActorAtPosition(x,y):null;if(null===actor&&(actor=_captureTree.findActorAtPosition(x,y)),actor!==_currentActor)for(_currentCaptureActor=[],_currentActor=actor;null!==actor;)_currentCaptureActor.push(actor),actor=actor._parent}}function getParents(a){for(var parents=[];a;)parents.push(a),a=a._parent;return parents}function cancelEvent(e){e.preventDefault&&(e.preventDefault(),e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation())}function cumulateOffset(node,parent,prop){for(var style,left=prop+"Left",top=prop+"Top",x=0,y=0;"iOS"!==navigator.browser&&node&&node.style&&(node.currentStyle?style=node.currentStyle.position:(style=(node.ownerDocument.defaultView||node.ownerDocument.parentWindow).getComputedStyle(node,null),style=style?style.getPropertyValue("position"):null),!/^(fixed)$/.test(style));)x+=node[left],y+=node[top],node=node[parent];return{x:x,y:y,style:style}}function getOffset(node){var res=cumulateOffset(node,"offsetParent","offset");if("fixed"===res.style){var res2=cumulateOffset(node,node.parentNode?"parentNode":"parentElement","scroll");return{x:res.x+res2.x,y:res.y+res2.y}}return{x:res.x,y:res.y}}function getCanvasCoord(point,e){_screenPoint.x=e.clientX,_screenPoint.y=e.clientY;var posx=0,posy=0;if(navigator.isCocoonJS)posx=e.pageX,posy=e.pageY;else if("undefined"!=typeof e.offsetX||"undefined"!=typeof e.layerX||"undefined"!=typeof e.clientX){var bcr=_domNodeInputTracker.getBoundingClientRect();posx=e.clientX,posy=e.clientY,posx=(posx-bcr.left)*(_domNodeInputTracker.width/bcr.width),posy=(posy-bcr.top)*(_domNodeInputTracker.height/bcr.height)}else{e||(e=window.event),e.pageX||e.pageY?(posx=e.pageX,posy=e.pageY):(e.clientX||e.clientY)&&(posx=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,posy=e.clientY+document.body.scrollTop+document.documentElement.scrollTop);var offset=getOffset(this.canvas);posx-=offset.x,posy-=offset.y}_domNodePoint.set(posx,posy),point.set(posx,posy)}function eventMouseUp(e){cancelEvent(e),_isMouseDown=!1;var bubble=!1;if(getCanvasCoord(__p0,e),null!==_currentActor)for(var i=0;i<_currentCaptureActor.length;i++){var currentActor=_currentCaptureActor[i];if(currentActor._eventsEnabled&&(__p1.copy(__p0),currentActor.screenToModel(__p1),bubble=currentActor.onMouseUp&&currentActor.onMouseUp(GS.Input.MouseTouchManager.Event.__setup(__p1.x,__p1.y,e))||!1,currentActor.onMouseClick&&!_dragging&&currentActor.contains(__p1.x,__p1.y)&&currentActor.onMouseClick(GS.Input.MouseTouchManager.Event.__setup(__p1.x,__p1.y,e))),!bubble)break}_dragging=!1,_in_=!1}function eventMouseDown(e){if(cancelEvent(e),_dragging&&null!==_currentActor)return void eventMouseUp(e);getCanvasCoord(__p0,e),_isMouseDown=!0;var bubble=!1;if(findActorAtPosition(__p0.x,__p0.y),null!==_currentActor)for(var i=0;i<_currentCaptureActor.length;i++){var lactor=_currentCaptureActor[i];if(lactor._eventsEnabled&&(__p1.copy(__p0),lactor.screenToModel(__p1),bubble=lactor.onMouseDown&&lactor.onMouseDown(GS.Input.MouseTouchManager.Event.__setup(__p1.x,__p1.y,e))),!bubble)break}}function eventMouseMove(e){cancelEvent(e),getCanvasCoord(__p0,e);var i,lactor,bubble0=!1,bubble1=!1;if(_isMouseDown&&null!==_currentActor)for(i=0;i<_currentCaptureActor.length;i++){if(lactor=_currentCaptureActor[i],lactor._eventsEnabled){if(__p1.copy(__p0),lactor.screenToModel(__p1),!_dragging&&Math.abs(_prevScreenPoint.x-__p0.x)<DRAG_THRESHOLD_X&&Math.abs(_prevScreenPoint.y-__p0.y)<DRAG_THRESHOLD_Y)return;_dragging=!0,lactor.onMouseDrag&&lactor.onMouseDrag(GS.Input.MouseTouchManager.Event.__setup(__p1.x,__p1.y,e)),_prevScreenPoint.x=__p0.x,_prevScreenPoint.y=__p0.y;var contains=lactor.contains(__p1.x,__p1.y);_in_&&!contains&&(bubble0=lactor.onMouseExit&&lactor.onMouseExit(GS.Input.MouseTouchManager.Event.__setup(__p1.x,__p1.y,e)),_in_=!1),!_in_&&contains&&(bubble1=lactor.onMouseEnter&&lactor.onMouseEnter(GS.Input.MouseTouchManager.Event.__setup(__p1.x,__p1.y,e)),_in_=!0)}if(!bubble0&&!bubble1)break}else{var bubble=!1,prevCurrentActor=_currentActor;findActorAtPosition(__p0.x,__p0.y);var equal=!0;if(_currentActor!==prevCurrentActor){var prevCurrentActors=getParents(prevCurrentActor);if(0!==prevCurrentActors.length)for(i=0;i<prevCurrentActors.length&&(prevCurrentActors[i]._eventsEnabled&&(__p1.copy(__p0),prevCurrentActors[i].screenToModel(__p1),bubble=prevCurrentActors[i].onMouseExit&&prevCurrentActors[i].onMouseExit(GS.Input.MouseTouchManager.Event.__setup(__p1.x,__p1.y,e))),bubble);i++);equal=!1}if(bubble0=!1,bubble1=!1,null!==_currentActor)for(i=0;i<_currentCaptureActor.length&&(_currentCaptureActor[i]._eventsEnabled&&(__p1.copy(__p0),_currentCaptureActor[i].screenToModel(__p1),equal||(bubble0=_currentCaptureActor[i].onMouseEnter&&_currentCaptureActor[i].onMouseEnter(GS.Input.MouseTouchManager.Event.__setup(__p1.x,__p1.y,e))),bubble1=_currentCaptureActor[i].onMouseMove&&_currentCaptureActor[i].onMouseMove(GS.Input.MouseTouchManager.Event.__setup(__p1.x,__p1.y,e))),bubble0||bubble1);i++);_in_=!0,_prevScreenPoint.x=__p1.x,_prevScreenPoint.y=__p1.y}}function eventMouseOut(e){cancelEvent(e),getCanvasCoord(__p0,e);var bubble0=!1,bubble1=!1;if(null!==_currentActor){for(var i=0;i<_currentCaptureActor.length&&(_currentCaptureActor[i]._eventsEnabled&&(__p1.copy(__p0),_currentCaptureActor[i].screenToModel(__p1),bubble0=_currentCaptureActor[i].onMouseExit&&_currentCaptureActor[i].onMouseExit(GS.Input.MouseTouchManager.Event.__setup(__p1.x,__p1.y,e)),bubble1=_currentCaptureActor[i].onMouseOut&&_currentCaptureActor[i].onMouseOut(GS.Input.MouseTouchManager.Event.__setup(__p1.x,__p1.y,e))),bubble0||bubble1);i++);_dragging||(_currentCaptureActor=[],_currentActor=null)}else _isMouseDown=!1,_in_=!1}function eventMouseOver(e){if(!_dragging){cancelEvent(e),getCanvasCoord(__p0,e);var i,bubble0=!1,bubble1=!1,prevActor=_currentActor;if(__p1.copy(__p0),findActorAtPosition(__p1.x,__p1.y),prevActor!==_currentActor){var prevCaptureActors=getParents(prevActor);for(i=0;i<prevCaptureActors.length&&(prevCaptureActors[i]._eventsEnabled&&(__p1.copy(__p0),prevCaptureActors[i].screenToModel(__p1),bubble1=prevCaptureActors[i].onMouseExit&&prevCaptureActors[i].onMouseExit(GS.Input.MouseTouchManager.Event.__setup(__p1.x,__p1.y,e))),bubble0||bubble1);i++);}for(i=0;i<_currentCaptureActor.length&&(_currentCaptureActor[i]._eventsEnabled&&(__p1.copy(__p0),_currentCaptureActor[i].screenToModel(__p1),bubble0=_currentCaptureActor[i].onMouseOver&&_currentCaptureActor[i].onMouseOver(GS.Input.MouseTouchManager.Event.__setup(__p1.x,__p1.y,e)),bubble1=_currentCaptureActor[i].onMouseEnter&&_currentCaptureActor[i].onMouseEnter(GS.Input.MouseTouchManager.Event.__setup(__p1.x,__p1.y,e))),bubble0||bubble1);i++);}}function eventDblClick(e){cancelEvent(e),getCanvasCoord(__p0,e);var bubble=!1;if(null!==_currentActor)for(var i=0;i<_currentCaptureActor.length&&(_currentCaptureActor[i]._eventsEnabled&&(__p1.copy(__p0),bubble=_currentCaptureActor[i].onMouseDblClick&&_currentCaptureActor[i].onMouseDblClick(GS.Input.MouseTouchManager.Event.__setup(__p1.x,__p1.y,e))),bubble);i++);}function touchStartHandler(e){e.target===_domNodeInputTracker&&(cancelEvent(e),e=e.targetTouches[0],_touching=!0,eventMouseDown(e))}function touchEndHandler(e){_touching&&(cancelEvent(e),e=e.changedTouches[0],_touching=!1,eventMouseUp(e))}function touchMoveHandler(e){if(_touching){if(cancelEvent(e),_gesturing)return;for(var i=0;i<e.targetTouches.length;i++){var ee=e.targetTouches[i];eventMouseMove(ee)}}}function gestureStart(e){cancelEvent(e);var scale=e.scale,rotation=e.rotation;"undefined"!=typeof scale&&"undefined"!=typeof rotation&&(_gesturing=!0)}function gestureChange(e){cancelEvent(e);var scale=e.scale,rotation=e.rotation;"undefined"!=typeof scale&&"undefined"!=typeof rotation&&_currentActor&&_currentActor.onGestureChange(rotation*Math.PI/180,scale)}function gestureEnd(e){cancelEvent(e);var scale=e.scale,rotation=e.rotation;_gesturing=!1,_currentActor&&_currentActor.onGestureChange(rotation*Math.PI/180,scale)}function resumeMouse(){window.addEventListener("mouseup",eventMouseUp,!1),window.addEventListener("mousedown",eventMouseDown,!1),window.addEventListener("mouseover",eventMouseOver,!1),window.addEventListener("mouseout",eventMouseOut,!1),window.addEventListener("mousemove",eventMouseMove,!1),window.addEventListener("dblclick",eventDblClick,!1)}function resumeTouch(){_domNodeInputTracker.addEventListener("touchstart",touchStartHandler,!1),_domNodeInputTracker.addEventListener("touchmove",touchMoveHandler,!1),_domNodeInputTracker.addEventListener("touchend",touchEndHandler,!1),_domNodeInputTracker.addEventListener("gesturestart",gestureStart,!1),_domNodeInputTracker.addEventListener("gestureend",gestureEnd,!1),_domNodeInputTracker.addEventListener("gesturechange",gestureChange,!1)}function resume(){resumeMouse(),resumeTouch()}function pauseMouse(){window.removeEventListener("mouseup",eventMouseUp),window.removeEventListener("mousedown",eventMouseDown),window.removeEventListener("mouseover",eventMouseOver),window.removeEventListener("mouseout",eventMouseOut),window.removeEventListener("mousemove",eventMouseMove),window.removeEventListener("dblclick",eventDblClick)}function pauseTouch(){_domNodeInputTracker.removeEventListener("touchstart",touchStartHandler),_domNodeInputTracker.removeEventListener("touchmove",touchMoveHandler),_domNodeInputTracker.removeEventListener("touchend",touchEndHandler),_domNodeInputTracker.removeEventListener("gesturestart",gestureStart),_domNodeInputTracker.removeEventListener("gestureend",gestureEnd),_domNodeInputTracker.removeEventListener("gesturechange",gestureChange)}function pause(){pauseMouse(),pauseTouch()}var DRAG_THRESHOLD_X=10,DRAG_THRESHOLD_Y=10,__p0=new GS.Point,__p1=new GS.Point;GS.Input.MouseTouchManager={setDomNode:function(node){_domNodeInputTracker=node},isDown:function(){return _isMouseDown||_touching},setCaptureTree:function(ct){_captureTree=ct,Queues=ct.getInputPriorityQueues()},disable:function(){pause()},enable:function(){resume()},enableMouse:function(){resumeMouse()},enableTouch:function(){resumeTouch()},disableMouse:function(){pauseMouse()},disableTouch:function(){pauseTouch()},getScreenCoord:function(){return _screenPoint},getDomNodeCoord:function(){return _domNodePoint}},GS.Input.MouseTouchManager.Event={x:0,y:0,screenX:0,screenY:0,nodeX:0,nodeY:0,dragging:!1,shiftDown:!1,ctrlDown:!1,metaDown:!1,altDown:!1,__setup:function(x,y,e){return this.x=x,this.y=y,this.screenX=_screenPoint.x,this.screenY=_screenPoint.y,this.nodeX=_domNodePoint.x,this.nodeY=_domNodePoint.y,this.shiftDown=e.shiftKey,this.altDown=e.altKey,this.ctrlDown=e.ctrlKey,this.metaDown=e.altKey,this.dragging=_dragging,this}};var Queues=null,_screenPoint=new GS.Point,_domNodePoint=new GS.Point,_domNodeInputTracker=window,_prevScreenPoint=new GS.Point,_captureTree=null,_currentActor=null,_currentCaptureActor=[],_isMouseDown=!1,_in_=!1,_dragging=!1,_touching=!1,_gesturing=!1}(),function(){GS.Input.TouchManager={enable:function(){},disable:function(){}}}(),function(){GS.InputManager=function(game){return this._accelerometer=GS.Input.Accelerometer,this._gestures=new GM.GestureManager(game._renderer._surface),this._keyboard=GS.Input.Keyboard,this._mousetouch=GS.Input.MouseTouchManager,this._mousetouch.setDomNode(game._renderer._surface),this._gamepad=null,this._multitouch=null,this},GS.InputManager.prototype={enableDefaults:function(){return this._accelerometer.disable(),this._keyboard.disable(),this._mousetouch.enable(),this},filterInput:function(scene){this._mousetouch.setCaptureTree(scene)},enableKeyboard:function(){this._keyboard.enable()},disableKeyboard:function(){this._keyboard.disable()}}}(),function(){var CONCAVE=(GS.FloatArray(1024),1),CONVEX=-1;GS.EarCut=function(){return this.mConcaveVertexCount=0,this};var __GS_EarCutPrototype={computeTriangles:function(pVertices){var triangles=[],vertices=[];if(vertices=vertices.concat(pVertices),vertices[0].x!==vertices[vertices.length-1].x&&vertices[0].y!==vertices[vertices.length-1].y&&vertices.push(vertices[0].clone()),pVertices.length<3)return triangles;if(3===vertices.length)return triangles=triangles.concat(vertices);for(;vertices.length>=3;){for(var vertexTypes=this.classifyVertices(vertices),foundEarTip=!1,index=0,vertexCount=vertices.length;index!=vertexCount;index++)if(this.isEarTip(vertices,index,vertexTypes)){this.cutEarTip(vertices,index,triangles),foundEarTip=!0;break}if(!foundEarTip)break}return triangles},areVerticesClockwise:function(pVertices){for(var area=0,i=0,vertexCount=pVertices.length;i!=vertexCount;i++){var p1=pVertices[i],p2=pVertices[this.computeNextIndex(pVertices,i)];area+=p1.x*p2.y-p2.x*p1.y}return 0>area},classifyVertices:function(pVertices){for(var vertexCount=pVertices.length,vertexTypes=[],i=0;vertexCount>i;i++)vertexTypes.push(0);this.mConcaveVertexCount=0,this.areVerticesClockwise(pVertices)||pVertices.reverse();for(var index=0;index!=vertexCount;index++){var previousIndex=this.computePreviousIndex(pVertices,index),nextIndex=this.computeNextIndex(pVertices,index),previousVertex=pVertices[previousIndex],currentVertex=pVertices[index],nextVertex=pVertices[nextIndex];this.isTriangleConvex(previousVertex.x,previousVertex.y,currentVertex.x,currentVertex.y,nextVertex.x,nextVertex.y)?vertexTypes[index]=CONVEX:(vertexTypes[index]=CONCAVE,this.mConcaveVertexCount++)}return vertexTypes},isTriangleConvex:function(pX1,pY1,pX2,pY2,pX3,pY3){return this.computeSpannedAreaSign(pX1,pY1,pX2,pY2,pX3,pY3)>=0},computeSpannedAreaSign:function(pX1,pY1,pX2,pY2,pX3,pY3){var area=0;return area+=pX1*(pY3-pY2),area+=pX2*(pY1-pY3),area+=pX3*(pY2-pY1),area>0?1:0>area?-1:0},isAnyVertexInTriangle:function(pVertices,pVertexTypes,pX1,pY1,pX2,pY2,pX3,pY3){for(var i=0,vertexCount=pVertices.length;vertexCount-1>i;){if(pVertexTypes[i]===CONCAVE){var currentVertex=pVertices[i],currentVertexX=currentVertex.x,currentVertexY=currentVertex.y,areaSign1=this.computeSpannedAreaSign(pX1,pY1,pX2,pY2,currentVertexX,currentVertexY),areaSign2=this.computeSpannedAreaSign(pX2,pY2,pX3,pY3,currentVertexX,currentVertexY),areaSign3=this.computeSpannedAreaSign(pX3,pY3,pX1,pY1,currentVertexX,currentVertexY);if(areaSign1>0&&areaSign2>0&&areaSign3>0)return!0;if(0>=areaSign1&&0>=areaSign2&&0>=areaSign3)return!0}i++}return!1},isEarTip:function(pVertices,pEarTipIndex,pVertexTypes){if(0!==this.mConcaveVertexCount){var previousVertex=pVertices[this.computePreviousIndex(pVertices,pEarTipIndex)],currentVertex=pVertices[pEarTipIndex],nextVertex=pVertices[this.computeNextIndex(pVertices,pEarTipIndex)];return!this.isAnyVertexInTriangle(pVertices,pVertexTypes,previousVertex.x,previousVertex.y,currentVertex.x,currentVertex.y,nextVertex.x,nextVertex.y)}return!0},cutEarTip:function(pVertices,pEarTipIndex,pTriangles){var previousIndex=this.computePreviousIndex(pVertices,pEarTipIndex),nextIndex=this.computeNextIndex(pVertices,pEarTipIndex);this.isCollinear4(pVertices,previousIndex,pEarTipIndex,nextIndex)||(pTriangles.push((new GS.Point).copy(pVertices[previousIndex])),pTriangles.push((new GS.Point).copy(pVertices[pEarTipIndex])),pTriangles.push((new GS.Point).copy(pVertices[nextIndex]))),pVertices.splice(pEarTipIndex,1),pVertices.length>=3&&this.removeCollinearNeighborEarsAfterRemovingEarTip(pVertices,pEarTipIndex)},removeCollinearNeighborEarsAfterRemovingEarTip:function(pVertices,pEarTipCutIndex){var collinearityCheckNextIndex=pEarTipCutIndex%pVertices.length,collinearCheckPreviousIndex=this.computePreviousIndex(pVertices,collinearityCheckNextIndex);this.isCollinear(pVertices,collinearityCheckNextIndex)?(pVertices.splice(collinearityCheckNextIndex,1),pVertices.length>3&&(collinearCheckPreviousIndex=this.computePreviousIndex(pVertices,collinearityCheckNextIndex),this.isCollinear(pVertices,collinearCheckPreviousIndex)&&pVertices.splice(collinearCheckPreviousIndex,1))):this.isCollinear(pVertices,collinearCheckPreviousIndex)&&pVertices.splice(collinearCheckPreviousIndex,1)},isCollinear:function(pVertices,pIndex){var previousIndex=this.computePreviousIndex(pVertices,pIndex),nextIndex=this.computeNextIndex(pVertices,pIndex);return this.isCollinear4(pVertices,previousIndex,pIndex,nextIndex)},isCollinear4:function(pVertices,pPreviousIndex,pIndex,pNextIndex){var previousVertex=pVertices[pPreviousIndex],vertex=pVertices[pIndex],nextVertex=pVertices[pNextIndex];return 0===this.computeSpannedAreaSign(previousVertex.x,previousVertex.y,vertex.x,vertex.y,nextVertex.x,nextVertex.y)},computePreviousIndex:function(pVertices,pIndex){return 0===pIndex?pVertices.length-1:pIndex-1},computeNextIndex:function(pVertices,pIndex){return pIndex===pVertices.length-1?0:pIndex+1}};GS.Object.extend(GS.EarCut,__GS_EarCutPrototype)}(),function(){var EPSILON=1e-4;GS.PathTriangulator={computeTriangles:function(points,lineSize,join,cap,miterLimit){var i,anchors=[],mids=[];if(!(points.length<2)){if(2===points.length)join="bevel",this.createAnchor(points[0],GS.Point.MidPoint(points[0],points[1]),points[1],lineSize/2,anchors,join,cap);else{for(i=0;i<points.length-1;i++)mids.push(0===i?points[0]:i===points.length-2?points[points.length-1]:GS.Point.MidPoint(points[i],points[i+1]));for(i=1;i<mids.length;i++)this.createAnchor(mids[i-1],points[i],mids[i],lineSize/2,anchors,join,cap,miterLimit)}var p00,p01;if("round"===cap){p00=anchors[0],p01=anchors[1];var p02=points[1],p10=anchors[anchors.length-1],p11=anchors[anchors.length-3],p12=points[points.length-2];this.createRoundCap(points[0],p00,p01,p02,anchors),this.createRoundCap(points[points.length-1],p10,p11,p12,anchors)}else"square"===cap&&(p00=anchors[anchors.length-1],p01=anchors[anchors.length-3],this.createSquareCap(points[0],anchors[0],anchors[1],anchors),this.createSquareCap(points[points.length-1],p00,p01,anchors));return anchors}},createSquareCap:function(center,p0,p1,verts){var dir=GS.Point.Sub(p0,center);dir.perpendicular(),verts.push(p0),verts.push(GS.Point.Add(p0,dir)),verts.push(GS.Point.Add(p1,dir)),verts.push(p1),verts.push(GS.Point.Add(p1,dir)),verts.push(p0)},createRoundCap:function(center,_p0,_p1,nextPointInLine,verts){var radius=GS.Point.Sub(center,_p0).module(),angle0=Math.atan2(_p1.y-center.y,_p1.x-center.x),angle1=Math.atan2(_p0.y-center.y,_p0.x-center.x),angleDiff=Math.atan2(Math.sin(angle1-angle0),Math.cos(angle1-angle0));if(Math.abs(angleDiff)>=Math.PI-EPSILON&&Math.abs(angleDiff)<=Math.PI+EPSILON){var r1=GS.Point.Sub(center,nextPointInLine);angleDiff*=r1.x>0?1:-1}var nsegments=Math.abs(angleDiff*radius)/7>>0;nsegments++;for(var angleInc=angleDiff/nsegments,i=0;nsegments>i;i++)verts.push(new GS.Point(center.x,center.y)),verts.push(new GS.Point(center.x+radius*Math.cos(angle0+angleInc*i),center.y+radius*Math.sin(angle0+angleInc*i))),verts.push(new GS.Point(center.x+radius*Math.cos(+angle0+angleInc*(1+i)),center.y+radius*Math.sin(+angle0+angleInc*(1+i))))},signedArea:function(P1,P2,P3){return(P2.x-P1.x)*(P3.y-P1.y)-(P3.x-P1.x)*(P2.y-P1.y)},lineIntersection:function(p0,p1,p2,p3){var a0=p1.y-p0.y,b0=p0.x-p1.x,c0=a0*p0.x+b0*p0.y,a1=p3.y-p2.y,b1=p2.x-p3.x,c1=a1*p2.x+b1*p2.y,det=a0*b1-a1*b0;if(det>-EPSILON&&EPSILON>det)return null;var x=(b1*c0-b0*c1)/det,y=(a0*c1-a1*c0)/det;return new GS.Point(x,y)},createAnchor:function(p0,p1,p2,weight,verts,join,cap,miterLimit){var t0=GS.Point.Sub(p1,p0),t2=GS.Point.Sub(p2,p1);t0.perpendicular(),t2.perpendicular(),this.signedArea(p0,p1,p2)>0&&(t0.invert(),t2.invert()),t0.normalize(),t2.normalize(),t0.mult(weight),t2.mult(weight);var pintersect=this.lineIntersection(GS.Point.Add(t0,p0),GS.Point.Add(t0,p1),GS.Point.Add(t2,p2),GS.Point.Add(t2,p1));if(null===pintersect)return verts.push(GS.Point.Add(p0,t0)),verts.push(GS.Point.Sub(p0,t0)),verts.push(GS.Point.Add(p2,t0)),verts.push(GS.Point.Sub(p0,t0)),verts.push(GS.Point.Add(p2,t0)),void verts.push(GS.Point.Sub(p2,t0));var anchor=GS.Point.Sub(pintersect,p1),dd=anchor.module()/weight;if(dd>miterLimit)verts.push(GS.Point.Add(p0,t0)),verts.push(GS.Point.Sub(p0,t0)),verts.push(GS.Point.Add(p1,t0)),verts.push(GS.Point.Sub(p0,t0)),verts.push(GS.Point.Add(p1,t0)),verts.push(GS.Point.Add(p1,t2)),verts.push(GS.Point.Add(p2,t2)),verts.push(GS.Point.Sub(p2,t2)),verts.push(GS.Point.Add(p1,t2)),verts.push(GS.Point.Sub(p2,t2)),verts.push(GS.Point.Add(p1,t2)),verts.push(GS.Point.Add(p1,t0));else{if(verts.push(GS.Point.Add(p0,t0)),verts.push(GS.Point.Sub(p0,t0)),verts.push(GS.Point.Sub(p1,anchor)),verts.push(GS.Point.Add(p0,t0)),verts.push(GS.Point.Sub(p1,anchor)),verts.push(GS.Point.Add(p1,t0)),"round"===join){var _p0=GS.Point.Add(p1,t0),_p1=GS.Point.Add(p1,t2),_p2=GS.Point.Sub(p1,anchor),center=p1;this.createRoundCap(center,_p0,_p1,_p2,verts),verts.push(_p0),verts.push(center),verts.push(_p2),verts.push(center),verts.push(_p1),verts.push(_p2)}else verts.push(GS.Point.Add(p1,t0)),verts.push(GS.Point.Add(p1,t2)),verts.push(GS.Point.Sub(p1,anchor)),"miter"===join&&(verts.push(pintersect),verts.push(GS.Point.Add(p1,t0)),verts.push(GS.Point.Add(p1,t2)));verts.push(GS.Point.Add(p2,t2)),verts.push(GS.Point.Sub(p1,anchor)),verts.push(GS.Point.Add(p1,t2)),verts.push(GS.Point.Add(p2,t2)),verts.push(GS.Point.Sub(p1,anchor)),verts.push(GS.Point.Sub(p2,t2))}}}}(),function(){"use strict";GS.WebGLUtils={nextPowerOf2:function(val){return val--,val=val>>1|val,val=val>>2|val,val=val>>4|val,val=val>>8|val,val=val>>16|val,val++,val},makeOrtho:function(left,right,bottom,top,znear,zfar){var tx=-(right+left)/(right-left),ty=-(top+bottom)/(top-bottom),tz=-(zfar+znear)/(zfar-znear);return new Float32Array([2/(right-left),0,0,0,0,2/(top-bottom),0,0,0,0,-2/(zfar-znear),0,tx,ty,tz,1])}}}(),function(){var TimerTaskStatus={NOT_SOLVED:-1,NOT_STARTED:0,STARTED:1,ENDED:2,CANCELED:3};GS.Timer.TimerTask=function(start,duration){return this._id=-1,this._onTimeout=null,this._onRepeat=null,this._onCancel=null,this._startTime="undefined"==typeof start?0:start,this._duration="undefined"==typeof duration?0:duration,this._shotCount=1,this._currentShot=-1,this._status=TimerTaskStatus.NOT_SOLVED,this._discard=!0,this},GS.Timer.TimerTask.prototype={tick:function(time){if(this._status===TimerTaskStatus.NOT_SOLVED&&(this._startTime+=time,this._status=TimerTaskStatus.NOT_STARTED),this._status!==TimerTaskStatus.CANCELED&&this._status!==TimerTaskStatus.ENDED&&!(time<this._startTime))if(time<this._startTime+this._duration*this._shotCount){this._status=TimerTaskStatus.STARTED;var currentShot=(time-this._startTime)/this._duration>>0;currentShot>0&&currentShot!==this._currentShot&&(this._onRepeat&&this._onRepeat(this,time,currentShot),this._currentShot=currentShot)}else this._status=TimerTaskStatus.TIMEOUT,this._shotCount>1&&this._onRepeat&&this._onRepeat(this,time,this._shotCount),this._onTimeout&&this._onTimeout(this,time)},cancel:function(){this._status===TimerTaskStatus.STARTED&&(this._status=TimerTaskStatus.CANCELED,this._onCancel&&this._onCancel(this))},isCanceled:function(){return this._status===TimerTaskStatus.CANCELED},isStarted:function(){return this._status===TimerTaskStatus.STARTED},isEnded:function(){return this._status===TimerTaskStatus.TIMEOUT||this._status===TimerTaskStatus.CANCELED},onRepeat:function(f){return this._onRepeat=f,this},onCancel:function(f){return this._onCancel=f,this},onTimeout:function(f){return this._onTimeout=f,this},setStartTime:function(t){return this.isStarted()&&this.cancel(),this._startTime=t,this._status=TimerTaskStatus.NOT_STARTED,this},isDiscardable:function(){return this._discard},setDiscardable:function(b){return this._discard=b,this},setRepeatTimes:function(times){return this._shotCount=times,this},getRepeatedTimes:function(){return this._currentShot}}}(),function(){var __taskId=0;GS.Timer.TimerManager=function(){return this._tasks=[],this},GS.Timer.TimerManager.prototype={createTask:function(start,duration){var tt=new GS.Timer.TimerTask(start,duration);return tt._id=__taskId++,this._tasks.push(tt),tt},cancelTask:function(id){for(var i=0;i<this._tasks.length;i++)if(this._tasks[i]._id===id)return this._tasks[i].cancel(),!0;return!1},__recycleTasks:function(){for(var arr=[],i=0;i<this._tasks.length;i++)this._tasks[i].isEnded()&&this._tasks[i].isDiscardable()||arr.push(this._tasks[i]);this._tasks=arr},tick:function(time){if(this._tasks.length){for(var i=0;i<this._tasks.length;i++)this._tasks[i].tick(time);this.__recycleTasks()}},getTasksQueueSize:function(){return this._tasks.length},cancelAll:function(){for(var i=0;i<this._tasks.length;i++)this._tasks[i].cancel();this._tasks=[]}}}(),function(){"use strict";GS.Path.Segment=function(){return this._length=0,this};var __GS_Path_SegmentPrototype={getFirstPoint:function(){},getLastPoint:function(){},getLength:function(){return this._length},getPosition:function(){return new GS.Point},getContourPoints:function(){},clone:function(){return null},paint:function(){},__calculateLength:function(){return 0}};GS.Object.extend(GS.Path.Segment,__GS_Path_SegmentPrototype)}(),function(){"use strict";var newPosition=new GS.Point(0,0);GS.Path.SegmentLinear=function(sp,ep){return GS.Path.SegmentLinear._superclass.constructor.call(this),this._firstPoint=sp||new GS.Point(0,0),this._lastPoint=ep||new GS.Point(0,0),this};var __GS_Path_SegmentLinearPrototype={clone:function(){return new GS.Path.SegmentLinear(this._firstPoint.clone(),this._lastPoint.clone())},__calculateLength:function(){return this._length=GS.Point.Sub(this._lastPoint,this._firstPoint).module(),this._length},getFirstPoint:function(){return this._firstPoint},getLastPoint:function(){return this._lastPoint},getPosition:function(at){return(at>1||0>at)&&(at%=1),0>at&&(at=1+at),newPosition.set(this._firstPoint.x+(this._lastPoint.x-this._firstPoint.x)*at,this._firstPoint.y+(this._lastPoint.y-this._firstPoint.y)*at),newPosition},getContourPoints:function(points){points.push(this.getLastPoint())},paint:function(ctx){ctx.lineTo(this._lastPoint.x,this._lastPoint.y)}};GS.Path.Segment.extend(GS.Path.SegmentLinear,__GS_Path_SegmentLinearPrototype)}(),function(){"use strict";{var __p0=new GS.Point;new GS.Point}GS.Path.SegmentOval=function(x,y,r,startAngle,endAngle,cc){return GS.Path.SegmentOval._superclass.constructor.call(this),this._contour=[],this._startAngle=startAngle,this._endAngle=endAngle,this._x=x,this._y=y,this._radius=r,this._cc=cc,this.__buildOval(x,y,r,startAngle,endAngle,cc),this};var __GS_Path_SegmentOvalPrototype={clone:function(){return new GS.Path.SegmentOval(this._x,this._y,this._radius,this._startAngle,this._endAngle,this._cc)},__calculateLength:function(){return this._length=(this._endAngle-this._startAngle)*this._radius,this._length},__buildOval:function(x,y,r,startAngle,endAngle,cc){startAngle%=2*Math.PI,endAngle%=2*Math.PI,!cc&&startAngle>=endAngle?endAngle+=2*Math.PI:cc&&endAngle>=startAngle&&(startAngle+=2*Math.PI);var arcLength=0;arcLength=Math.abs(endAngle-startAngle)*r;var nsegments=Math.max(16,arcLength/25>>0),radians=(endAngle-startAngle)/nsegments;__p0.set(Math.cos(startAngle)*r+x,Math.sin(startAngle)*r+y),this._contour.push(new GS.Point(__p0.x,__p0.y));for(var i=1,l=nsegments;l>=i;i++)__p0.set(Math.cos(startAngle+radians*i)*r+x,Math.sin(startAngle+radians*i)*r+y),this._contour.push(new GS.Point(__p0.x,__p0.y));Math.abs(endAngle-startAngle)>=2*Math.PI-1e6&&(this._closed=!0)},getFirstPoint:function(){return this._contour[0]},getLastPoint:function(){return this._contour[this._contour.length-1]},getPosition:function(time){if((time>1||0>time)&&(time%=1),0>time&&(time=1+time),-1===this._length)__p0.set(this._x,this._y);else{var angle=this._endAngle*time*(this._cc?-1:1)+this._startAngle;__p0.set(this._x+this._radius*Math.cos(angle),this._y+this._radius*Math.sin(angle))}return __p0},getContourPoints:function(points){for(var i=1;i<this._contour.length;i++)points.push(this._contour[i])},paint:function(ctx){ctx.arc(this._x,this._y,this._radius,this._startAngle,this._endAngle,this._cc)}};GS.Path.Segment.extend(GS.Path.SegmentOval,__GS_Path_SegmentOvalPrototype)}(),function(){"use strict";var newPosition=new GS.Point(0,0);GS.Path.SegmentBezier=function(p0,p1,p2,p3){return GS.Path.SegmentBezier._superclass.constructor.call(this),this._p0=p0||new GS.Point(0,0),this._p1=p1||new GS.Point(0,0),this._p2=p2||new GS.Point(0,0),this._p3=p3||new GS.Point(0,0),this};var __GS_Path_SegmentBezierPrototype={clone:function(){return new GS.Path.SegmentBezier(this._p0.clone(),this._p1.clone(),this._p2.clone(),this._p3.clone())},getFirstPoint:function(){return this._p0},getLastPoint:function(){return this._p3},__calculateLength:function(){var arr=GS.Path.BezierTracer.Bezier(this._p0.x,this._p0.y,this._p1.x,this._p1.y,this._p2.x,this._p2.y,this._p3.x,this._p3.y);this._length=0;for(var i=2;i<arr.length;i+=2)this._length+=Math.sqrt((arr[i]-arr[i-2])*(arr[i]-arr[i-2])+(arr[i+1]-arr[i-1])*(arr[i+1]-arr[i-1]));return this._length},getPosition:function(at){(at>1||0>at)&&(at%=1),0>at&&(at=1+at);var t=at,t2=t*t,t3=t*t2,cl0=this._p0,cl1=this._p1,cl2=this._p2,cl3=this._p3;return newPosition.set(cl0.x+t*(3*-cl0.x+t*(3*cl0.x-cl0.x*t))+t*(3*cl1.x+t*(-6*cl1.x+3*cl1.x*t))+t2*(3*cl2.x-3*cl2.x*t)+cl3.x*t3,cl0.y+t*(3*-cl0.y+t*(3*cl0.y-cl0.y*t))+t*(3*cl1.y+t*(-6*cl1.y+3*cl1.y*t))+t2*(3*cl2.y-3*cl2.y*t)+cl3.y*t3),newPosition},getContourPoints:function(points){for(var arr=GS.Path.BezierTracer.Bezier(this._p0.x,this._p0.y,this._p1.x,this._p1.y,this._p2.x,this._p2.y,this._p3.x,this._p3.y),i=0;i<arr.length;i+=2)points.push(new GS.Point(arr[i],arr[i+1]))},paint:function(ctx){ctx.bezierCurveTo(this._p1.x,this._p1.y,this._p2.x,this._p2.y,this._p3.x,this._p3.y)}};GS.Path.Segment.extend(GS.Path.SegmentBezier,__GS_Path_SegmentBezierPrototype)}(),function(){"use strict";var newPosition=new GS.Point(0,0);GS.Path.SegmentQuadratic=function(p0,p1,p2){return GS.Path.SegmentQuadratic._superclass.constructor.call(this),this._p0=p0||new GS.Point(0,0),this._p1=p1||new GS.Point(0,0),this._p2=p2||new GS.Point(0,0),this};var __GS_Path_SegmentQuadraticPrototype={clone:function(){return new GS.Path.SegmentQuadratic(this._p0.clone(),this._p1.clone(),this._p2.clone())},__calculateLength:function(){var arr=GS.Path.BezierTracer.Quadratic(this._p0.x,this._p0.y,this._p1.x,this._p1.y,this._p2.x,this._p2.y);this._length=0;for(var i=2;i<arr.length;i+=2)this._length+=Math.sqrt((arr[i]-arr[i-2])*(arr[i]-arr[i-2])+(arr[i+1]-arr[i-1])*(arr[i+1]-arr[i-1]));return this._length},getFirstPoint:function(){return this._p0},getLastPoint:function(){return this._p2},getPosition:function(at){(at>1||0>at)&&(at%=1),0>at&&(at=1+at);
var cl0=this._p0,cl1=this._p1,cl2=this._p2,t1=1-at,t=at;return newPosition.set(t1*t1*cl0.x+2*t1*t*cl1.x+t*t*cl2.x,t1*t1*cl0.y+2*t1*t*cl1.y+t*t*cl2.y),newPosition},getContourPoints:function(points){for(var arr=GS.Path.BezierTracer.Quadratic(this._p0.x,this._p0.y,this._p1.x,this._p1.y,this._p2.x,this._p2.y),i=0;i<arr.length;i+=2)points.push(new GS.Point(arr[i],arr[i+1]))},paint:function(ctx){ctx.quadraticCurveTo(this._p1.x,this._p1.y,this._p2.x,this._p2.y)}};GS.Path.Segment.extend(GS.Path.SegmentQuadratic,__GS_Path_SegmentQuadraticPrototype)}(),function(){"use strict";var newPosition=new GS.Point(0,0);GS.Path.SegmentCatmullRom=function(p0,p1,p2,p3){return GS.Path.SegmentCatmullRom._superclass.constructor.call(this),this._p0=p0.clone(),this._p1=p1.clone(),this._p2=p2.clone(),this._p3=p3.clone(),this};var __GS_Path_SegmentCatmullRomPrototype={clone:function(){return new GS.Path.SegmentBezier(this._p0.clone(),this._p1.clone(),this._p2.clone(),this._p3.clone())},getFirstPoint:function(){return this._p1},getLastPoint:function(){return this._p2},__calculateLength:function(){var arr=[];this.getContourPoints(arr,50),this._length=0;for(var i=1;i<arr.length;i++)this._length+=Math.sqrt((arr[i].x-arr[i-1].x)*(arr[i].x-arr[i-1].x)+(arr[i].y-arr[i-1].y)*(arr[i].y-arr[i-1].y));return this._length},getPosition:function(at){var af=((-at+2)*at-1)*at*.5,bf=.5*((3*at-5)*at*at+2),cf=((-3*at+4)*at+1)*at*.5,df=(at-1)*at*at*.5;return newPosition.x=this._p0.x*af+this._p1.x*bf+this._p2.x*cf+this._p3.x*df,newPosition.y=this._p0.y*af+this._p1.y*bf+this._p2.y*cf+this._p3.y*df,newPosition},getContourPoints:function(points,resolution){resolution=resolution||20;for(var i=0;resolution+1>=i;i++){var p=this.getPosition(i/resolution);p=p.clone(),points.push(p)}},paint:function(ctx){var x1,y1;x1=this._p1.x,y1=this._p1.y,ctx.beginPath(),ctx.moveTo(x1,y1);for(var t=.05;1.05>=t;t+=.05){var point=this.getPosition(t);ctx.lineTo(point.x,point.y)}ctx.stroke()}};GS.Path.Segment.extend(GS.Path.SegmentCatmullRom,__GS_Path_SegmentCatmullRomPrototype)}(),function(){"use strict";function error(pathInfo,c){var cpos=c;0>cpos&&(cpos=0),console.log("parse error near ..."+pathInfo.substr(cpos,20))}var OK=0,EOF=1,NAN=2;GS.Path.SVGPathParser={c:0,bezierInfo:null,__skipBlank:function(pathInfo,c){for(var p=pathInfo.charAt(c);c<pathInfo.length&&(" "===p||"\n"===p||"	"===p||","===p);)++c,p=pathInfo.charAt(c);return c},__maybeNumber:function(pathInfo,c){if(c<pathInfo.length-2){var p=pathInfo.charAt(c),p1=pathInfo.charAt(c+1);return"-"==p||this.__isDigit(p)||"."===p&&this.__isDigit(p1)}return!1},__isDigit:function(c){return c>="0"&&"9">=c},__getNumber:function(pathInfo,c,v,error){if(c=this.__skipBlank(pathInfo,c),c<pathInfo.length){var nc=this.__findNumber(pathInfo,c);return-1!==nc?(v.push(parseFloat(pathInfo.substr(c,nc))),c=this.__skipBlank(pathInfo,nc),error.pos=c,void(error.result=OK)):void(error.result=NAN)}error.result=EOF},____getNumbers:function(pathInfo,c,v,n,error){for(var i=0;n>i&&(this.__getNumber(pathInfo,c,v,error),error.result==OK);i++)c=error.pos;return c},__findNumber:function(pathInfo,c){var p;if("-"===pathInfo.charAt(c)&&++c,!(this.__isDigit(pathInfo.charAt(c))||"."===pathInfo.charAt(c)&&this.__isDigit(pathInfo.charAt(c+1))))return-1;for(;this.__isDigit(p=pathInfo.charAt(c));)++c;if("."===pathInfo.charAt(c)){if(++c,!this.__isDigit(pathInfo.charAt(c)))return c;for(;this.__isDigit(pathInfo.charAt(c));)++c}return c},__parseMoveTo:function(pathInfo,c,absolute,path,error){var numbers=[];if(c=this.____getNumbers(pathInfo,c,numbers,2,error),error.result===OK){if(!absolute){var p=path.getLastPoint();numbers[0]+=p.x,numbers[1]+=p.y}path.moveTo(numbers[0],numbers[1]),this.__maybeNumber(pathInfo,c)&&(c=this.lineTo(pathInfo,c,absolute,path,error)),error.pos=c}},__parseLine:function(pathInfo,c,absolute,path,error){var numbers=[];do{if(c=this.____getNumbers(pathInfo,c,numbers,2,error),!absolute){var p=path.getLastPoint();numbers[0]+=p.x,numbers[1]+=p.y}path.lineTo(numbers[0],numbers[1])}while(this.__maybeNumber(pathInfo,c));error.pos=c},__parseLineH:function(pathInfo,c,absolute,path,error){var numbers=[];do{c=this.____getNumbers(pathInfo,c,numbers,1,error);var p=path.getLastPoint();absolute||(numbers[0]+=p.x),numbers[1].push(p.y),path.lineTo(numbers[0],numbers[1])}while(this.__maybeNumber(pathInfo,c));error.pos=c},__parseLineV:function(pathInfo,c,absolute,path,error){var p=path.getLastPoint(),numbers=[p.x];do c=this.____getNumbers(pathInfo,c,numbers,1,error),absolute||(p=path.getLastPoint(),numbers[1]+=p.y),path.lineTo(numbers[0],numbers[1]);while(this.__maybeNumber(pathInfo,c));error.pos=c},__parseCubic:function(pathInfo,c,absolute,path,error){var v=[];do{if(c=this.____getNumbers(pathInfo,c,v,6,error),error.result!==OK)return;if(!absolute){var p=path.getLastPoint();v[0]+=p.x,v[1]+=p.y,v[2]+=p.x,v[3]+=p.y,v[4]+=p.x,v[5]+=p.y}path.bezierCurveTo(v[0],v[1],v[2],v[3],v[4],v[5]),v.shift(),v.shift(),this.bezierInfo=v}while(this.__maybeNumber(pathInfo,c));error.pos=c},__parseCubicS:function(pathInfo,c,absolute,path,error){var v=[];do{if(c=this.____getNumbers(pathInfo,c,v,4,error),error.result!=OK)return;if(!absolute){var p=path.getLastPoint();v[0]+=p.x,v[1]+=p.y,v[2]+=p.x,v[3]+=p.y}var x,y;x=this.bezierInfo[2]+(this.bezierInfo[2]-this.bezierInfo[0]),y=this.bezierInfo[3]+(this.bezierInfo[3]-this.bezierInfo[1]),path.bezierCurveTo(x,y,v[0],v[1],v[2],v[3]),this.bezierInfo=v}while(this.__maybeNumber(c));error.pos=c},__parseQuadricS:function(pathInfo,c,absolute,path,error){var v=[];do{if(c=this.____getNumbers(pathInfo,c,v,4,error),error.result!==OK)return;if(!absolute){var p=path.getLastPoint();v[0]+=p.x,v[1]+=p.y}var x,y;x=this.bezierInfo[2]+(this.bezierInfo[2]-this.bezierInfo[0]),y=this.bezierInfo[3]+(this.bezierInfo[3]-this.bezierInfo[1]),path.quadraticCurveTo(x,y,v[0],v[1]),this.bezierInfo=[],this.bezierInfo.push(x),this.bezierInfo.push(y),this.bezierInfo.push(v[0]),this.bezierInfo.push(v[1])}while(this.__maybeNumber(c));error.pos=c},__parseQuadric:function(pathInfo,c,absolute,path,error){var v=[];do{if(c=this.____getNumbers(pathInfo,c,v,4,error),error.result!==OK)return;if(!absolute){var p=path.getLastPoint();v[0]+=p.x,v[1]+=p.y,v[2]+=p.x,v[3]+=p.y}path.quadraticCurveTo(v[0],v[1],v[2],v[3]),this.bezierInfo=v}while(this.__maybeNumber(c));error.pos=c},__parseClosePath:function(pathInfo,c,path,error){path.closePath(),error.pos=c},parsePath:function(pathInfo,path){if(this.c=0,this.bezierInfo=[],path=path||new GS.Path.Path,this.c=this.__skipBlank(pathInfo,this.c),this.c===pathInfo.length)return path;for(var ret={pos:0,result:0};this.c!=pathInfo.length;){var segment=pathInfo.charAt(this.c);switch(segment){case"m":this.__parseMoveTo(pathInfo,this.c+1,!1,path,ret);break;case"M":this.__parseMoveTo(pathInfo,this.c+1,!0,path,ret);break;case"c":this.__parseCubic(pathInfo,this.c+1,!1,path,ret);break;case"C":this.__parseCubic(pathInfo,this.c+1,!0,path,ret);break;case"s":this.__parseCubicS(pathInfo,this.c+1,!1,path,ret);break;case"S":this.__parseCubicS(pathInfo,this.c+1,!0,path,ret);break;case"q":this.__parseQuadric(pathInfo,this.c+1,!1,path,ret);break;case"Q":this.__parseQuadricS(pathInfo,this.c+1,!0,path,ret);break;case"t":this.__parseQuadricS(pathInfo,this.c+1,!1,path,ret);break;case"T":this.__parseQuadric(pathInfo,this.c+1,!0,path,ret);break;case"l":this.__parseLine(pathInfo,this.c+1,!1,path,ret);break;case"L":this.__parseLine(pathInfo,this.c+1,!0,path,ret);break;case"h":this.__parseLineH(pathInfo,this.c+1,!1,path,ret);break;case"H":this.__parseLineH(pathInfo,this.c+1,!0,path,ret);break;case"v":this.__parseLineV(pathInfo,this.c+1,!1,path,ret);break;case"V":this.__parseLineV(pathInfo,this.c+1,!0,path,ret);break;case"z":this.__parseClosePath(pathInfo,this.c+1,path,ret);break;case"Z":this.__parseClosePath(pathInfo,this.c+1,path,ret);break;case 0:break;default:error(pathInfo,this.c)}if(ret.result!=OK){error(pathInfo,this.c);break}this.c=ret.pos}return path}}}(),function(){"use strict";var EPSILON=1e-5,__p0=new GS.Point(0,0);GS.Path.Contour=function(){return GS.Path.Contour._superclass.constructor.call(this),this._segments=[],this._currentPathX=0,this._currentPathY=0,this._closed=!1,this._cachedContourPoints=null,this._strokeGeometryBufferData=null,this._fillGeometryBufferData=null,this._dirtyCacheContour=!0,this._normalizedSegmentDurationData=[],this._normalizedSegmentStartData=[],this};var __GS_Path_ContourPrototype={clone:function(){for(var contour=new GS.Path.Contour,i=0;i<this._segments.length;i++)contour.addSegment(this._segments[i].clone());return contour},__calculateLength:function(){var i;if(this._dirtyCacheContour||0===this._length){for(this._length=0,i=0;i<this._segments.length;i++)this._length+=this._segments[i].__calculateLength();this._normalizedSegmentStartData=[],this._normalizedSegmentDurationData=[];var accumulatedLength=0;for(i=0;i<this._segments.length;i++){this._normalizedSegmentStartData.push(accumulatedLength/this._length);var segmentLength=this._segments[i]._length;accumulatedLength+=segmentLength,this._normalizedSegmentDurationData.push(segmentLength/this._length)}}return this._length},addSegment:function(s){this._dirtyCacheContour=!0,this._segments.push(s)},getFirstPoint:function(){return this.isEmpty()?new GS.Point(this._currentPathX,this._currentPathY):this._segments[0].getFirstPoint()},getLastPoint:function(){return this.isEmpty()?new GS.Point(this._currentPathX,this._currentPathY):this._segments[this._segments.length-1].getLastPoint()},getPosition:function(time){(time>1||0>time)&&(time%=1),0>time&&(time=1+time);for(var m,segmentStartTime,segmentDuration,ps=this._segments,l=0,r=ps.length;l!==r;){if(m=(r+l)/2|0,segmentStartTime=this._normalizedSegmentStartData[m],segmentDuration=this._normalizedSegmentDurationData[m],time>=segmentStartTime&&segmentStartTime+segmentDuration>=time){time=segmentDuration?(time-segmentStartTime)/segmentDuration:0,time>1?time=1:0>time&&(time=0);var pointInPath=ps[m].getPosition(time);return __p0.x=pointInPath.x,__p0.y=pointInPath.y,__p0}segmentStartTime>time?r=m:l=m+1}var lp=this.getLastPoint();return __p0.x=lp.x,__p0.y=lp.y,__p0},moveTo:function(x,y){return this._currentPathX=x,this._currentPathY=y,this},lineTo:function(x,y){return this.isClosed()?this:(this._segments.push(new GS.Path.SegmentLinear(this.getLastPoint(),new GS.Point(x,y))),this._currentPathX=x,this._currentPathY=y,this._dirtyCacheContour=!0,this)},bezierCurveTo:function(x1,y1,x2,y2,x3,y3){return this.isClosed()?this:(this._segments.push(new GS.Path.SegmentBezier(this.getLastPoint(),new GS.Point(x1,y1),new GS.Point(x2,y2),new GS.Point(x3,y3))),this._currentPathX=x3,this._currentPathY=y3,this._dirtyCacheContour=!0,this)},quadraticCurveTo:function(x1,y1,x2,y2){return this.isClosed()?this:(this._segments.push(new GS.Path.SegmentQuadratic(this.getLastPoint(),new GS.Point(x1,y1),new GS.Point(x2,y2))),this._currentPathX=x2,this._currentPathY=y2,this._dirtyCacheContour=!0,this)},rect:function(x,y,w,h){return this.moveTo(x,y),this.lineTo(x+w-1,y),this.lineTo(x+w-1,y+h-1),this.lineTo(x,y+h-1),this.closePath(),this._dirtyCacheContour=!0,this},oval:function(x,y,r,startAngle,endAngle,cc,addStraightSegment){if(this.isClosed())return this;var segmentOval=new GS.Path.SegmentOval(x,y,r,startAngle,endAngle,cc);return addStraightSegment&&(__p0.copy(segmentOval.getFirstPoint()),this.lineTo(__p0.x,__p0.y)),this._segments.push(segmentOval),this._dirtyCacheContour=!0,this},catmullRomTo:function(points,closed){closed?(points.unshift(points[points.length-1].clone()),points.push(points[1].clone()),points.push(points[2].clone())):(points.unshift(points[0].clone()),points.push(points[points.length-1].clone()));for(var i=1;i<points.length-2;i++){var segment=new GS.Path.SegmentCatmullRom(points[i-1],points[i],points[i+1],points[i+2]);this._segments.push(segment)}return this._dirtyCacheContour=!0,this},arcTo:function(x1,y1,x2,y2,radius){var cp=this.getLastPoint(),a1=cp.y-y1,b1=cp.x-x1,a2=y2-y1,b2=x2-x1,mm=Math.abs(a1*b2-b1*a2);if(EPSILON>mm||0===radius)this.lineTo(x1,y1);else{var dd=a1*a1+b1*b1,cc=a2*a2+b2*b2,tt=a1*a2+b1*b2,k1=radius*Math.sqrt(dd)/mm,k2=radius*Math.sqrt(cc)/mm,j1=k1*tt/dd,j2=k2*tt/cc,cx=k1*b2+k2*b1,cy=k1*a2+k2*a1,px=b1*(k2+j1),py=a1*(k2+j1),qx=b2*(k1+j2),qy=a2*(k1+j2),startAngle=Math.atan2(py-cy,px-cx),endAngle=Math.atan2(qy-cy,qx-cx),arcSegment=new GS.Path.SegmentOval(cx+x1,cy+y1,radius,startAngle,endAngle,b1*a2>b2*a1),lp=this.getLastPoint(),arcFirstPoints=arcSegment.getFirstPoint();(Math.abs(arcFirstPoints.x-lp.x)>EPSILON||Math.abs(arcFirstPoints.y-lp.y)>EPSILON)&&this.lineTo(arcFirstPoints.x,arcFirstPoints.y),this._segments.push(arcSegment)}return this._dirtyCacheContour=!0,this},isClosed:function(){return this._closed},isEmpty:function(){return 0===this._segments.length},closePath:function(){this._segments.push(new GS.Path.SegmentLinear(this.getLastPoint(),this.getFirstPoint())),this._closed=!0,this._dirtyCacheContour=!0},__getContourPoints:function(){if(this._cachedContourPoints&&!this._dirtyCacheContour)return this._cachedContourPoints;this._cachedContourPoints=[],this._cachedContourPoints.push(this.getFirstPoint());for(var i=0,l=this._segments.length;i!=l;i+=1){var segment=this._segments[i];segment.getContourPoints(this._cachedContourPoints)}var fp=this.getFirstPoint(),lp=this.getLastPoint();if(fp.x===lp.x&&fp.y===lp.y){this._cachedContourPoints.shift();var p=GS.Point.MidPoint(fp,this._cachedContourPoints[0]);this._cachedContourPoints.push(p),this._cachedContourPoints.unshift(p)}return this._length=0,this.__calculateLength(),this._dirtyCacheContour=!1,this._cachedContourPoints},getContourPoints:function(){return this.isEmpty()?[]:(this._dirtyCacheContour&&this.__getContourPoints(),this._cachedContourPoints)},createAndGetTessellatedFillBufferData:function(ear){var tessellationData;if(this._dirtyCacheContour||null===this._fillGeometryBufferData){var contourPoints=this.getContourPoints();tessellationData=ear.computeTriangles(contourPoints),this._fillGeometryBufferData=GS.FloatArray(2*tessellationData.length,0);for(var i=0;i<tessellationData.length;i+=1)this._fillGeometryBufferData[2*i]=tessellationData[i].x,this._fillGeometryBufferData[2*i+1]=tessellationData[i].y}return this._fillGeometryBufferData},createAndGetTessellatedStrokeBufferData:function(pt,lineWidth,lineJoin,lineCap,miterLimit){var tessellationData;if(this._dirtyCacheContour||null===this._strokeGeometryBufferData){var contourPoints=this.getContourPoints();tessellationData=pt.computeTriangles(contourPoints,lineWidth,lineJoin,lineCap,miterLimit),this._strokeGeometryBufferData=GS.FloatArray(2*tessellationData.length,0);for(var i=0;i<tessellationData.length;i+=1)this._strokeGeometryBufferData[2*i]=tessellationData[i].x,this._strokeGeometryBufferData[2*i+1]=tessellationData[i].y}return this._strokeGeometryBufferData},getStrokeBufferData:function(){return this._strokeGeometryBufferData},getFillBufferData:function(){return this._fillGeometryBufferData},paint:function(ctx,fill,stroke){var i;if(ctx.type&&"canvas"===ctx.type){for(ctx.save(),ctx.beginPath(),ctx.moveTo(this.getFirstPoint().x,this.getFirstPoint().y),i=0;i<this._segments.length;i++)this._segments[i].paint(ctx);ctx.restore(),fill&&ctx.fill(),stroke&&ctx.stroke()}}};GS.Path.Segment.extend(GS.Path.Contour,__GS_Path_ContourPrototype)}(),function(){"use strict";var __identityMatrix=GS.Math.Matrix.IDENTITY,__matrix0=GS.Math.Matrix.create(),__matrix1=GS.Math.Matrix.create(),__p0=new GS.Point(0,0),__p1=new GS.Point(0,0),__p2=new GS.Point(0,0),__p3=new GS.Point(0,0);GS.Path.Path=function(SVGString){return GS.Path.Path._superclass.constructor.call(this),this._lastContourData=null,this._contours=[],this._currentContour=null,this._strokeGeometryBufferData=null,this._fillGeometryBufferData=null,this.dirty=!0,this.lineJoin="miter",this.lineCap="butt",this.__ctx=null,this._normalizedContourStartData=[],this._normalizedContourDurationData=[],this.__newContour(),"undefined"!=typeof SVGString&&GS.Path.SVGPathParser.parsePath(SVGString,this),this};var __GS_Path_PathPrototype={clone:function(){var path=new GS.Path.Path;path._contours=[];for(var i=0;i<this._contours.length;i++)path._contours.push(this._contours[i].clone());return path._currentContour=path._contours[path._contours.length-1],path.lineJoin=this.lineJoin,path.lineCap=this.lineCap,path.__ctx=this.__ctx,path},__calculateLength:function(){var i;if(0===this._length||this.dirty){for(this._length=0,i=0;i<this._contours.length;i++)this._length+=this._contours[i].__calculateLength();this._normalizedContourStartData=[],this._normalizedContourDurationData=[];var accumulatedLength=0;for(i=0;i<this._contours.length;i++){this._normalizedContourStartData.push(accumulatedLength/this._length);var contourLength=this._contours[i]._length;accumulatedLength+=contourLength,this._normalizedContourDurationData.push(contourLength/this._length)}}return this._length},getPosition:function(time,openContour){if(0===this._length&&this.__calculateLength(),openContour&&(time>=1||0>=time)){var p0,p1,ratio,angle;time>=1?(p0=this.__getPositionImpl(.999),p1=this.getLastPoint(),angle=Math.atan2(p1.y-p0.y,p1.x-p0.x),ratio=time%1):(p0=this.__getPositionImpl(.001),p1=this.getFirstPoint(),angle=Math.atan2(p1.y-p0.y,p1.x-p0.x),ratio=-time);var length=this.getLength();return __p0.x=p1.x+ratio*length*Math.cos(angle),__p0.y=p1.y+ratio*length*Math.sin(angle),__p0}return 1===this._contours.length?this._contours[0].getPosition(time):this.__getPositionImpl(time)},__getPositionImpl:function(time){(time>1||0>time)&&(time%=1),0>time&&(time=1+time);for(var m,contourStartTime,contourDuration,ps=this._contours,l=0,r=ps.length;l!==r;){if(m=(r+l)/2|0,contourStartTime=this._normalizedContourStartData[m],contourDuration=this._normalizedContourDurationData[m],time>=contourStartTime&&contourStartTime+contourDuration>=time){time=contourDuration?(time-contourStartTime)/contourDuration:0,time>1?time=1:0>time&&(time=0);var pointInPath=ps[m].getPosition(time);return __p0.x=pointInPath.x,__p0.y=pointInPath.y,__p0}contourStartTime>time?r=m:l=m+1}var lp=this.getLastPoint();return __p0.x=lp.x,__p0.y=lp.y,__p0},isDirty:function(){return this.dirty},__invalidateCache:function(){this.dirty=!0,this.dirtyStroke=!0,this.dirtyFill=!0,this._length=0},addContour:function(){this._contours.push(this._currentContour),this.__invalidateCache()},__newContour:function(){this.__invalidateCache(),this._currentContour=new GS.Path.Contour,this._contours.push(this._currentContour)},beginPath:function(){this.isEmpty()||(this._contours=[],this._lastContourData=null,this.__invalidateCache(),this.__newContour())},moveTo:function(x,y,matrix){return(!this._currentContour.isEmpty()||this._currentContour.isClosed())&&this.__newContour(),__p0.set(x,y),matrix&&GS.Math.Matrix.transformPoint(__p0,matrix),this._currentContour.moveTo(__p0.x,__p0.y),this},lineTo:function(x,y,matrix){return this._currentContour.isClosed()&&this.__newContour(),__p0.set(x,y),matrix&&GS.Math.Matrix.transformPoint(__p0,matrix),this._currentContour.lineTo(__p0.x,__p0.y),this.__invalidateCache(),this},rect:function(x0,y0,w,h,matrix){(!this._currentContour.isEmpty()||this._currentContour.isClosed())&&this.__newContour();var x1=x0+w,y1=y0+h;return __p0.set(x0,y0),__p1.set(x1,y0),__p2.set(x1,y1),__p3.set(x0,y1),matrix&&(GS.Math.Matrix.transformPoint(__p0,matrix),GS.Math.Matrix.transformPoint(__p1,matrix),GS.Math.Matrix.transformPoint(__p2,matrix),GS.Math.Matrix.transformPoint(__p3,matrix)),this._currentContour.moveTo(__p0.x,__p0.y),this._currentContour.lineTo(__p1.x,__p1.y),this._currentContour.lineTo(__p2.x,__p2.y),this._currentContour.lineTo(__p3.x,__p3.y),this._currentContour.closePath(),this.__invalidateCache(),this},oval:function(x,y,r,startAngle,endAngle,cc,matrix){if(this._currentContour.isClosed()){var lp=this.getLastPoint();this.__newContour(),this._currentContour.moveTo(lp.x,lp.y)}if(matrix=matrix||__identityMatrix,matrix!==__identityMatrix){__p0.set(x,y),GS.Math.Matrix.transformPoint(__p0,matrix),x=__p0.x,y=__p0.y,__p0.set(0,0),__p1.set(r,0),GS.Math.Matrix.transformPoint(__p0,matrix),GS.Math.Matrix.transformPoint(__p1,matrix),r=GS.Point.Distance(__p0,__p1);var diffAngle=endAngle-startAngle;GS.Math.Matrix.copy(matrix,__matrix0),GS.Math.Matrix.createRotate(startAngle,__matrix1),GS.Math.Matrix.multiply(__matrix0,__matrix1),__p0.set(0,0),__p1.set(r,0),GS.Math.Matrix.transformPoint(__p0,__matrix0),GS.Math.Matrix.transformPoint(__p1,__matrix0),__p1.sub(__p0),startAngle=0===__p1.x&&0===__p1.y?0:Math.atan2(__p1.y,__p1.x),endAngle=startAngle+diffAngle}return this._currentContour.oval(x,y,r,startAngle,endAngle,cc,!this.isEmpty()),this.__invalidateCache(),this},arcTo:function(x1,y1,x2,y2,radius,matrix){return matrix=matrix||__identityMatrix,__p0.set(x1,y1),GS.Math.Matrix.transformPoint(__p0,matrix),__p1.set(x2,y2),GS.Math.Matrix.transformPoint(__p1,matrix),__p3.set(0,0),GS.Math.Matrix.transformPoint(__p3,matrix),__p2.set(radius,0),GS.Math.Matrix.transformPoint(__p2,matrix),this._currentContour.arcTo(__p0.x,__p0.y,__p1.x,__p1.y,GS.Point.Sub(__p3,__p2).module(),matrix),this.__invalidateCache(),this},closePath:function(){this._currentContour.closePath(),this.__invalidateCache()},catmullRomTo:function(_points,closed,matrix){var points=_points.slice(0);if(matrix)for(var i=0;i<points.length;i++)GS.Math.Matrix.transformPoint(points[i],matrix);return this._currentContour.catmullRomTo(points,closed),this.__invalidateCache(),this},quadraticCurveTo:function(x0,y0,x1,y1,matrix){return __p0.set(x0,y0),__p1.set(x1,y1),matrix&&(GS.Math.Matrix.transformPoint(__p0,matrix),GS.Math.Matrix.transformPoint(__p1,matrix)),this._currentContour.quadraticCurveTo(__p0.x,__p0.y,__p1.x,__p1.y),this.__invalidateCache(),this},bezierCurveTo:function(x0,y0,x1,y1,x2,y2,matrix){return __p0.set(x0,y0),__p1.set(x1,y1),__p2.set(x2,y2),matrix&&(GS.Math.Matrix.transformPoint(__p0,matrix),GS.Math.Matrix.transformPoint(__p1,matrix),GS.Math.Matrix.transformPoint(__p2,matrix)),this._currentContour.bezierCurveTo(__p0.x,__p0.y,__p1.x,__p1.y,__p2.x,__p2.y),this.__invalidateCache(),this},isEmpty:function(){return 0===this._contours.length?!0:this._contours[0].isEmpty()},getFirstPoint:function(){return this.isEmpty()?null:this._contours[0].getFirstPoint()},getLastPoint:function(){return this.isEmpty()?null:this._contours[this._contours.length-1].getLastPoint()},getContourPoints:function(){if(this.dirty){this.dirty=!1;var contourData=[];return this._contours.map(function(contour){contour.isClosed()&&contourData.push(contour.getContourPoints())}),this._lastContourData=contourData,contourData}return this._lastContourData},createAndGetTessellatedFillBufferData:function(ear){var i,size=0,buffers=[],offset=0;for(i=0;i<this._contours.length;i++){var buffer=this._contours[i].createAndGetTessellatedFillBufferData(ear);buffer&&(size+=buffer.length,buffers.push(buffer))}for(this._fillGeometryBufferData=GS.FloatArray(size,0),i=0;i<buffers.length;i++)this._fillGeometryBufferData.set(buffers[i],offset),offset+=buffers[i].length},createAndGetTessellatedStrokeBufferData:function(pt,lineWidth,lineJoin,lineCap,miterLimit){var i,size=0,buffers=[],offset=0;for(i=0;i<this._contours.length;i++){var buffer=this._contours[i].createAndGetTessellatedStrokeBufferData(pt,lineWidth,lineJoin,lineCap,miterLimit);buffer&&(size+=buffer.length,buffers.push(buffer))}for(this._strokeGeometryBufferData=GS.FloatArray(size,0),i=0;i<buffers.length;i++)this._strokeGeometryBufferData.set(buffers[i],offset),offset+=buffers[i].length},prepareStroke:function(pt,lineWidth,miterlimit){(this.dirty||this.dirtyStroke)&&(this.createAndGetTessellatedStrokeBufferData(pt,lineWidth,this.lineJoin,this.lineCap,miterlimit),this.dirtyStroke=!1,this.dirty=!1)},prepareFill:function(ear){(this.dirty||this.dirtyFill)&&(this.createAndGetTessellatedFillBufferData(ear),this.dirtyFill=!1,this.dirty=!1)},fillInContext:function(ctx){if("canvas"===ctx.type){ctx.save();for(var i=0;i<this._contours.length;i++)this._contours[i].paint(ctx,!0,!1);ctx.restore()}else ctx.fill(this)},strokeInContext:function(ctx){if("canvas"===ctx.type){ctx.save(),ctx.lineCap=this.lineCap,ctx.lineJoin=this.lineJoin;for(var i=0;i<this._contours.length;i++)this._contours[i].paint(ctx,!1,!0);ctx.restore()}else ctx.stroke(this)}};GS.Path.Segment.extend(GS.Path.Path,__GS_Path_PathPrototype)}(),function(){"use strict";GS.Path.BezierTracer={curve_recursion_limit:8,m_angle_tolerance:.2,m_cusp_limit:15*Math.PI/180,m_approximation_scale:1,curve_collinearity_epsilon:.001,curve_angle_tolerance_epsilon:0,m_distance_tolerance:1e-4,__recursive_bezier:function(x1,y1,x2,y2,x3,y3,x4,y4,level){if(!(level>this.curve_recursion_limit)){var x12=(x1+x2)/2,y12=(y1+y2)/2,x23=(x2+x3)/2,y23=(y2+y3)/2,x34=(x3+x4)/2,y34=(y3+y4)/2,x123=(x12+x23)/2,y123=(y12+y23)/2,x234=(x23+x34)/2,y234=(y23+y34)/2,x1234=(x123+x234)/2,y1234=(y123+y234)/2;if(level>0){var da1,da2,dx=x4-x1,dy=y4-y1,d2=Math.abs((x2-x4)*dy-(y2-y4)*dx),d3=Math.abs((x3-x4)*dy-(y3-y4)*dx);if(d2>this.curve_collinearity_epsilon&&d3>this.curve_collinearity_epsilon){if((d2+d3)*(d2+d3)<=this.m_distance_tolerance*(dx*dx+dy*dy)){if(this.m_angle_tolerance<this.curve_angle_tolerance_epsilon)return void this.m_points.push(x1234,y1234);var a23=Math.atan2(y3-y2,x3-x2);if(da1=Math.abs(a23-Math.atan2(y2-y1,x2-x1)),da2=Math.abs(Math.atan2(y4-y3,x4-x3)-a23),da1>=Math.PI&&(da1=2*Math.PI-da1),da2>=Math.PI&&(da2=2*Math.PI-da2),da1+da2<this.m_angle_tolerance)return void this.m_points.push(x1234,y1234);if(0!==this.m_cusp_limit){if(da1>this.m_cusp_limit)return void this.m_points.push(x2,y2);if(da2>this.m_cusp_limit)return void this.m_points.push(x3,y3)}}}else if(d2>this.curve_collinearity_epsilon){if(d2*d2<=this.m_distance_tolerance*(dx*dx+dy*dy)){if(this.m_angle_tolerance<this.curve_angle_tolerance_epsilon)return void this.m_points.push(x1234,y1234);if(da1=Math.abs(Math.atan2(y3-y2,x3-x2)-Math.atan2(y2-y1,x2-x1)),da1>=Math.PI&&(da1=2*Math.PI-da1),da1<this.m_angle_tolerance)return this.m_points.push(x2,y2),void this.m_points.push(x3,y3);if(0!==this.m_cusp_limit&&da1>this.m_cusp_limit)return void this.m_points.push(x2,y2)}}else if(d3>this.curve_collinearity_epsilon){if(d3*d3<=this.m_distance_tolerance*(dx*dx+dy*dy)){if(this.m_angle_tolerance<this.curve_angle_tolerance_epsilon)return void this.m_points.push(x1234,y1234);if(da1=Math.abs(Math.atan2(y4-y3,x4-x3)-Math.atan2(y3-y2,x3-x2)),da1>=Math.PI&&(da1=2*Math.PI-da1),da1<this.m_angle_tolerance)return this.m_points.push(x2,y2),void this.m_points.push(x3,y3);if(0!==this.m_cusp_limit&&da1>this.m_cusp_limit)return void this.m_points.push(x3,y3)}}else if(dx=x1234-(x1+x4)/2,dy=y1234-(y1+y4)/2,dx*dx+dy*dy<=this.m_distance_tolerance)return void this.m_points.push(x1234,y1234)}this.__recursive_bezier(x1,y1,x12,y12,x123,y123,x1234,y1234,level+1),this.__recursive_bezier(x1234,y1234,x234,y234,x34,y34,x4,y4,level+1)}},Bezier:function(x1,y1,x2,y2,x3,y3,x4,y4){return this.m_points=[],this.m_distance_tolerance=.5/this.m_approximation_scale,this.m_distance_tolerance*=this.m_distance_tolerance,this.__recursive_bezier(x1,y1,x2,y2,x3,y3,x4,y4,0),this.m_points.push(x4,y4),this.m_points},Quadratic:function(x1,y1,x2,y2,x3,y3){return this.m_points=[],this.m_distance_tolerance=.5/this.m_approximation_scale,this.m_distance_tolerance*=this.m_distance_tolerance,this.__recursive_quadratic(x1,y1,x2,y2,x3,y3,0),this.m_points.push(x3,y3),this.m_points},__recursive_quadratic:function(x1,y1,x2,y2,x3,y3,level){if(!(level>this.curve_recursion_limit)){var x12=(x1+x2)/2,y12=(y1+y2)/2,x23=(x2+x3)/2,y23=(y2+y3)/2,x123=(x12+x23)/2,y123=(y12+y23)/2,dx=x3-x1,dy=y3-y1,d=Math.abs((x2-x3)*dy-(y2-y3)*dx);if(d>this.curve_collinearity_epsilon){if(d*d<=this.m_distance_tolerance*(dx*dx+dy*dy)){if(this.m_angle_tolerance<this.curve_angle_tolerance_epsilon)return void this.m_points.push(x123,y123);var da=Math.abs(Math.atan2(y3-y2,x3-x2)-Math.atan2(y2-y1,x2-x1));if(da>=Math.PI&&(da=2*Math.PI-da),da<this.m_angle_tolerance)return void this.m_points.push(x123,y123)}}else if(dx=x123-(x1+x3)/2,dy=y123-(y1+y3)/2,dx*dx+dy*dy<=this.m_distance_tolerance)return void this.m_points.push(x123,y123);this.__recursive_quadratic(x1,y1,x12,y12,x123,y123,level+1),this.__recursive_quadratic(x123,y123,x23,y23,x3,y3,level+1)}}}}(),function(){"use strict";GS.Shape=function(){this._paths=[]};var __GS_ShapePrototype={clear:function(){this._paths=[]},addPath:function(path,styles){return styles=styles||{fillStyle:"#000"},this._paths.push({path:path,styles:styles}),this},paintInContext:function(ctx){var i,pathElement;if(ctx.save(),"canvas"===ctx.type)for(i=0;i<this._paths.length;i++)pathElement=this._paths[i],pathElement.styles&&pathElement.styles.strokeStyle&&(ctx.strokeStyle=pathElement.styles.strokeStyle,pathElement.path.strokeInContext(ctx)),pathElement.styles&&pathElement.styles.fillStyle&&(ctx.fillStyle=pathElement.styles.fillStyle,pathElement.path.fillInContext(ctx));else for(i=0;i<this._paths.length;i++)pathElement=this._paths[i],pathElement.styles&&pathElement.styles.strokeStyle&&(ctx.strokeStyle=pathElement.styles.strokeStyle,ctx.stroke(pathElement.path)),pathElement.styles&&pathElement.styles.fillStyle&&(ctx.fillStyle=pathElement.styles.fillStyle,ctx.fill(pathElement.path));ctx.restore()}};GS.Object.extend(GS.Shape,__GS_ShapePrototype)}(),function(){function __bounce(time){return(time/=1)<1/2.75?7.5625*time*time:2/2.75>time?7.5625*(time-=1.5/2.75)*time+.75:2.5/2.75>time?7.5625*(time-=2.25/2.75)*time+.9375:7.5625*(time-=2.625/2.75)*time+.984375}GS.Interpolator={},GS.Interpolator.LinearInterpolator=function(pingpong,inverse){return function(time){return pingpong&&(.5>time?time*=2:time=1-2*(time-.5)),inverse&&(time=1-time),time}},GS.Interpolator.BackOutInterpolator=function(bPingPong){return function(time){return bPingPong&&(.5>time?time*=2:time=1-2*(time-.5)),time-=1,time*time*(2.70158*time+1.70158)+1}},GS.Interpolator.BackInInterpolator=function(bPingPong){return function(time){return bPingPong&&(.5>time?time*=2:time=1-2*(time-.5)),time*time*(2.70158*time+1.70158)+1}},GS.Interpolator.ExponentialInInterpolator=function(exponent,bPingPong){return function(time){return bPingPong&&(.5>time?time*=2:time=1-2*(time-.5)),Math.pow(time,exponent)}},GS.Interpolator.ExponentialOutInterpolator=function(exponent,bPingPong){return function(time){return bPingPong&&(.5>time?time*=2:time=1-2*(time-.5)),1-Math.pow(1-time,exponent)}},GS.Interpolator.ExponentialInOutInterpolator=function(exponent,bPingPong){return function(time){return bPingPong&&(.5>time?time*=2:time=1-2*(time-.5)),1>2*time?Math.pow(2*time,exponent)/2:1-Math.abs(Math.pow(2*time-2,exponent))/2}},GS.Interpolator.QuadricBezierInterpolator=function(p0,p1,p2,bPingPong){return function(time){return bPingPong&&(.5>time?time*=2:time=1-2*(time-.5)),(1-time)*(1-time)*p0.y+2*(1-time)*time*p1.y+time*time*p2.y}},GS.Interpolator.CubicBezierInterpolator=function(p0,p1,p2,p3,bPingPong){return function(time){bPingPong&&(.5>time?time*=2:time=1-2*(time-.5));var t2=time*time,t3=time*t2;return p0.y+time*(3*-p0.y+time*(3*p0.y-p0.y*time))+time*(3*p1.y+time*(-6*p1.y+3*p1.y*time))+t2*(3*p2.y-3*p2.y*time)+p3.y*t3}},GS.Interpolator.ElasticOutInterpolator=function(amplitude,p,bPingPong){return function(time){bPingPong&&(.5>time?time*=2:time=1-2*(time-.5));var s=0;return s=0===time?0:1===time?1:p/(2*Math.PI)*Math.asin(1/amplitude),amplitude*Math.pow(2,-10*time)*Math.sin(2*(time-s)*Math.PI/p)+1}},GS.Interpolator.ElasticInInterpolator=function(amplitude,p,bPingPong){return function(time){bPingPong&&(.5>time?time*=2:time=1-2*(time-.5));var s;return s=0===time?0:1===time?1:p/(2*Math.PI)*Math.asin(1/amplitude),-(amplitude*Math.pow(2,10*(time-=1))*Math.sin(2*(time-s)*Math.PI/p))}},GS.Interpolator.ElasticInOutInterpolator=function(amplitude,p,bPingPong){return function(time){bPingPong&&(.5>time?time*=2:time=1-2*(time-.5));var s=p/(2*Math.PI)*Math.asin(1/amplitude);time*=2;var v=amplitude*Math.pow(2,10*(time-=1))*Math.sin(2*(time-s)*Math.PI/p);return 1>=time?-.5*v:1+.5*v}},GS.Interpolator.Bounce=function(){return function(time){return __bounce(time)}},GS.Interpolator.BounceOutInterpolator=function(bPingPong){return function(time){return bPingPong&&(.5>time?time*=2:time=1-2*(time-.5)),__bounce(time)
}},GS.Interpolator.BounceInInterpolator=function(bPingPong){return function(time){return bPingPong&&(.5>time?time*=2:time=1-2*(time-.5)),1-__bounce(1-time)}},GS.Interpolator.BounceInOutInterpolator=function(bPingPong){return function(time){return bPingPong&&(.5>time?time*=2:time=1-2*(time-.5)),.5>time?.5*(1-__bounce(1-2*time)):.5*__bounce(2*time-1)+.5}}}(),function(){var PAUSED=1,RUNNING=2,CREATED=3,SOLVED=4,ENDED=5,RESUMED=6;GS.Behavior=function(start,duration,id){return this._id=id||0,this._startTime=start||0,this._duration=duration||0,this._currentTime=0,this._repeatTimes=1,this._currentRepetitionCount=0,this._onStart=null,this._onEnd=null,this._onRepeat=null,this._onApply=null,this._onPause=null,this._onResume=null,this._interpolator=null,this._timeOffset=0,this._status=CREATED,this._lastApplicationTime=0,this._fromValuesSet=!1,this._owner=null,this._chainBehavior=null,this._firstExecution=!0,this._delayAfterApplication=0,this};var __GS_BehaviorPrototype={setTimeFrame:function(start,duration){this._startTime=start,this._duration=duration},setTimeOffset:function(offset){return this._timeOffset=offset,this},setId:function(id){return this.id=id,this},setStartTime:function(start){return this._status=CREATED,this._startTime=start,this},setDuration:function(duration){return this._duration=duration,this},setRepeatTimes:function(repeatTimes,obj){return this._repeatTimes=repeatTimes,this._delayAfterApplication=obj&&obj.withDelay||0,this._duration+=this._delayAfterApplication,this},setRepeatForever:function(obj){return this._delayAfterApplication=obj&&obj.withDelay||0,this._duration+=this._delayAfterApplication,this.setRepeatTimes(0)},onStart:function(callback){return this._onStart=callback,this},onEnd:function(callback){return this._onEnd=callback,this},onRepeat:function(callback){return this._onRepeat=callback,this},onApply:function(callback){return this._onApply=callback,this},onPause:function(callback){return this._onPause=callback,this},onResume:function(callback){return this._onResume=callback,this},pause:function(target){return this._status=PAUSED,this._onPause&&this._onPause(this,target),this},resume:function(){return this._status===PAUSED&&(this._status=RESUMED),this},setInterpolator:function(interpolator){return this._interpolator=interpolator,this},__normalizeTime:function(time){return time-=this._startTime,time%=this._duration,time<this._duration-this._delayAfterApplication?time/=this._duration-this._delayAfterApplication:time=1,this._interpolator?this._interpolator(time):time},__setForTime:function(){},__apply:function(elapsedTime,actor){if(this.__isBehaviorInTime(elapsedTime,actor)){this._firstExecution&&(this._fromValuesSet||this.__setInitialValues(actor),this._onStart&&this._onStart(this,actor),this._firstExecution=!1);var v=this.__setForTime(this.__normalizeTime(this._currentTime),actor);if(this._onApply&&this._onApply(this,actor,v),1!==this._repeatTimes){var repetition=(this._currentTime-this._startTime)/this._duration>>0;repetition!==this._currentRepetitionCount&&(this._onRepeat&&this._onRepeat(this,actor,repetition),this._currentRepetitionCount=repetition)}}},__isBehaviorInTime:function(elapsedTime,actor){return this._status===PAUSED?!1:(this._status===CREATED&&(this._chainBehavior&&(this._startTime+=this._chainBehavior._startTime+this._chainBehavior._duration*this._chainBehavior._repeatTimes),this._startTime+=this._timeOffset*this._duration*this._repeatTimes,this._status=SOLVED),this._status===RESUMED&&this._onResume&&this._onResume(this,actor),this._currentTime+=elapsedTime,this._currentTime<this._startTime?!1:(this._status=RUNNING,0===this._repeatTimes||this._currentTime<this._startTime+this._duration*this._repeatTimes?!0:void(this._status!==ENDED&&(this._status=ENDED,this._interpolator?this.__setForTime(this._interpolator(1),actor):this.__setForTime(1,actor),this._onRepeat&&this._onRepeat(this,actor,this._repeatTimes),this._onEnd&&this._onEnd(this,actor)))))},stop:function(actor){this._status=ENDED,this._onEnd&&this._onEnd(this,actor)},isFinished:function(){return this._status===ENDED},isPaused:function(){return this._status===PAUSED},from:function(){return this},to:function(){return this},tweenMove:function(){return this._owner.tweenMove()},tweenAlpha:function(){return this._owner.tweenAlpha()},tweenPath:function(){return this._owner.tweenPath()},tweenColor:function(){return this._owner.tweenColor()},tweenProperty:function(){return this._owner.tweenProperty()},then:function(){return this._owner.then()},setChain:function(bh){this._chainBehavior=bh}};GS.Object.extend(GS.Behavior,__GS_BehaviorPrototype)}(),function(){var ret={},PropertyInfo=function(pr,s,e){return this._property=pr,this._start=s,this._end=e,this};GS.PropertyBehavior=function(properties,end,startTime,duration,id){if(GS.PropertyBehavior._superclass.constructor.call(this,startTime,duration,id),this._propertiesInfo=[],"undefined"!=typeof properties){this._fromValuesSet=!0;for(var pr in properties)this._propertiesInfo.push(new PropertyInfo(pr,properties[pr],end))}return this};var __GS_PropertyBehaviorPrototype={__setForTime:function(time,actor){for(var i=0;i<this._propertiesInfo.length;i++){var pr=this._propertiesInfo[i],v=pr._start+time*(pr._end-pr._start);actor[pr._property]=v,ret[pr._property]=v}return ret},__setInitialValues:function(actor){this._fromValuesSet=!0;for(var i=0;i<this._propertiesInfo.length;i++){var pr=this._propertiesInfo[i];"undefined"==typeof pr._start&&(pr._start=actor[pr._property]),"undefined"==typeof pr._end&&(pr._end=actor[pr._property])}},from:function(props){for(var pr in props){var propertyInfo=new PropertyInfo(pr,props[pr]);this._propertiesInfo.push(propertyInfo)}return this},to:function(props,delay,duration,interpolator){var i;interpolator&&(this._interpolator=interpolator),this.setTimeFrame(delay,duration);for(var pr in props){var property=null;for(i=0;i<this._propertiesInfo.length;i++)if(this._propertiesInfo[i]._property===pr){property=this._propertiesInfo[i];break}property||(property=new PropertyInfo(pr),this._propertiesInfo.push(property)),property._end=props[pr]}for(i=0;i<this._propertiesInfo.length;i++);return this}};GS.Behavior.extend(GS.PropertyBehavior,__GS_PropertyBehaviorPrototype)}(),function(){var ret={r:0,g:0,b:0};GS.TintBehavior=function(r0,g0,b0,r1,g1,b1,start,duration,id){return GS.TintBehavior._superclass.constructor.call(this,start,duration,id),"undefined"!=typeof r0&&"undefined"!=typeof g0&&"undefined"!=typeof b0&&(this._fromValuesSet=!0),this._r0=r0,this._g0=b0,this._b0=b0,this._r1=r1,this._g1=g1,this._b1=b1,this};var __GS_TintBehavior={__setForTime:function(time,actor){var r=this._r0+time*(this._r1-this._r0),g=this._g0+time*(this._g1-this._g0),b=this._b0+time*(this._b1-this._b0);return actor.setColor(r,g,b),ret.r=r,ret.g=g,ret.b=b,ret},__setInitialValues:function(actor){this._r0=actor._color[0],this._g0=actor._color[1],this._b0=actor._color[2]},from:function(scolor){this._fromValuesSet=!0;var color=GS.RendererUtils.parseStyle(scolor);return this._r0=color[0],this._g0=color[1],this._b0=color[2],this},to:function(scolor,delay,duration,interpolator){interpolator&&(this._interpolator=interpolator),this.setTimeFrame(delay,duration);var color=GS.RendererUtils.parseStyle(scolor);return this._r1=color[0],this._g1=color[1],this._b1=color[2],this}};GS.Behavior.extend(GS.TintBehavior,__GS_TintBehavior)}(),function(){GS.AlphaBehavior=function(a0,a1,start,duration,id){return GS.AlphaBehavior._superclass.constructor.call(this,start,duration,id),"undefined"!=typeof a0&&(this._fromValuesSet=!0),this._a0=a0,this._a1=a1,this};var __GS_AlphaBehavior={__setForTime:function(time,actor){var a=this._a0+time*(this._a1-this._a0);return actor.alpha=a,a},__setInitialValues:function(actor){this._a0=actor.alpha},from:function(alpha){return this._fromValuesSet=!0,this._a0=alpha,this},to:function(alpha,delay,duration,interpolator){return interpolator&&(this._interpolator=interpolator),this.setTimeFrame(delay,duration),this._a1=alpha,this}};GS.Behavior.extend(GS.AlphaBehavior,__GS_AlphaBehavior)}(),function(){var ret={x:0,y:0};GS.MoveBehavior=function(x0,y0,x1,y1,start,duration,id){return GS.MoveBehavior._superclass.constructor.call(this,start,duration,id),"undefined"!=typeof x0&&"undefined"!=typeof y0&&(this._fromValuesSet=!0),this._x0=x0,this._y0=y0,this._x1=x1,this._y1=y1,this};var __GS_MoveBehavior={__setForTime:function(time,actor){var x=this._x0+time*(this._x1-this._x0),y=this._y0+time*(this._y1-this._y0);return actor.x=x,actor.y=y,ret.x=x,ret.y=y,ret},__setInitialValues:function(actor){this._x0=actor.x,this._y0=actor.y},from:function(point){return this._fromValuesSet=!0,this._x0=point.x,this._y0=point.y,this},to:function(point,delay,duration,interpolator){return interpolator&&(this._interpolator=interpolator),this.setTimeFrame(delay,duration),this._x1=point.x,this._y1=point.y,this}};GS.Behavior.extend(GS.MoveBehavior,__GS_MoveBehavior)}(),function(){GS.ContainerBehavior=function(){return this};var __GS_ContainerBehaviorPrototype={};GS.Behavior.extend(GS.ContainerBehavior,__GS_ContainerBehaviorPrototype)}(),function(){var ret={x:0,y:0};GS.PathBehavior=function(path,start,duration,id){return GS.MoveBehavior._superclass.constructor.call(this,start,duration,id),this._fromValuesSet=!0,this._path=path,this};var __GS_PathBehavior={__setForTime:function(time,actor){var pos=this._path.getPosition(time,!1);return actor.x=pos.x,actor.y=pos.y,ret.x=pos.x,ret.y=pos.y,ret},__setInitialValues:function(){},from:function(){return this},to:function(path,delay,duration,interpolator){return interpolator&&(this._interpolator=interpolator),this.setTimeFrame(delay,duration),this._path=path,this}};GS.Behavior.extend(GS.PathBehavior,__GS_PathBehavior)}(),function(){var __index=0,Tween=function(tm,target,behavior){return this._tweenManager=tm,this._target=target||null,this._behavior=behavior||null,this._chain=null,this};Tween.prototype={__tween:function(Ctor){var bh=new Ctor;return bh._owner=this._tweenManager,this._chain&&bh.setChain(this._chain._behavior),this._behavior=bh,bh.setId(__index++),bh},tweenProperty:function(){return this.__tween(GS.PropertyBehavior)},tweenMove:function(){return this.__tween(GS.MoveBehavior)},tweenAlpha:function(){return this.__tween(GS.AlphaBehavior)},tweenPath:function(){return this.__tween(GS.PathBehavior)},tweenColor:function(){return this.__tween(GS.TintBehavior)},tick:function(elapsedTime){this._behavior.__apply(elapsedTime,this._target)},isFinished:function(){return this._behavior.isFinished()},pause:function(){this._behavior.pause(this._target)},resume:function(){this._behavior.resume(this._target)},setChain:function(tween){this._chain=tween},stop:function(){this._behavior.stop(this._target)}},GS.TweenManager=function(){this._tweens=[]},GS.TweenManager.prototype={tween:function(target,behavior){var tw=new Tween(this,target,behavior);return this._tweens.push(tw),tw},tweenTarget:function(target){var tween=new Tween(this,target);return this._tweens.push(tween),tween},tweenMove:function(){var tween=new Tween(this,this._tweens[this._tweens.length-1]._target);return this._tweens.push(tween),tween.tweenMove()},tweenAlpha:function(){var tween=new Tween(this,this._tweens[this._tweens.length-1]._target);return this._tweens.push(tween),tween.tweenAlpha()},tweenPath:function(){var tween=new Tween(this,this._tweens[this._tweens.length-1]._target);return this._tweens.push(tween),tween.tweenPath()},tweenColor:function(){var tween=new Tween(this,this._tweens[this._tweens.length-1]._target);return this._tweens.push(tween),tween.tweenColor()},tweenProperty:function(){var tween=new Tween(this,this._tweens[this._tweens.length-1]._target);return this._tweens.push(tween),tween.tweenProperty()},then:function(){var ltw=this._tweens[this._tweens.length-1],tw=this.tweenTarget(ltw._target);return tw.setChain(ltw),tw},tick:function(elapsedTime){var i,someTweenFinished=!1;for(i=0;i<this._tweens.length;i++)this._tweens[i].tick(elapsedTime),this._tweens[i].isFinished()&&(someTweenFinished=!0);if(someTweenFinished){var tweens=[];for(i=0;i<this._tweens.length;i++)this._tweens[i].isFinished()||tweens.push(this._tweens[i]);this._tweens=tweens}},pauseAll:function(){for(var i=0;i<this._tweens.length;i++)this._tweens[i].pause()},resumeAll:function(){for(var i=0;i<this._tweens.length;i++)this._tweens[i].resume()},stopAllTweens:function(){for(var i=0;i<this._tweens.length;i++)this._tweens[i].stop()},stopTween:function(id,checkAll){for(var i=0;i<this._tweens.length;i++)if(this._tweens[i]._behavior.id===id&&(this._tweens[i].stop(),!checkAll))return},setTarget:function(target){for(var i=0;i<this._tweens.length;i++){var tween=this._tweens[i];tween._behavior._currentTime=0,tween._target=target}},addTweenManager:function(tm){for(var i=0;i<tm._tweens.length;i++)this._tweens.push(tm._tweens[i]);return this},getLastTween:function(){return this._tweens[this._tweens.length-1]}}}(),function(){"use strict";var Uniform=function(name,type,value){return this._name=name,this._type=type,this.value=value,this._prevValue=null,this._location=null,this.setLocation=function(l){this._location=l},this.setValue=function(gl){var v=this.value;this._prevValue===v,"t"===this._type?(gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,v),gl.uniform1i(this._location,0)):"m4v"===this._type?gl.uniformMatrix4fv(this._location,!1,v):gl["uniform"+this._type](this._location,v),this._prevValue=this.value},this},Attribute=function(name,location){return this._name=name,this.location=location,this.enable=function(gl){gl.enableVertexAttribArray(this.location)},this.disable=function(gl){gl.disableVertexAttribArray(this.location)},this};GS.WebGLShaderProgram=function(gl,shaderDefinition){return this._gl=gl,this._shaderProgram=null,this._uniforms=[],this._attributes=[],shaderDefinition?this.__initializeFromShaderDefinition(shaderDefinition):(this.__create(),this.useProgram(),this.__initialize(),this.notUseProgram()),this};var __GS_WebGLShaderProgramPrototype={__initializeFromShaderDefinition:function(shaderDef){var gl=this._gl;if(this._shaderProgram=gl.createProgram(),gl.attachShader(this._shaderProgram,this.__getShader(this._gl,"x-shader/x-vertex",shaderDef.vertexShader)),gl.attachShader(this._shaderProgram,this.__getShader(this._gl,"x-shader/x-fragment",shaderDef.fragmentShader)),gl.linkProgram(this._shaderProgram),gl.getError()&&console.log(gl.getProgramInfoLog(this._shaderProgram)),gl.useProgram(this._shaderProgram),shaderDef.uniforms)for(var uniformName in shaderDef.uniforms){var uniformDef=shaderDef.uniforms[uniformName],type=uniformDef.type,value=uniformDef.value,uniform=new Uniform(uniformName,type,value);uniform.setLocation(gl.getUniformLocation(this._shaderProgram,uniformName)),uniform.value=value,this._uniforms.push(uniform)}if(shaderDef.attributes)for(var attributeName in shaderDef.attributes){var attribute=(shaderDef.attributes[attributeName],new Attribute(attributeName,gl.getAttribLocation(this._shaderProgram,attributeName)));this._attributes.push(attribute)}},__getShader:function(gl,type,str){var shader;if("x-shader/x-fragment"===type)shader=gl.createShader(gl.FRAGMENT_SHADER);else{if("x-shader/x-vertex"!==type)return null;shader=gl.createShader(gl.VERTEX_SHADER)}return gl.shaderSource(shader,str),gl.compileShader(shader),gl.getShaderParameter(shader,gl.COMPILE_STATUS)?shader:(alert(gl.getShaderInfoLog(shader)),null)},__getFragmentShader:function(){},__getVertexShader:function(){},__create:function(){var gl=this._gl;return this._shaderProgram=gl.createProgram(),gl.attachShader(this._shaderProgram,this.__getVertexShader()),gl.attachShader(this._shaderProgram,this.__getFragmentShader()),gl.linkProgram(this._shaderProgram),gl.getError()&&console.log(gl.getProgramInfoLog(this._shaderProgram)),this},__initialize:function(){},useProgram:function(){this._gl.useProgram(this._shaderProgram);for(var i=0;i<this._attributes.length;i++)this._attributes[i].enable(this._gl);return this},notUseProgram:function(){for(var i=0;i<this._attributes.length;i++)this._attributes[i].disable(this._gl);return this},flushBuffersWithContent:function(){},setCustomUniforms:function(){for(var i=0;i<this._uniforms.length;i++)this._uniforms[i].setValue(this._gl)},findUniform:function(name){for(var i=0;i<this._uniforms.length;i++)if(this._uniforms[i]._name===name)return this._uniforms[i];return null},findAttribute:function(name){for(var i=0;i<this._attributes.length;i++)if(this._attributes[i]._name===name)return this._attributes[i];return null},updateUniformValues:function(){},mat4_from_mat3:function(mat3,__mat4){return __mat4[0]=mat3[0],__mat4[4]=mat3[1],__mat4[1]=mat3[3],__mat4[5]=mat3[4],__mat4[12]=mat3[2],__mat4[13]=mat3[5],__mat4}};GS.Object.extend(GS.WebGLShaderProgram,__GS_WebGLShaderProgramPrototype)}(),function(){"use strict";GS.WebGLTextureShaderProgram=function(gl){return GS.WebGLTextureShaderProgram._superclass.constructor.call(this,gl,{vertexShader:"attribute vec2 aVertexPosition; \nattribute vec2 aTextureCoord; \nattribute vec4 aColor; \nuniform vec2 uResolution; \nvarying vec2 vTextureCoord; \nvarying vec4 vAttrColor; \nvoid main(void) { \ngl_Position = vec4( aVertexPosition.x / (uResolution.x/2.0) -1.0 , aVertexPosition.y / -(uResolution.y/2.0) + 1.0, 0, 1.0 );\nvTextureCoord = aTextureCoord;\nvAttrColor = aColor;\n}\n",fragmentShader:"precision mediump float; \nvarying vec2 vTextureCoord; \nuniform sampler2D uSampler; \nvarying vec4 vAttrColor;\nvoid main(void) { \n  vec4 textureColor= texture2D(uSampler, vec2(vTextureCoord)); \n  gl_FragColor = textureColor * vAttrColor; \n}\n",attributes:{aVertexPosition:{},aTextureCoord:{},aColor:{}},uniforms:{uResolution:{type:"2fv",value:[0,0]},uSampler:{type:"t",value:null}}}),this._samplerUniform=this.findUniform("uSampler"),this._resolutionUniform=this.findUniform("uResolution"),this._attrPosition=this.findAttribute("aVertexPosition"),this._attrTexture=this.findAttribute("aTextureCoord"),this._attrColor=this.findAttribute("aColor"),this};var __GS_WebGLTextureSharedProgramPrototype={updateUniformValues:function(resolution,glTextureId){this._samplerUniform.value=glTextureId,this._resolutionUniform.value=resolution},flushBuffersWithContent:function(vertexPositionBuffer,vertexPositionArray,vertexColorBuffer,vertexColorArray,vertexUVBuffer,vertexUVArray,vertexIndexBuffer,vertexIndexArray,numVertex){var gl=this._gl;gl.bindBuffer(gl.ARRAY_BUFFER,vertexPositionBuffer),gl.bufferSubData(gl.ARRAY_BUFFER,0,vertexPositionArray),gl.vertexAttribPointer(this._attrPosition.location,2,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,vertexColorBuffer),gl.bufferSubData(gl.ARRAY_BUFFER,0,vertexColorArray),gl.vertexAttribPointer(this._attrColor.location,4,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,vertexUVBuffer),gl.bufferSubData(gl.ARRAY_BUFFER,0,vertexUVArray),gl.vertexAttribPointer(this._attrTexture.location,2,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,vertexIndexBuffer),gl.bufferSubData(gl.ELEMENT_ARRAY_BUFFER,0,vertexIndexArray),gl.drawElements(gl.TRIANGLES,numVertex,gl.UNSIGNED_SHORT,0)}};GS.WebGLShaderProgram.extend(GS.WebGLTextureShaderProgram,__GS_WebGLTextureSharedProgramPrototype)}(),function(){"use strict";var mat=GS.FloatArray(16,0);mat[0]=1,mat[5]=1,mat[10]=1,mat[15]=1,GS.WebGLGeometryColorShaderProgram=function(gl,ortho){return GS.WebGLGeometryColorShaderProgram._superclass.constructor.call(this,gl,{vertexShader:"attribute vec2 aVertexPosition; \nattribute vec4 aColor; \nuniform mat4 uOrtho; \nuniform mat4 uTransform; \nvarying vec4 vAttrColor; \nvoid main(void) { \ngl_Position = uOrtho * uTransform * vec4( aVertexPosition.x, aVertexPosition.y, 0.0, 1.0 );\nvAttrColor = aColor;\n}\n",fragmentShader:"precision mediump float; \nvarying vec4 vAttrColor;\nvoid main(void) { \n  gl_FragColor = vAttrColor; \n}\n",uniforms:{uOrtho:{type:"m4v",value:ortho},uTransform:{type:"m4v",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},attributes:{aVertexPosition:{},aColor:{}}}),this._uniformMatrix=this.findUniform("uTransform"),this._attributePosition=this.findAttribute("aVertexPosition"),this._attributeColor=this.findAttribute("aColor"),this};var __GS_WebGLGeometryColorShaderProgramPrototype={updateUniformValues:function(matrix){matrix&&(mat[0]=matrix[0],mat[4]=matrix[1],mat[1]=matrix[3],mat[5]=matrix[4],mat[12]=matrix[2],mat[13]=matrix[5]),this._uniformMatrix.value=mat},flushBuffersWithContent:function(vertexPositionBuffer,vertexPositionArray,vertexColorBuffer,vertexColorArray,vertexIndexBuffer,vertexIndexArray,numVertex){var gl=this._gl;gl.bindBuffer(gl.ARRAY_BUFFER,vertexPositionBuffer),gl.bufferSubData(gl.ARRAY_BUFFER,0,vertexPositionArray),gl.vertexAttribPointer(this._attributePosition.location,2,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,vertexColorBuffer),gl.bufferSubData(gl.ARRAY_BUFFER,0,vertexColorArray),gl.vertexAttribPointer(this._attributeColor.location,4,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,vertexIndexBuffer),gl.bufferSubData(gl.ELEMENT_ARRAY_BUFFER,0,vertexIndexArray),gl.drawElements(gl.TRIANGLES,numVertex,gl.UNSIGNED_SHORT,0)}};GS.WebGLShaderProgram.extend(GS.WebGLGeometryColorShaderProgram,__GS_WebGLGeometryColorShaderProgramPrototype)}(),function(){"use strict";var mat=GS.FloatArray(16,0);mat[0]=1,mat[5]=1,mat[10]=1,mat[15]=1;var mat2=GS.FloatArray(16,0);mat2[0]=1,mat2[5]=1,mat2[10]=1,mat2[15]=1;var mat3=GS.Math.Matrix.create();GS.WebGLPatternShaderProgram=function(gl,ortho,type){return GS.WebGLPatternShaderProgram._superclass.constructor.call(this,gl,{vertexShader:"precision mediump float;               \nattribute vec2 aVertexPosition;        \nattribute vec4 aColor; \nuniform vec2 uResolution;              \nuniform mediump vec2 uCoordBounds;             \nuniform mediump vec2 uCoordPosBounds;          \nuniform mediump mat4 uOrtho;                   \nuniform mediump mat4 uTransform;               \nuniform mediump mat4 uPatternTransform;        \nuniform mediump vec2 uPatternBounds;           \nvarying mediump vec2 v_texCoord;               \nvarying float alpha;\nvec4 avp= vec4( aVertexPosition, 0, 1);\nvoid main(void) { \ngl_Position = uOrtho * uTransform * avp;	\nv_texCoord = (uPatternTransform * avp).xy / uPatternBounds * uCoordBounds;     \nalpha= aColor.w;\n}\n",fragmentShader:this.__getFragmentShader(type),uniforms:{uCoordBounds:{type:"2fv",value:[0,0]},uCoordPosBounds:{type:"2fv",value:[0,0]},uOrtho:{type:"m4v",value:ortho},uTransform:{type:"m4v",value:mat},uPatternTransform:{type:"m4v",value:mat},uPatternBounds:{type:"2fv",value:[0,0]},uColor:{type:"4fv",value:[1,1,1,1]},uSampler:{type:"t",value:null}},attributes:{aVertexPosition:{},aColor:{}}}),this._uCoordBounds=this.findUniform("uCoordBounds"),this._uCoordPosBounds=this.findUniform("uCoordPosBounds"),this._uOrtho=this.findUniform("uOrtho"),this._uModelView=this.findUniform("uTransform"),this._uPatternTransform=this.findUniform("uPatternTransform"),this._uPatternBounds=this.findUniform("uPatternBounds"),this._uColor=this.findUniform("uColor"),this._uSampler=this.findUniform("uSampler"),this._attrPosition=this.findAttribute("aVertexPosition"),this._attrColor=this.findAttribute("aColor"),this};var __GS_WebGLPatternShaderProgramPrototype={__getFragmentShader:function(type){switch(type){case"repeat-x":return this.__getFragmentShaderRepeatX();case"repeat-y":return this.__getFragmentShaderRepeatY();case"no-repeat":return this.__getFragmentShaderNoRepeat();default:return this.__getFragmentShaderRepeat()}},__getFragmentShaderRepeatX:function(){return"precision mediump float; \nuniform vec4 uColor;              \nuniform mediump vec2 uCoordBounds;        \nuniform mediump vec2 uCoordPosBounds;        \nvarying mediump vec2 v_texCoord;          \nuniform sampler2D uSampler;       \nvarying float alpha;\nvoid main() {							\n    vec4 c= uColor* vec4( 1,1,1,alpha) ; \n    if ( v_texCoord.y<0. ||v_texCoord.y > uCoordBounds.y ) c= vec4(0); \n    gl_FragColor = texture2D(uSampler,    vec2(   mod(v_texCoord.x,uCoordBounds.x)+ uCoordPosBounds.x,            v_texCoord.y + uCoordPosBounds.y) ) * c ; \n}\n"},__getFragmentShaderRepeatY:function(){return"precision mediump float; \nuniform vec4 uColor;              \nuniform mediump vec2 uCoordBounds;        \nuniform mediump vec2 uCoordPosBounds;        \nvarying mediump vec2 v_texCoord;          \nuniform sampler2D uSampler;       \nvarying float alpha;\nvoid main() {							\n    vec4 c= uColor* vec4( 1,1,1,alpha) ; \n    if ( v_texCoord.x<0. ||v_texCoord.x > uCoordBounds.x ) c= vec4(0); \n    gl_FragColor = texture2D(uSampler,    vec2(   v_texCoord.x + uCoordPosBounds.x,           mod(v_texCoord.y,uCoordBounds.y)+ uCoordPosBounds.y ) ) * c ; \n}\n"},__getFragmentShaderNoRepeat:function(){return"precision mediump float; \nuniform vec4 uColor;              \nuniform mediump vec2 uCoordBounds;        \nuniform mediump vec2 uCoordPosBounds;        \nvarying mediump vec2 v_texCoord;          \nuniform sampler2D uSampler;       \nvarying float alpha;\nvoid main() {							\n    vec4 c= uColor* vec4( 1,1,1,alpha) ; \n    if ( v_texCoord.x<0. || v_texCoord.x >  uCoordBounds.x ) c= vec4(0); \n    if ( v_texCoord.y<0. || v_texCoord.y >  uCoordBounds.y ) c= vec4(0); \n    gl_FragColor = texture2D(uSampler, v_texCoord + uCoordPosBounds ) * c ; \n}\n"},__getFragmentShaderRepeat:function(){return"precision mediump float; \nuniform vec4 uColor;\nuniform mediump vec2 uCoordBounds;\nuniform mediump vec2 uCoordPosBounds;\nvarying mediump vec2 v_texCoord;\nuniform sampler2D uSampler;\nvarying float alpha;\nvoid main() {\n    gl_FragColor = texture2D(uSampler, mod(v_texCoord,uCoordBounds)+ uCoordPosBounds ) * uColor * vec4( 1,1,1,alpha) ; \n}\n"},updateUniformValues:function(pattern,modelViewMatrix,patternMatrix){this._uSampler.value=pattern.spriteImageData._owner._textureId,this._uPatternBounds.value=[pattern.spriteImageData._width,pattern.spriteImageData._height],this._uCoordBounds.value=[pattern.spriteImageData._u1-pattern.spriteImageData._u0,pattern.spriteImageData._v1-pattern.spriteImageData._v0],this._uCoordPosBounds.value=[pattern.spriteImageData._u0,pattern.spriteImageData._v0],mat[0]=modelViewMatrix[0],mat[4]=modelViewMatrix[1],mat[1]=modelViewMatrix[3],mat[5]=modelViewMatrix[4],mat[12]=modelViewMatrix[2],mat[13]=modelViewMatrix[5],this._uModelView.value=mat,GS.Math.Matrix.copy(modelViewMatrix,mat3),GS.Math.Matrix.multiply(mat3,GS.Math.Matrix.inverse(patternMatrix)),mat2[0]=mat3[0],mat2[4]=mat3[1],mat2[1]=mat3[3],mat2[5]=mat3[4],mat2[12]=mat3[2],mat2[13]=mat3[5],this._uPatternTransform.value=mat2},flushBuffersWithContent:function(vertexPositionBuffer,vertexPositionArray,vertexColorBuffer,vertexColorArray,vertexIndexBuffer,vertexIndexArray,numTris){var gl=this._gl;gl.bindBuffer(gl.ARRAY_BUFFER,vertexPositionBuffer),gl.bufferSubData(gl.ARRAY_BUFFER,0,vertexPositionArray),gl.vertexAttribPointer(this._attrPosition.location,2,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,vertexColorBuffer),gl.bufferSubData(gl.ARRAY_BUFFER,0,vertexColorArray),gl.vertexAttribPointer(this._attrColor.location,4,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,vertexIndexBuffer),gl.bufferSubData(gl.ELEMENT_ARRAY_BUFFER,0,vertexIndexArray),gl.drawElements(gl.TRIANGLES,numTris,gl.UNSIGNED_SHORT,0)}};GS.WebGLShaderProgram.extend(GS.WebGLPatternShaderProgram,__GS_WebGLPatternShaderProgramPrototype)}(),function(){"use strict";var mat=GS.FloatArray(16,0);mat[0]=1,mat[5]=1,mat[10]=1,mat[15]=1;var mat2=GS.FloatArray(16,0);mat2[0]=1,mat2[5]=1,mat2[10]=1,mat2[15]=1,GS.WebGLLinearGradientShaderProgram=function(gl,ortho){return GS.WebGLLinearGradientShaderProgram._superclass.constructor.call(this,gl,{vertexShader:"precision mediump float;               \nattribute vec2 aVertexPosition;        \nattribute vec4 aColor;        \nuniform  mat4 uOrtho;                  \nuniform  mat4 uModelViewTransform;     \nuniform  mat4 uGradientTransform;      \nvarying  float v_alpha;\nvarying  vec2 v_uv;                    \nvoid main(void) { \nvec4 vv4= vec4( aVertexPosition, 0.0, 1.0 ); \ngl_Position = uOrtho * uModelViewTransform * vv4;	\nv_uv= ((uGradientTransform * uModelViewTransform * vv4).xy);   \nv_alpha= aColor.w;\n}\n",fragmentShader:"precision mediump float; \nuniform  mat4 uColorStop;        \nuniform  mat4 uColor[4];        \nvarying  vec2 v_uv;                \nvarying  float v_alpha;\nvoid main() {						\nfloat uColorStop0=  uColorStop[0].r;        \nfloat uColorStop1=  uColorStop[0].g;        \nfloat uColorStop2=  uColorStop[0].b;        \nfloat uColorStop3=  uColorStop[0].w;        \nfloat uColorStop4=  uColorStop[1].r;        \nfloat uColorStop5=  uColorStop[1].g;        \nfloat uColorStop6=  uColorStop[1].b;        \nfloat uColorStop7=  uColorStop[1].w;        \nfloat uColorStop8=  uColorStop[2].r;        \nfloat uColorStop9=  uColorStop[2].g;        \nfloat uColorStop10= uColorStop[2].b;        \nfloat uColorStop11= uColorStop[2].w;        \nfloat uColorStop12= uColorStop[3].r;        \nfloat uColorStop13= uColorStop[3].g;        \nfloat uColorStop14= uColorStop[3].b;        \nfloat uColorStop15= uColorStop[3].w;        \nvec4 uColor0=  uColor[0][0];             \nvec4 uColor1=  uColor[0][1];             \nvec4 uColor2=  uColor[0][2];             \nvec4 uColor3=  uColor[0][3];             \nvec4 uColor4=  uColor[1][0];             \nvec4 uColor5=  uColor[1][1];             \nvec4 uColor6=  uColor[1][2];             \nvec4 uColor7=  uColor[1][3];             \nvec4 uColor8=  uColor[2][0];             \nvec4 uColor9=  uColor[2][1];             \nvec4 uColor10= uColor[2][2];             \nvec4 uColor11= uColor[2][3];             \nvec4 uColor12= uColor[3][0];             \nvec4 uColor13= uColor[3][1];             \nvec4 uColor14= uColor[3][2];             \nvec4 uColor15= uColor[3][3];             \nfloat t = v_uv.x;\nvec4 color; \nif (t <= uColorStop0) {\n   color = uColor0; \n} \nelse if (t < uColorStop1) \n{ \n   float tLocal = (t - uColorStop0)/(uColorStop1 - uColorStop0); \n   color = mix(uColor0,uColor1,tLocal); \n} \nelse if (t < uColorStop2) \n{ \n   float tLocal = (t - uColorStop1)/(uColorStop2 - uColorStop1); \n   color = mix(uColor1,uColor2,tLocal); \n} \nelse if (t < uColorStop3) \n{ \n   float tLocal = (t - uColorStop2)/(uColorStop3 - uColorStop2); \n   color = mix(uColor2,uColor3,tLocal); \n} \nelse if (t < uColorStop4) \n{ \n   float tLocal = (t - uColorStop3)/(uColorStop4 - uColorStop3); \n   color = mix(uColor3,uColor4,tLocal); \n} \nelse if (t < uColorStop5) \n{ \n   float tLocal = (t - uColorStop4)/(uColorStop5 - uColorStop4); \n   color = mix(uColor4,uColor5,tLocal); \n} \nelse if (t < uColorStop6) \n{ \n   float tLocal = (t - uColorStop5)/(uColorStop6 - uColorStop5); \n   color = mix(uColor5,uColor6,tLocal); \n} \nelse if (t < uColorStop7) \n{ \n   float tLocal = (t - uColorStop6)/(uColorStop7 - uColorStop6); \n   color = mix(uColor6,uColor7,tLocal); \n} \nelse if (t < uColorStop8) \n{ \n   float tLocal = (t - uColorStop7)/(uColorStop8 - uColorStop7); \n   color = mix(uColor7,uColor8,tLocal); \n} \nelse if (t < uColorStop9) \n{ \n   float tLocal = (t - uColorStop8)/(uColorStop9 - uColorStop8); \n   color = mix(uColor8,uColor9,tLocal); \n} \nelse if (t < uColorStop10) \n{ \n   float tLocal = (t - uColorStop9)/(uColorStop10 - uColorStop9); \n   color = mix(uColor9,uColor10,tLocal); \n} \nelse if (t < uColorStop11) \n{ \n   float tLocal = (t - uColorStop10)/(uColorStop11 - uColorStop10); \n   color = mix(uColor10,uColor11,tLocal); \n} \nelse if (t < uColorStop12) \n{ \n   float tLocal = (t - uColorStop11)/(uColorStop12 - uColorStop11); \n   color = mix(uColor11,uColor12,tLocal); \n} \nelse if (t < uColorStop13) \n{ \n   float tLocal = (t - uColorStop12)/(uColorStop13 - uColorStop12); \n   color = mix(uColor12,uColor13,tLocal); \n} \nelse if (t < uColorStop14) \n{ \n   float tLocal = (t - uColorStop13)/(uColorStop14 - uColorStop13); \n   color = mix(uColor13,uColor14,tLocal); \n} \nelse {\n   color = uColor15; \n} \ngl_FragColor =color * vec4(1,1,1,v_alpha);                 \n}                                  \n",uniforms:{uOrtho:{type:"m4v",value:ortho},uModelViewTransform:{type:"m4v",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},uGradientTransform:{type:"m4v",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},uColor:{type:"m4v",value:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},uColorStop:{type:"m4v",value:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},attributes:{aVertexPosition:{},aColor:{}}}),this._attributePosition=this.findAttribute("aVertexPosition"),this._attributeColor=this.findAttribute("aColor"),this._uOrtho=this.findUniform("uOrtho"),this._uModelViewTransform=this.findUniform("uModelViewTransform"),this._uGradientTransform=this.findUniform("uGradientTransform"),this._uColor=this.findUniform("uColor"),this._uColorStop=this.findUniform("uColorStop"),this
};var __GS_WebGLLinearGradientShaderProgramPrototype={updateUniformValues:function(gradientInfo,modelViewMatrix,gradientMatrix){var _mat=(this._gl,modelViewMatrix),_matg=gradientMatrix;mat[0]=_mat[0],mat[4]=_mat[1],mat[1]=_mat[3],mat[5]=_mat[4],mat[12]=_mat[2],mat[13]=_mat[5];var g0=new GS.Point(gradientInfo.x0,gradientInfo.y0),g1=new GS.Point(gradientInfo.x1,gradientInfo.y1);GS.Math.Matrix.transformPoint(g0,_matg),GS.Math.Matrix.transformPoint(g1,_matg);var angle=Math.atan((g1.y-g0.y)/(g1.x-g0.x)),mr=GS.Math.Matrix.createRotate(-angle),sx=g1.x-g0.x,sy=g1.y-g0.y,ss=1/Math.sqrt(sx*sx+sy*sy)*(g1.x>=g0.x?1:-1),ms=GS.Math.Matrix.createScale(ss,ss),mt=GS.Math.Matrix.createTranslate(-g0.x,-g0.y);GS.Math.Matrix.multiply(mr,ms),GS.Math.Matrix.multiply(mr,mt),mat2[0]=mr[0],mat2[4]=mr[1],mat2[1]=mr[3],mat2[5]=mr[4],mat2[12]=mr[2],mat2[13]=mr[5],this._uModelViewTransform.value=mat,this._uGradientTransform.value=mat2,this._uColor.value=gradientInfo.getColorArray(),this._uColorStop.value=gradientInfo.getColorStopArray()},flushBuffersWithContent:function(vertexPositionBuffer,vertexPositionArray,vertexColorBuffer,vertexColorArray,vertexIndexBuffer,vertexIndexArray,numVertex){var gl=this._gl;gl.bindBuffer(gl.ARRAY_BUFFER,vertexPositionBuffer),gl.bufferSubData(gl.ARRAY_BUFFER,0,vertexPositionArray),gl.vertexAttribPointer(this._attributePosition.location,2,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,vertexColorBuffer),gl.bufferSubData(gl.ARRAY_BUFFER,0,vertexColorArray),gl.vertexAttribPointer(this._attributeColor.location,4,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,vertexIndexBuffer),gl.bufferSubData(gl.ELEMENT_ARRAY_BUFFER,0,vertexIndexArray),gl.drawElements(gl.TRIANGLES,numVertex,gl.UNSIGNED_SHORT,0)}};GS.WebGLShaderProgram.extend(GS.WebGLLinearGradientShaderProgram,__GS_WebGLLinearGradientShaderProgramPrototype)}(),function(){"use strict";var mat=GS.FloatArray(16,0);mat[0]=1,mat[5]=1,mat[10]=1,mat[15]=1;var mat2=GS.FloatArray(16,0);mat2[0]=1,mat2[5]=1,mat2[10]=1,mat2[15]=1,GS.WebGLRadialGradientShaderProgram=function(gl,ortho){return GS.WebGLRadialGradientShaderProgram._superclass.constructor.call(this,gl,{vertexShader:"precision mediump float;               \nattribute vec2 aVertexPosition;        \nattribute vec4 aColor;        \nuniform  mat4 uOrtho;                  \nuniform  mat4 uModelViewTransform;     \nuniform  mat4 uGradientTransform;      \nvarying  vec2 v_uv;                    \nvarying  float v_alpha;                    \nvoid main(void) { \nvec4 vv4= vec4( aVertexPosition, 0.0, 1.0 ); \ngl_Position = uOrtho * uModelViewTransform * vv4;	\nv_uv= (uGradientTransform * uModelViewTransform * vv4).xy;   \nv_alpha= aColor.w;\n}\n",fragmentShader:"precision mediump float; \nuniform  mat4 uColorStop;        \nuniform  mat4 uColor[4];        \nuniform  mat4 uGradientTransform;      \nuniform  vec2 uFocalPoint;         \nuniform  vec2 uCenterPoint;        \nuniform  float uRadiusInner;       \nvarying  vec2 v_uv;                \nvarying  float v_alpha;            \nfloat gradient(vec2 cp, vec2 fp, float radius) {       \nfloat fxp= cp.x - fp.x;                            \nfloat fyp= cp.y - fp.y;                            \nfloat dx= v_uv.x - cp.x;                           \nfloat dy= v_uv.y - cp.y;                           \nfloat df= dx*fyp - dy*fxp;                         \nfloat det= radius*radius*(dx*dx + dy*dy) - (df*df);\nfloat den= (radius*radius - (fxp*fxp + fyp*fyp));  \nfloat t= -1.0;                                     \nif ( den!=0.0 && det>=0. ) {                       \n   t = (dx*fxp + dy*fyp + sqrt(det)) / den;        \n}                                                  \nreturn t;                                          \n}                                                      \nvoid main() {						\nfloat uColorStop0=  uColorStop[0].r;        \nfloat uColorStop1=  uColorStop[0].g;        \nfloat uColorStop2=  uColorStop[0].b;        \nfloat uColorStop3=  uColorStop[0].w;        \nfloat uColorStop4=  uColorStop[1].r;        \nfloat uColorStop5=  uColorStop[1].g;        \nfloat uColorStop6=  uColorStop[1].b;        \nfloat uColorStop7=  uColorStop[1].w;        \nfloat uColorStop8=  uColorStop[2].r;        \nfloat uColorStop9=  uColorStop[2].g;        \nfloat uColorStop10= uColorStop[2].b;        \nfloat uColorStop11= uColorStop[2].w;        \nfloat uColorStop12= uColorStop[3].r;        \nfloat uColorStop13= uColorStop[3].g;        \nfloat uColorStop14= uColorStop[3].b;        \nfloat uColorStop15= uColorStop[3].w;        \nvec4 uColor0=  uColor[0][0];             \nvec4 uColor1=  uColor[0][1];             \nvec4 uColor2=  uColor[0][2];             \nvec4 uColor3=  uColor[0][3];             \nvec4 uColor4=  uColor[1][0];             \nvec4 uColor5=  uColor[1][1];             \nvec4 uColor6=  uColor[1][2];             \nvec4 uColor7=  uColor[1][3];             \nvec4 uColor8=  uColor[2][0];             \nvec4 uColor9=  uColor[2][1];             \nvec4 uColor10= uColor[2][2];             \nvec4 uColor11= uColor[2][3];             \nvec4 uColor12= uColor[3][0];             \nvec4 uColor13= uColor[3][1];             \nvec4 uColor14= uColor[3][2];             \nvec4 uColor15= uColor[3][3];             \nvec3 x0y0r0= vec3( uCenterPoint.x, uCenterPoint.y, uRadiusInner );\nvec3 dxdydr= vec3( uFocalPoint.x - uCenterPoint.x, uFocalPoint.y - uCenterPoint.y, 1.0 - uRadiusInner );\nvec2 p2 = v_uv - x0y0r0.xy;\nfloat A = dxdydr.x * dxdydr.x + dxdydr.y * dxdydr.y - dxdydr.z * dxdydr.z;\nfloat B = dot(p2.xy, dxdydr.xy) + x0y0r0.z * dxdydr.z;\nfloat C = dot(p2, p2) - (x0y0r0.z * x0y0r0.z);\nfloat t;\nif (abs(A) > 0.0000001) {\nfloat D = (B * B) - (A * C);\nif (D < 0.0) {\ngl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nt = (B + sqrt(D)) / A;\nfloat r = (dxdydr.z * t) + x0y0r0.z;\nif (r < 0.0) {\nt = (B - sqrt(D)) / A;\nr = (dxdydr.z * t) + x0y0r0.z;\nif (r < 0.0) {\ngl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\n}\n} else { // A == 0\nt = 0.5 * C / B;\nfloat r = (dxdydr.z * t) + x0y0r0.z;\nif (r < 0.0) {\ngl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\n}\nvec4 color; \nif (t < uColorStop0) \n   color = uColor0; \nelse if (t < uColorStop1) \n{ \n   float tLocal = (t - uColorStop0)/(uColorStop1 - uColorStop0); \n   color = mix(uColor0,uColor1,tLocal); \n} \nelse if (t < uColorStop2) \n{ \n   float tLocal = (t - uColorStop1)/(uColorStop2 - uColorStop1); \n   color = mix(uColor1,uColor2,tLocal); \n} \nelse if (t < uColorStop3) \n{ \n   float tLocal = (t - uColorStop2)/(uColorStop3 - uColorStop2); \n   color = mix(uColor2,uColor3,tLocal); \n} \nelse if (t < uColorStop4) \n{ \n   float tLocal = (t - uColorStop3)/(uColorStop4 - uColorStop3); \n   color = mix(uColor3,uColor4,tLocal); \n} \nelse if (t < uColorStop5) \n{ \n   float tLocal = (t - uColorStop4)/(uColorStop5 - uColorStop4); \n   color = mix(uColor4,uColor5,tLocal); \n} \nelse if (t < uColorStop6) \n{ \n   float tLocal = (t - uColorStop5)/(uColorStop6 - uColorStop5); \n   color = mix(uColor5,uColor6,tLocal); \n} \nelse if (t < uColorStop7) \n{ \n   float tLocal = (t - uColorStop6)/(uColorStop7 - uColorStop6); \n   color = mix(uColor6,uColor7,tLocal); \n} \nelse if (t < uColorStop8) \n{ \n   float tLocal = (t - uColorStop7)/(uColorStop8 - uColorStop7); \n   color = mix(uColor7,uColor8,tLocal); \n} \nelse if (t < uColorStop9) \n{ \n   float tLocal = (t - uColorStop8)/(uColorStop9 - uColorStop8); \n   color = mix(uColor8,uColor9,tLocal); \n} \nelse if (t < uColorStop10) \n{ \n   float tLocal = (t - uColorStop9)/(uColorStop10 - uColorStop9); \n   color = mix(uColor9,uColor10,tLocal); \n} \nelse if (t < uColorStop11) \n{ \n   float tLocal = (t - uColorStop10)/(uColorStop11 - uColorStop10); \n   color = mix(uColor10,uColor11,tLocal); \n} \nelse if (t < uColorStop12) \n{ \n   float tLocal = (t - uColorStop11)/(uColorStop12 - uColorStop11); \n   color = mix(uColor11,uColor12,tLocal); \n} \nelse if (t < uColorStop13) \n{ \n   float tLocal = (t - uColorStop12)/(uColorStop13 - uColorStop12); \n   color = mix(uColor12,uColor13,tLocal); \n} \nelse if (t < uColorStop14) \n{ \n   float tLocal = (t - uColorStop13)/(uColorStop14 - uColorStop13); \n   color = mix(uColor13,uColor14,tLocal); \n} \nelse {\n   color = uColor15; \n} \ngl_FragColor =color * vec4(1,1,1,v_alpha);                 \n}                                  \n",uniforms:{uOrtho:{type:"m4v",value:ortho},uModelViewTransform:{type:"m4v",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},uGradientTransform:{type:"m4v",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},uColor:{type:"m4v",value:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},uColorStop:{type:"m4v",value:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},uFocalPoint:{type:"2fv",value:[0,0]},uCenterPoint:{type:"2fv",value:[0,0]},uRadiusInner:{type:"1f",value:0}},attributes:{aVertexPosition:{},aColor:{}}}),this._attributePosition=this.findAttribute("aVertexPosition"),this._attributeColor=this.findAttribute("aColor"),this._uOrtho=this.findUniform("uOrtho"),this._uModelViewTransform=this.findUniform("uModelViewTransform"),this._uGradientTransform=this.findUniform("uGradientTransform"),this._uColor=this.findUniform("uColor"),this._uColorStop=this.findUniform("uColorStop"),this._uFocalPoint=this.findUniform("uFocalPoint"),this._uCenterPoint=this.findUniform("uCenterPoint"),this._uRadiusInner=this.findUniform("uRadiusInner"),this};var __GS_WebGLRadialGradientShaderProgramPrototype={updateUniformValues:function(gradientInfo,modelViewMatrix,gradientMatrix){var _mat=(this._gl,modelViewMatrix),_matg=gradientMatrix;mat[0]=_mat[0],mat[4]=_mat[1],mat[1]=_mat[3],mat[5]=_mat[4],mat[12]=_mat[2],mat[13]=_mat[5];var center=new GS.Point(gradientInfo.x0,gradientInfo.y0),focal=new GS.Point(gradientInfo.x1,gradientInfo.y1);GS.Math.Matrix.transformPoint(center,_matg),GS.Math.Matrix.transformPoint(focal,_matg);var ms=GS.Math.Matrix.createScale(1/gradientInfo.r1,1/gradientInfo.r1);GS.Math.Matrix.multiply(ms,GS.Math.Matrix.inverse(_matg)),mat2[0]=ms[0],mat2[4]=ms[1],mat2[1]=ms[3],mat2[5]=ms[4],mat2[12]=ms[2],mat2[13]=ms[5],GS.Math.Matrix.transformPoint(focal,ms),GS.Math.Matrix.transformPoint(center,ms);var r0=new GS.Point(0,0),r1=new GS.Point(0,gradientInfo.r1);GS.Math.Matrix.transformPoint(r0,ms),GS.Math.Matrix.transformPoint(r1,ms);var r=Math.sqrt((r1.x-r0.x)*(r1.x-r0.x)+(r1.y-r0.y)*(r1.y-r0.y));r0=new GS.Point(0,0),r1=new GS.Point(0,gradientInfo.r0),GS.Math.Matrix.transformPoint(r0,ms),GS.Math.Matrix.transformPoint(r1,ms);var r2=Math.sqrt((r1.x-r0.x)*(r1.x-r0.x)+(r1.y-r0.y)*(r1.y-r0.y));this._uModelViewTransform.value=mat,this._uGradientTransform.value=mat2,this._uFocalPoint.value=[focal.x,focal.y],this._uCenterPoint.value=[center.x,center.y],this._uRadiusInner.value=r2/r,this._uColor.value=gradientInfo.getColorArray(),this._uColorStop.value=gradientInfo.getColorStopArray()},flushBuffersWithContent:function(vertexPositionBuffer,vertexPositionArray,vertexColorBuffer,vertexColorArray,vertexIndexBuffer,vertexIndexArray,numVertex){var gl=this._gl;gl.bindBuffer(gl.ARRAY_BUFFER,vertexPositionBuffer),gl.bufferSubData(gl.ARRAY_BUFFER,0,vertexPositionArray),gl.vertexAttribPointer(this._attributePosition.location,2,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,vertexColorBuffer),gl.bufferSubData(gl.ARRAY_BUFFER,0,vertexColorArray),gl.vertexAttribPointer(this._attributeColor.location,4,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,vertexIndexBuffer),gl.bufferSubData(gl.ELEMENT_ARRAY_BUFFER,0,vertexIndexArray),gl.drawElements(gl.TRIANGLES,numVertex,gl.UNSIGNED_SHORT,0)}};GS.WebGLShaderProgram.extend(GS.WebGLRadialGradientShaderProgram,__GS_WebGLRadialGradientShaderProgramPrototype)}(),function(){"use strict";GS.WebGLTextureAlphaThresholdShaderProgram=function(gl){return GS.WebGLTextureAlphaThresholdShaderProgram._superclass.constructor.call(this,gl,{vertexShader:"attribute vec2 aVertexPosition; \nattribute vec2 aTextureCoord; \nattribute vec4 aColor; \nuniform vec2 uResolution; \nvarying vec2 vTextureCoord; \nvarying vec4 vAttrColor; \nvoid main(void) { \ngl_Position = vec4( aVertexPosition.x / (uResolution.x/2.0) -1.0 , aVertexPosition.y / -(uResolution.y/2.0) + 1.0, 0, 1.0 );\nvTextureCoord = aTextureCoord;\nvAttrColor = aColor;\n}\n",fragmentShader:"precision mediump float; \nvarying vec2 vTextureCoord; \nuniform sampler2D uSampler; \nvarying vec4 vAttrColor;\nvoid main(void) { \n  vec4 textureColor= texture2D(uSampler, vec2(vTextureCoord)); \n  if (textureColor.w==0.) discard;\n  gl_FragColor = textureColor; \n}\n",attributes:{aVertexPosition:{},aTextureCoord:{},aColor:{}},uniforms:{uResolution:{type:"2fv",value:[0,0]},uSampler:{type:"t",value:null}}}),this._samplerUniform=this.findUniform("uSampler"),this._resolutionUniform=this.findUniform("uResolution"),this._attrPosition=this.findAttribute("aVertexPosition"),this._attrTexture=this.findAttribute("aTextureCoord"),this._attrColor=this.findAttribute("aColor"),this};var __GS_WebGLTextureAlphaThresholdShaderProgramPrototype={updateUniformValues:function(resolution,glTextureId){this._samplerUniform.value=glTextureId,this._resolutionUniform.value=resolution},flushBuffersWithContent:function(vertexPositionBuffer,vertexPositionArray,vertexColorBuffer,vertexColorArray,vertexUVBuffer,vertexUVArray,vertexIndexBuffer,vertexIndexArray,numVertex){var gl=this._gl;gl.bindBuffer(gl.ARRAY_BUFFER,vertexPositionBuffer),gl.bufferSubData(gl.ARRAY_BUFFER,0,vertexPositionArray),gl.vertexAttribPointer(this._attrPosition.location,2,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,vertexColorBuffer),gl.bufferSubData(gl.ARRAY_BUFFER,0,vertexColorArray),gl.vertexAttribPointer(this._attrColor.location,4,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,vertexUVBuffer),gl.bufferSubData(gl.ARRAY_BUFFER,0,vertexUVArray),gl.vertexAttribPointer(this._attrTexture.location,2,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,vertexIndexBuffer),gl.bufferSubData(gl.ELEMENT_ARRAY_BUFFER,0,vertexIndexArray),gl.drawElements(gl.TRIANGLES,numVertex,gl.UNSIGNED_SHORT,0)}};GS.WebGLShaderProgram.extend(GS.WebGLTextureAlphaThresholdShaderProgram,__GS_WebGLTextureAlphaThresholdShaderProgramPrototype)}(),function(){GS.RendererUtils={getUnitsMatrix:function(strategy,w,h,width,height){if(width=width||w,height=height||h,"fit"===strategy){var s;return s=w>h?width/w:height/h,GS.Math.Matrix.createScale(s,s)}return"stretch"===strategy?GS.Math.Matrix.createScale(width/w,height/h):"fill"===strategy?(width>height?w=width*h/height:h=height*w/width,GS.Math.Matrix.createScale(width/w,height/h)):void 0},calculatePreferredUnitsForViewport:function(w,h,width,height){return width>height?h=height*w/width:w=width*h/height,{width:w,height:h}},autoDetectRenderer:function(w,h,unitsInfo,canvas){var renderer,webgl_enabled=function(){try{var canvas=document.createElement("canvas");return window.WebGLRenderingContext?canvas.getContext("webgl")||canvas.getContext("experimental-webgl"):!1}catch(e){return!1}}();return w=w||800,h=h||600,renderer=webgl_enabled?new GS.RendererWebGL(w,h,canvas):new GS.RendererCanvas(w,h,canvas),null===renderer._surface.parentNode&&document.body.appendChild(renderer._surface),renderer.setUnits(unitsInfo),renderer},parseStyle:function(st){if("string"==typeof st){var c=[];if("#"===st.charAt(0))st=st.substr(1),st.length>=6?(c.push(parseInt(st.substr(0,2),16)/255),c.push(parseInt(st.substr(2,2),16)/255),c.push(parseInt(st.substr(4,2),16)/255),c.push(st.length>6?parseInt(st.substr(6,2),16)/255:1)):(c.push(parseInt(st.substr(0,1),16)/15),c.push(parseInt(st.substr(1,1),16)/15),c.push(parseInt(st.substr(2,1),16)/15),c.push(st.length>3?parseInt(st.substr(3,1),16)/15:1));else if("r"===st.charAt(0)&&"g"===st.charAt(1)&&"b"===st.charAt(2)){var numChannel="a"===st.charAt(3)?4:3;st=st.substr(numChannel+1);var stc=st.substring(0,st.indexOf(","));c.push(parseInt(stc)/255),st=st.substr(stc.length+1),stc=st.substring(0,st.indexOf(",")),c.push(parseInt(stc)/255),st=st.substr(stc.length+1),stc=st.substring(0,st.indexOf(4===numChannel?",":")")),c.push(parseInt(stc)/255),st=st.substr(stc.length+1),4===numChannel?(stc=st.substring(0,st.indexOf(")")),c.push(parseFloat(stc))):c.push(1)}else switch(st.toLowerCase()){case"red":c=[1,0,0,1];break;case"blue":c=[0,0,1,1];break;case"green":c=[0,1,0,1];break;default:c=[1,1,1,1]}return c}return st}}}(),function(){"use strict";GS.RendererWebGL=function(w,h,surface){return this._surface=null,this._gl=null,this._glContext=null,w&&h&&this.initialize(w,h,surface),this._sizeInUnits={width:w,height:h},this._sizeInPixels={width:w,height:h},this._unitsMatrix=GS.Math.Matrix.IDENTITY,this};var __GS_RendererWebGLPrototype={initialize:function(w,h,surface){this._surface=surface?surface:document.createElement("canvas"),this._surface.width=w,this._surface.height=h,this._glContext=new GS.WebGLRenderingContext(this._surface),this._gl=this._glContext._gl;var gl=this._gl;return gl&&(gl.clearColor(0,0,0,0),gl.disable(gl.DEPTH_TEST),gl.disable(gl.CULL_FACE),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT|gl.STENCIL_BUFFER_BIT)),gl.viewport(0,0,w,h),gl.viewportWidth=this._surface.width,gl.viewportHeight=this._surface.height,this},getContext:function(){return this._glContext},getRenderingContext:function(){return this.getContext()},getWebGLCanvasContext:function(){return this._glContext._gl},startRender:function(){this._glContext.startRender()},render:function(scene,elapsedTimeBetweenFrames){scene.setUnitsMatrix(this._unitsMatrix),scene.processFrame(this._glContext,scene._time),scene.incrementTimeLineBy(elapsedTimeBetweenFrames),this._glContext.flush()},setUnits:function(unitsInfo){var sp=this.getSizeInPixels();if(unitsInfo=unitsInfo||{},unitsInfo.width=unitsInfo.width||sp.width,unitsInfo.height=unitsInfo.height||sp.height,unitsInfo.strategy=unitsInfo.strategy||"fit","resize"===unitsInfo.strategy){var unitsSize=GS.RendererUtils.calculatePreferredUnitsForViewport(unitsInfo.width,unitsInfo.height,sp.width,sp.height);unitsInfo.width=unitsSize.width,unitsInfo.height=unitsSize.height,unitsInfo.strategy="fit",console.log("New units size: "+unitsInfo.width+","+unitsInfo.height)}this._sizeInUnits={width:unitsInfo.width,height:unitsInfo.height},this.__setUnitsMatrix(GS.RendererUtils.getUnitsMatrix(unitsInfo.strategy,unitsInfo.width,unitsInfo.height,sp.width,sp.height))},__setUnitsMatrix:function(matrix){this._unitsMatrix=matrix},getUnitsMatrix:function(){return this._unitsMatrix},flush:function(){this._glContext.flush()},addFilter:function(filter,id){this._glContext.addFilter(filter,id)},getSizeInPixels:function(){return this._sizeInPixels},getSize:function(){return this._sizeInUnits},orientationChange:function(){var tmp;tmp=this._sizeInPixels.width,this._sizeInPixels.width=this._sizeInPixels.height,this._sizeInPixels.height=tmp,tmp=this._sizeInUnits.width,this._sizeInUnits.width=this._sizeInUnits.height,this._sizeInUnits.height=tmp,this.initialize(this._sizeInPixels.width,this._sizeInPixels.height,this._surface),tmp=this._unitsMatrix[0],this._unitsMatrix[0]=this._unitsMatrix[4],this._unitsMatrix[4]=tmp},scaleToScreen:function(){var surface=this._surface,scale=Math.min(window.innerWidth/surface.width,window.innerHeight/surface.height);return surface.style.width=surface.width*scale+"px",surface.style.height=surface.height*scale+"px",this},prepareImage:function(si){si instanceof GS.SpriteImageData&&(si=si._owner),si.setAsTexture(this._gl)}};GS.RendererWebGL.prototype=__GS_RendererWebGLPrototype}(),function(){"use strict";function copymatrix(matrix){return __matrixCopy.set(matrix),__matrixCopy}var ear=new GS.EarCut,pt=GS.PathTriangulator,__p0=new GS.Point(0,0),__p1=new GS.Point(0,0),vv=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],__defaultTintColor=[1,1,1,1],__identityMatrix=GS.Math.Matrix.IDENTITY,MAX_QUADS=16384,MAX_CACHE_SIZE=50,__defaultRGB=[1,1,1,1],__matrixCopy=GS.FloatArray(9,0),textureCacheCanvas=document.createElement("canvas"),TextCache=function(gl){return this._gl=gl,this._textCache={},this._textCacheFIFO=[],this};TextCache.prototype={getTextInfo:function(text,fontDef,isForFill,lineWidth){var key=text+fontDef+isForFill,textDef=this._textCache[key];if(!textDef){var offset=0,fontParams=fontDef.split(" "),textHeight=parseFloat(fontParams[0].substr(0,fontParams[0].indexOf("p")))+2*lineWidth;textHeight||(textHeight=15);for(var bold=!1,italic=!1,i=2;i<fontParams.length;)"bold"===fontParams[i]?bold=!0:"italic"===fontParams[i]&&(italic=!0),i++;var ctx=textureCacheCanvas.getContext("2d");ctx.font=fontDef;var mt=ctx.measureText(text),baseline=.8*textHeight;mt.fontBoundingBoxAscent&&(textHeight=mt.fontBoundingBoxDescent+mt.fontBoundingBoxAscent+offset,baseline=mt.fontBoundingBoxAscent),textHeight+=offset;var textWidth=mt.width+offset;if(textureCacheCanvas.width=textWidth,textureCacheCanvas.height=textHeight,ctx.font=fontDef,ctx.textBaseline="middle",ctx.textAlign="center",ctx.lineWidth=lineWidth||1,ctx.clearRect(0,0,textWidth,textHeight),ctx.fillStyle="#fff",ctx.strokeStyle="#fff",isForFill?ctx.fillText(text,textWidth/2,textHeight/2):ctx.strokeText(text,textWidth/2,textHeight/2),textDef={spriteImage:new GS.SpriteImage(textureCacheCanvas).setAsTexture(this._gl),key:key,offset:offset,height:textHeight,width:textWidth,baseline:baseline},this._textCacheFIFO.length>MAX_CACHE_SIZE){var atextDef=this._textCacheFIFO.shift();atextDef.spriteImage.dispose(),this._textCache["delete"](atextDef.key)}this._textCache[key]=textDef,this._textCacheFIFO.push(textDef)}return textDef}};var Context=function(){return this._globalCompositeOperation="source-over",this._currentMatrix=GS.Math.Matrix.create(),this._globalAlpha=1,this._pathTracer=new GS.Path.Path,this._clipPaths=[],this._miterLimit=10,this._fillStyle=[0,0,0,1],this._strokeStyle=[0,0,0,1],this._tintColor=__defaultTintColor,this._lineWidth=1,this._fontDefinition="10px sans-serif",this._textBaseline="alphabetic",this._textAlign="left",this};Context.prototype={clone:function(){var ctx=new Context;return ctx._globalCompositeOperation=this._globalCompositeOperation,ctx._pathTracer=this._pathTracer.clone(),ctx._globalAlpha=this._globalAlpha,ctx._currentMatrix=new GS.FloatArray(9,0),ctx._miterLimit=this._miterLimit,ctx._fillStyle=this._fillStyle,ctx._strokeStyle=this._strokeStyle,ctx._tintColor=this._tintColor,ctx._lineWidth=this._lineWidth,ctx._fontDefinition=this._fontDefinition,ctx._textBaseline=this._textBaseline,ctx._textAlign=this._textAlign,GS.Math.Matrix.copy(this._currentMatrix,ctx._currentMatrix),ctx}};var Pattern=function(spriteImageData,type){return spriteImageData instanceof GS.SpriteImage&&(spriteImageData=spriteImageData._mainImageElement),this.spriteImageData=spriteImageData,this.type=type,this.toCanvasContextFillStyle=function(){},this},LinearGradient=function(x0,y0,x1,y1){return this.x0=x0,this.x1=x1,this.y0=y0,this.y1=y1,this.colorArray=GS.FloatArray(64,0),this.colorStopArray=GS.FloatArray(16,0),this.colorStops=[],this.toCanvasContextFillStyle=function(ctx){for(var gr=ctx.createLinearGradient(this.x0,this.y0,this.x1,this.y1),i=0;i<this.colorStops.length;i++)gr.addColorStop(this.colorStops[i].position,"rgba("+255*this.colorStops[i].color[0]+","+255*this.colorStops[i].color[1]+","+255*this.colorStops[i].color[2]+","+this.colorStops[i].color[2]+")")},this.addColorStop=function(position,color){this.colorStops.push({position:position,color:parseStyle(color)}),this.colorStops=this.colorStops.sort(function(e0,e1){return e0.position>e1.position});for(var i=0;i<this.colorStops.length;i++)this.colorArray[4*i]=this.colorStops[i].color[0],this.colorArray[4*i+1]=this.colorStops[i].color[1],this.colorArray[4*i+2]=this.colorStops[i].color[2],this.colorArray[4*i+3]=this.colorStops[i].color[3],this.colorStopArray[i]=this.colorStops[i].position;var lastColorIndex=this.colorStops.length-1;for(i=this.colorStops.length;16>i;i++)this.colorArray[4*i]=this.colorStops[lastColorIndex].color[0],this.colorArray[4*i+1]=this.colorStops[lastColorIndex].color[1],this.colorArray[4*i+2]=this.colorStops[lastColorIndex].color[2],this.colorArray[4*i+3]=this.colorStops[lastColorIndex].color[3],this.colorStopArray[i]=1},this.getColorArray=function(){return this.colorArray},this.getColorStopArray=function(){return this.colorStopArray},this},RadialGradient=function(x0,y0,r0,x1,y1,r1){return this.x0=x0,this.x1=x1,this.y0=y0,this.y1=y1,this.r0=r0,this.r1=r1,this.colorArray=GS.FloatArray(64,0),this.colorStopArray=GS.FloatArray(16,0),this.colorStops=[],this.toCanvasContextFillStyle=function(ctx){for(var gr=ctx.createLinearGradient(this.x0,this.y0,this.r0,this.x1,this.y1,this.r1),i=0;i<this.colorStops.length;i++)gr.addColorStop(this.colorStops[i].position,"rgba("+255*this.colorStops[i].color[0]+","+255*this.colorStops[i].color[1]+","+255*this.colorStops[i].color[2]+","+this.colorStops[i].color[2]+")")},this.addColorStop=function(position,color){this.colorStops.push({position:position,color:parseStyle(color)}),this.colorStops=this.colorStops.sort(function(e0,e1){return e0.position>e1.position});for(var i=0;i<this.colorStops.length;i++)this.colorArray[4*i]=this.colorStops[i].color[0],this.colorArray[4*i+1]=this.colorStops[i].color[1],this.colorArray[4*i+2]=this.colorStops[i].color[2],this.colorArray[4*i+3]=this.colorStops[i].color[3],this.colorStopArray[i]=this.colorStops[i].position;var lastColorIndex=this.colorStops.length-1;for(i=this.colorStops.length;16>i;i++)this.colorArray[4*i]=this.colorStops[lastColorIndex].color[0],this.colorArray[4*i+1]=this.colorStops[lastColorIndex].color[1],this.colorArray[4*i+2]=this.colorStops[lastColorIndex].color[2],this.colorArray[4*i+3]=this.colorStops[lastColorIndex].color[3],this.colorStopArray[i]=1},this.getColorArray=function(){return this.colorArray},this.getColorStopArray=function(){return this.colorStopArray},this},FillStyleInfo={SOLID:0,CATEGORY_GRADIENT:256,LINEAR_GRADIENT:256,RADIAL_GRADIENT:257,IMAGE:3,IMAGE_ALPHA_THRESHOLD:4,CATEGORY_PATTERN:128,PATTERN_REPEAT:128,PATTERN_REPEAT_X:129,PATTERN_REPEAT_Y:130,PATTERN_NO_REPEAT:131,CUSTOM_SHADER:512,getFromStyle:function(fillStyle){return this.__isStyleColor(fillStyle)?this.SOLID:this.__isStylePattern(fillStyle)?"repeat"===fillStyle.type?this.PATTERN_REPEAT:"no-repeat"===fillStyle.type?this.PATTERN_NO_REPEAT:"repeat-x"===fillStyle.type?this.PATTERN_REPEAT_X:"repeat-y"===fillStyle.type?this.PATTERN_REPEAT_Y:this.PATTERN_REPEAT:this.__isStyleLinearGradient(fillStyle)?this.LINEAR_GRADIENT:this.__isStyleRadialGradient(fillStyle)?this.RADIAL_GRADIENT:this.__isStyleCustomShader(fillStyle)?this.CUSTOM_SHADER:void 0},__isStyleCustomShader:function(st){return st instanceof GS.WebGLShaderProgram},__isStyleColor:function(st){return st instanceof Array},__isStylePattern:function(st){return st instanceof Pattern},__isStyleLinearGradient:function(st){return st instanceof LinearGradient},__isStyleRadialGradient:function(st){return st instanceof RadialGradient}},ShaderId={TEXTURE:0,COLOR:1,PATTERN_REPEAT:2,PATTERN_REPEATX:3,PATTERN_REPEATY:4,PATTERN_NOREPEAT:5,LINEAR_GRADIENT:6,RADIAL_GRADIENT:7,TEXTURE_ALPHA_THRESHOLD:8},Batch=function(gl,width,height){this._width=width,this._height=height,this._gl=gl;var ortho=GS.WebGLUtils.makeOrtho(0,width,height,0,-1,1);return this._stockShaders=[],this._customShaders=[],this._currentProgram=null,this._stockShaders.push(new GS.WebGLTextureShaderProgram(gl)),this._stockShaders.push(new GS.WebGLGeometryColorShaderProgram(gl,ortho)),this._stockShaders.push(new GS.WebGLPatternShaderProgram(gl,ortho,"repeat")),this._stockShaders.push(new GS.WebGLPatternShaderProgram(gl,ortho,"repeat-x")),this._stockShaders.push(new GS.WebGLPatternShaderProgram(gl,ortho,"repeat-y")),this._stockShaders.push(new GS.WebGLPatternShaderProgram(gl,ortho,"no-repeat")),this._stockShaders.push(new GS.WebGLLinearGradientShaderProgram(gl,ortho)),this._stockShaders.push(new GS.WebGLRadialGradientShaderProgram(gl,ortho)),this._stockShaders.push(new GS.WebGLTextureAlphaThresholdShaderProgram(gl)),this._vertexPositionBuffer=[],this._vertexPositionBuffer.push(gl.createBuffer()),this.vertexPositionBuffer=this._vertexPositionBuffer[0],this.vertexPositionArray=new Float32Array(8*MAX_QUADS),this.vertexPositionArrayIndex=0,gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexPositionBuffer),gl.bufferData(gl.ARRAY_BUFFER,this.vertexPositionArray,gl.DYNAMIC_DRAW),this._vertexColorBuffer=[],this._vertexColorBuffer.push(gl.createBuffer()),this.vertexColorBuffer=this._vertexColorBuffer[0],this.vertexColorArray=new Float32Array(16*MAX_QUADS),this.vertexColorArrayIndex=0,gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexColorBuffer),gl.bufferData(gl.ARRAY_BUFFER,this.vertexColorArray,gl.DYNAMIC_DRAW),this._vertexIndexBuffer=[],this._vertexIndexBuffer.push(gl.createBuffer()),this.vertexIndexBuffer=this._vertexIndexBuffer[0],this.vertexIndexArrayIndex=0,this.vertexIndexArray=new Uint16Array(6*MAX_QUADS),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,this.vertexIndexArray,gl.DYNAMIC_DRAW),this._vertexUVBuffer=[],this._vertexUVBuffer.push(gl.createBuffer()),this.vertexUVBuffer=this._vertexUVBuffer[0],this.vertexUVArray=new Float32Array(8*MAX_QUADS),this.vertexUVArrayIndex=0,gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexUVBuffer),gl.bufferData(gl.ARRAY_BUFFER,this.vertexUVArray,gl.DYNAMIC_DRAW),this._currentBufferIndex=0,this._contextStack=[],this.stencilClipValue=0,this._currentContext=new Context,this._contextStack.push(this._currentContext),this._pathTracer=this._currentContext._pathTracer,this._pathTracer.__ctx=this,this._currentFillStyleInfo=FillStyleInfo.SOLID,this._currentFillStyle=[1,1,1,1],this._currentProgram=null,this._currentglTextureId=-1,this._currentTransformMatrix=GS.Math.Matrix.create(),this._currentModelViewMatrix=__identityMatrix,this._currentGlobalCompositeOperation="source-over",this._blendModeSet=-1,this._elementIndex=0,this._textCache=new TextCache(gl),this};Batch.prototype={__patternConditionsChanged:function(fillStyle){return GS.Math.Matrix.notEquals(this._currentTransformMatrix,this._currentContext._currentMatrix)?!0:fillStyle.spriteImageData._owner._textureId!==this._currentFillStyle.spriteImageData._owner._textureId?!0:!1},__gradientConditionsChanged:function(fillStyle){return GS.Math.Matrix.notEquals(this._currentTransformMatrix,this._currentContext._currentMatrix)?!0:this._currentFillStyle!==fillStyle?!0:!1},__customShaderConditionsChanged:function(){return!0},__needsFlush:function(fillStyle,fillStyleInfo){if(this._currentFillStyleInfo!==fillStyleInfo)return!0;switch(fillStyleInfo){case FillStyleInfo.PATTERN_NO_REPEAT:case FillStyleInfo.PATTERN_REPEAT:case FillStyleInfo.PATTERN_REPEAT_X:case FillStyleInfo.PATTERN_REPEAT_Y:return this.__patternConditionsChanged(fillStyle);case FillStyleInfo.LINEAR_GRADIENT:case FillStyleInfo.RADIAL_GRADIENT:return this.__gradientConditionsChanged(fillStyle);case FillStyleInfo.CUSTOM_SHADER:return this.__customShaderConditionsChanged(fillStyle)}return!1},__transformAABB:function(_x,_y,_w,_h,matrix){var vvv=vv[0];return vvv.x=_x,vvv.y=_y,vvv=vv[1],vvv.x=_x+_w,vvv.y=_y,vvv=vv[2],vvv.x=_x+_w,vvv.y=_y+_h,vvv=vv[3],vvv.x=_x,vvv.y=_y+_h,matrix!==__identityMatrix&&(GS.Math.Matrix.transformPoint(vv[0],matrix),GS.Math.Matrix.transformPoint(vv[1],matrix),GS.Math.Matrix.transformPoint(vv[2],matrix),GS.Math.Matrix.transformPoint(vv[3],matrix)),vv},__renderGeometrySolid:function(){var shader=this._stockShaders[ShaderId.COLOR];shader.updateUniformValues(this._currentModelViewMatrix),this.__useProgram(shader),this._currentProgram.flushBuffersWithContent(this.vertexPositionBuffer,this.vertexPositionArray.subarray(0,this.vertexPositionArrayIndex),this.vertexColorBuffer,this.vertexColorArray.subarray(0,this.vertexColorArrayIndex),this.vertexIndexBuffer,this.vertexIndexArray.subarray(0,this.vertexIndexArrayIndex),this.vertexIndexArrayIndex)},__renderGeometryWithImage:function(id){var shader=this._stockShaders[id];shader.updateUniformValues([this._width,this._height],this._currentglTextureId),this.__useProgram(shader),this._currentProgram.flushBuffersWithContent(this.vertexPositionBuffer,this.vertexPositionArray.subarray(0,this.vertexPositionArrayIndex),this.vertexColorBuffer,this.vertexColorArray.subarray(0,this.vertexColorArrayIndex),this.vertexUVBuffer,this.vertexUVArray.subarray(0,this.vertexUVArrayIndex),this.vertexIndexBuffer,this.vertexIndexArray.subarray(0,this.vertexIndexArrayIndex),this.vertexIndexArrayIndex)
},__renderGeometryWithPattern:function(program){program.updateUniformValues(this._currentFillStyle,this._currentModelViewMatrix,copymatrix(this._currentTransformMatrix)),this.__useProgram(program),this._currentProgram.flushBuffersWithContent(this.vertexPositionBuffer,this.vertexPositionArray.subarray(0,this.vertexPositionArrayIndex),this.vertexColorBuffer,this.vertexColorArray.subarray(0,this.vertexColorArrayIndex),this.vertexIndexBuffer,this.vertexIndexArray.subarray(0,this.vertexIndexArrayIndex),this.vertexIndexArrayIndex)},__renderGeometryWithGradient:function(shader){shader.updateUniformValues(this._currentFillStyle,this._currentModelViewMatrix,copymatrix(this._currentTransformMatrix)),this.__useProgram(shader),this._currentProgram.flushBuffersWithContent(this.vertexPositionBuffer,this.vertexPositionArray.subarray(0,this.vertexPositionArrayIndex),this.vertexColorBuffer,this.vertexColorArray.subarray(0,this.vertexColorArrayIndex),this.vertexIndexBuffer,this.vertexIndexArray.subarray(0,this.vertexIndexArrayIndex),this.vertexIndexArrayIndex)},__renderGeometryWithLinearGradient:function(){this.__renderGeometryWithGradient(this._stockShaders[ShaderId.LINEAR_GRADIENT])},__renderGeometryWithRadialGradient:function(){this.__renderGeometryWithGradient(this._stockShaders[ShaderId.RADIAL_GRADIENT])},__renderGeometryWithCustomShader:function(){this._currentFillStyle.updateUniformValues(this._currentModelViewMatrix,copymatrix(this._currentTransformMatrix),[this._width,this._height]),this.__useProgram(this._currentFillStyle),this._currentProgram.flushBuffersWithContent(this.vertexPositionBuffer,this.vertexPositionArray.subarray(0,this.vertexPositionArrayIndex),this.vertexColorBuffer,this.vertexColorArray.subarray(0,this.vertexColorArrayIndex),this.vertexUVBuffer,this.vertexUVArray.subarray(0,this.vertexUVArrayIndex),this.vertexIndexBuffer,this.vertexIndexArray.subarray(0,this.vertexIndexArrayIndex),this.vertexIndexArrayIndex)},__useProgram:function(program){this._currentProgram&&this._currentProgram===program||(this._currentProgram&&this._currentProgram.notUseProgram(),this._currentProgram=program,this._currentProgram.useProgram()),this._currentProgram.setCustomUniforms()},flush:function(){if(0!==this.vertexPositionArrayIndex){switch(this.__setBlendMode(this._currentGlobalCompositeOperation),this._currentFillStyleInfo){case FillStyleInfo.SOLID:this.__renderGeometrySolid();break;case FillStyleInfo.IMAGE:this.__renderGeometryWithImage(ShaderId.TEXTURE);break;case FillStyleInfo.IMAGE_ALPHA_THRESHOLD:this.__renderGeometryWithImage(ShaderId.TEXTURE_ALPHA_THRESHOLD);break;case FillStyleInfo.PATTERN_REPEAT:this.__renderGeometryWithPattern(this._stockShaders[ShaderId.PATTERN_REPEAT]);break;case FillStyleInfo.PATTERN_REPEAT_X:this.__renderGeometryWithPattern(this._stockShaders[ShaderId.PATTERN_REPEATX]);break;case FillStyleInfo.PATTERN_REPEAT_Y:this.__renderGeometryWithPattern(this._stockShaders[ShaderId.PATTERN_REPEATY]);break;case FillStyleInfo.PATTERN_NO_REPEAT:this.__renderGeometryWithPattern(this._stockShaders[ShaderId.PATTERN_NOREPEAT]);break;case FillStyleInfo.LINEAR_GRADIENT:this.__renderGeometryWithLinearGradient();break;case FillStyleInfo.RADIAL_GRADIENT:this.__renderGeometryWithRadialGradient();break;case FillStyleInfo.CUSTOM_SHADER:this.__renderGeometryWithCustomShader()}this.currentCompositeOperationRequiresClearingNotStenciledArea()&&this.__clearNotStenciledArea(),this.flushCounters()}},flushCounters:function(){this.vertexColorArrayIndex=0,this.vertexPositionArrayIndex=0,this.vertexIndexArrayIndex=0,this.vertexUVArrayIndex=0,this._elementIndex=0},__checkFillConditions:function(fillStyle,fillStyleInfo){(this.__needsFlush(fillStyle,fillStyleInfo)||this._currentContext._globalCompositeOperation!==this._currentGlobalCompositeOperation||__identityMatrix!==this._currentModelViewMatrix||this.vertexPositionArrayIndex+8>=this.vertexPositionArray.length)&&(this.flush(),this._currentFillStyleInfo=fillStyleInfo,this._currentTransformMatrix.set(this._currentContext._currentMatrix),this._currentModelViewMatrix.set(__identityMatrix),this._currentGlobalCompositeOperation=this._currentContext._globalCompositeOperation),this._currentFillStyle=fillStyle},fillGeometry:function(vertices,indices){var i,fillStyle=parseStyle(this._currentContext._fillStyle),fillStyleInfo=FillStyleInfo.getFromStyle(fillStyle);this.__checkFillConditions(fillStyle,fillStyleInfo);var glCoords=this.vertexPositionArray,glCoordsIndex=this.vertexPositionArrayIndex,rgb=fillStyleInfo===FillStyleInfo.SOLID?fillStyle:__defaultRGB,colorBuffer=this.vertexColorArray,colorIndex=this.vertexColorArrayIndex,alpha=this._currentContext._globalAlpha*rgb[3];for(i=0;i<vertices.length;i++)glCoords[glCoordsIndex++]=vertices[i].x,glCoords[glCoordsIndex++]=vertices[i].y,colorBuffer[colorIndex++]=rgb[0],colorBuffer[colorIndex++]=rgb[1],colorBuffer[colorIndex++]=rgb[2],colorBuffer[colorIndex++]=alpha;this.vertexPositionArrayIndex+=2*vertices.length,this.vertexColorArrayIndex+=4*vertices.length;var indexBuffer=this.vertexIndexArray,indexBufferIndex=this.vertexIndexArrayIndex,max=0;for(i=0;i<indices.length;i++)indexBuffer[indexBufferIndex++]=this._elementIndex+indices[i],indices[i]>max&&(max=indices[i]);this._elementIndex+=max+1,this.vertexIndexArrayIndex=indexBufferIndex},addQuad:function(x,y,w,h,isAA){var fillStyle=parseStyle(this._currentContext._fillStyle),fillStyleInfo=FillStyleInfo.getFromStyle(fillStyle);this.__checkFillConditions(fillStyle,fillStyleInfo);var glCoords=this.vertexPositionArray,glCoordsIndex=this.vertexPositionArrayIndex;if(isAA)x=x*this._currentContext._currentMatrix[0]+this._currentContext._currentMatrix[2],y=y*this._currentContext._currentMatrix[4]+this._currentContext._currentMatrix[5],w*=this._currentContext._currentMatrix[0],h*=this._currentContext._currentMatrix[4],glCoords[glCoordsIndex++]=x,glCoords[glCoordsIndex++]=y,glCoords[glCoordsIndex++]=x+w,glCoords[glCoordsIndex++]=y,glCoords[glCoordsIndex++]=x+w,glCoords[glCoordsIndex++]=y+h,glCoords[glCoordsIndex++]=x,glCoords[glCoordsIndex]=y+h;else{var vv=this.__transformAABB(x,y,w,h,this._currentContext._currentMatrix);glCoords[glCoordsIndex++]=vv[0].x,glCoords[glCoordsIndex++]=vv[0].y,glCoords[glCoordsIndex++]=vv[1].x,glCoords[glCoordsIndex++]=vv[1].y,glCoords[glCoordsIndex++]=vv[2].x,glCoords[glCoordsIndex++]=vv[2].y,glCoords[glCoordsIndex++]=vv[3].x,glCoords[glCoordsIndex]=vv[3].y}this.vertexPositionArrayIndex+=8;var rgb=fillStyleInfo===FillStyleInfo.SOLID?fillStyle:__defaultRGB,colorBuffer=this.vertexColorArray,colorIndex=this.vertexColorArrayIndex,alpha=this._currentContext._globalAlpha*rgb[3];colorBuffer[colorIndex++]=rgb[0],colorBuffer[colorIndex++]=rgb[1],colorBuffer[colorIndex++]=rgb[2],colorBuffer[colorIndex++]=alpha,colorBuffer[colorIndex++]=rgb[0],colorBuffer[colorIndex++]=rgb[1],colorBuffer[colorIndex++]=rgb[2],colorBuffer[colorIndex++]=alpha,colorBuffer[colorIndex++]=rgb[0],colorBuffer[colorIndex++]=rgb[1],colorBuffer[colorIndex++]=rgb[2],colorBuffer[colorIndex++]=alpha,colorBuffer[colorIndex++]=rgb[0],colorBuffer[colorIndex++]=rgb[1],colorBuffer[colorIndex++]=rgb[2],colorBuffer[colorIndex]=alpha,this.vertexColorArrayIndex+=16;var indexBuffer=this.vertexIndexArray,indexBufferIndex=this.vertexIndexArrayIndex;indexBuffer[indexBufferIndex]=this._elementIndex,indexBuffer[indexBufferIndex+1]=this._elementIndex+1,indexBuffer[indexBufferIndex+2]=this._elementIndex+2,indexBuffer[indexBufferIndex+3]=this._elementIndex,indexBuffer[indexBufferIndex+4]=this._elementIndex+2,indexBuffer[indexBufferIndex+5]=this._elementIndex+3,this.vertexIndexArrayIndex+=6,this._elementIndex+=4},__checkFillWithTextureConditions:function(glTextureId){(glTextureId!==this._currentglTextureId||this._currentFillStyleInfo!==FillStyleInfo.IMAGE||this._currentContext._globalCompositeOperation!==this._currentGlobalCompositeOperation||this.vertexPositionArrayIndex+8>=this.vertexPositionArray.length)&&(this.flush(),this._currentglTextureId=glTextureId,this._currentTransformMatrix.set(__identityMatrix),this._currentGlobalCompositeOperation=this._currentContext._globalCompositeOperation),this._currentFillStyleInfo=FillStyleInfo.IMAGE},fillGeometryQuadWithTexture:function(vertices,indices,textureId,u0,v0,u1,v1){this.__checkFillWithTextureConditions(textureId);var i,glCoords=this.vertexPositionArray,glCoordsIndex=this.vertexPositionArrayIndex,rgb=this._currentContext._tintColor,colorBuffer=this.vertexColorArray,colorIndex=this.vertexColorArrayIndex,alpha=this._currentContext._globalAlpha*rgb[3];for(i=0;i<vertices.length;i++)glCoords[glCoordsIndex++]=vertices[i].x,glCoords[glCoordsIndex++]=vertices[i].y,colorBuffer[colorIndex++]=rgb[0],colorBuffer[colorIndex++]=rgb[1],colorBuffer[colorIndex++]=rgb[2],colorBuffer[colorIndex++]=alpha;this.vertexPositionArrayIndex+=2*vertices.length,this.vertexColorArrayIndex+=4*vertices.length;var uvBuffer=this.vertexUVArray,uvIndex=this.vertexUVArrayIndex;uvBuffer[uvIndex++]=u0,uvBuffer[uvIndex++]=v0,uvBuffer[uvIndex++]=u1,uvBuffer[uvIndex++]=v0,uvBuffer[uvIndex++]=u1,uvBuffer[uvIndex++]=v1,uvBuffer[uvIndex++]=u0,uvBuffer[uvIndex]=v1,this.vertexUVArrayIndex+=8;var indexBuffer=this.vertexIndexArray,indexBufferIndex=this.vertexIndexArrayIndex,max=0;for(i=0;i<indices.length;i++)indexBuffer[indexBufferIndex++]=this._elementIndex+indices[i],indices[i]>max&&(max=indices[i]);this._elementIndex+=max+1,this.vertexIndexArrayIndex=indexBufferIndex},addQuadWithTexture:function(x,y,w,h,u0,v0,u1,v1,glTextureId,isAA){this.__checkFillWithTextureConditions(glTextureId);var glCoords=this.vertexPositionArray,glCoordsIndex=this.vertexPositionArrayIndex;if(isAA)x=x*this._currentContext._currentMatrix[0]+this._currentContext._currentMatrix[2],y=y*this._currentContext._currentMatrix[4]+this._currentContext._currentMatrix[5],w*=this._currentContext._currentMatrix[0],h*=this._currentContext._currentMatrix[4],glCoords[glCoordsIndex++]=x,glCoords[glCoordsIndex++]=y,glCoords[glCoordsIndex++]=x+w,glCoords[glCoordsIndex++]=y,glCoords[glCoordsIndex++]=x+w,glCoords[glCoordsIndex++]=y+h,glCoords[glCoordsIndex++]=x,glCoords[glCoordsIndex]=y+h;else{var vv=this.__transformAABB(x,y,w,h,this._currentContext._currentMatrix);glCoords[glCoordsIndex++]=vv[0].x,glCoords[glCoordsIndex++]=vv[0].y,glCoords[glCoordsIndex++]=vv[1].x,glCoords[glCoordsIndex++]=vv[1].y,glCoords[glCoordsIndex++]=vv[2].x,glCoords[glCoordsIndex++]=vv[2].y,glCoords[glCoordsIndex++]=vv[3].x,glCoords[glCoordsIndex]=vv[3].y}this.vertexPositionArrayIndex+=8;var uvBuffer=this.vertexUVArray,uvIndex=this.vertexUVArrayIndex;uvBuffer[uvIndex++]=u0,uvBuffer[uvIndex++]=v0,uvBuffer[uvIndex++]=u1,uvBuffer[uvIndex++]=v0,uvBuffer[uvIndex++]=u1,uvBuffer[uvIndex++]=v1,uvBuffer[uvIndex++]=u0,uvBuffer[uvIndex]=v1,this.vertexUVArrayIndex+=8;var rgb=this._currentContext._tintColor,colorBuffer=this.vertexColorArray,colorIndex=this.vertexColorArrayIndex,alpha=this._currentContext._globalAlpha*rgb[3];colorBuffer[colorIndex++]=rgb[0],colorBuffer[colorIndex++]=rgb[1],colorBuffer[colorIndex++]=rgb[2],colorBuffer[colorIndex++]=alpha,colorBuffer[colorIndex++]=rgb[0],colorBuffer[colorIndex++]=rgb[1],colorBuffer[colorIndex++]=rgb[2],colorBuffer[colorIndex++]=alpha,colorBuffer[colorIndex++]=rgb[0],colorBuffer[colorIndex++]=rgb[1],colorBuffer[colorIndex++]=rgb[2],colorBuffer[colorIndex++]=alpha,colorBuffer[colorIndex++]=rgb[0],colorBuffer[colorIndex++]=rgb[1],colorBuffer[colorIndex++]=rgb[2],colorBuffer[colorIndex]=alpha,this.vertexColorArrayIndex+=16;var indexBuffer=this.vertexIndexArray,indexBufferIndex=this.vertexIndexArrayIndex;indexBuffer[indexBufferIndex]=this._elementIndex,indexBuffer[indexBufferIndex+1]=this._elementIndex+1,indexBuffer[indexBufferIndex+2]=this._elementIndex+2,indexBuffer[indexBufferIndex+3]=this._elementIndex,indexBuffer[indexBufferIndex+4]=this._elementIndex+2,indexBuffer[indexBufferIndex+5]=this._elementIndex+3,this.vertexIndexArrayIndex+=6,this._elementIndex+=4},addQuadFilter:function(x,y,w,h,si,isAA){this.flush(),this._currentTransformMatrix.set(__identityMatrix),this._currentglTextureId=si._textureId,this._currentGlobalCompositeOperation=this._currentContext._globalCompositeOperation,this._currentFillStyle=parseStyle(this._currentContext._fillStyle),this._currentFillStyleInfo=FillStyleInfo.CUSTOM_SHADER;var glCoords=this.vertexPositionArray,glCoordsIndex=this.vertexPositionArrayIndex;if(isAA)x=x*this._currentContext._currentMatrix[4]+this._currentContext._currentMatrix[2],y=y*this._currentContext._currentMatrix[0]+this._currentContext._currentMatrix[5],w*=this._currentContext._currentMatrix[0],h*=this._currentContext._currentMatrix[4],glCoords[glCoordsIndex++]=x,glCoords[glCoordsIndex++]=y,glCoords[glCoordsIndex++]=x+w,glCoords[glCoordsIndex++]=y,glCoords[glCoordsIndex++]=x+w,glCoords[glCoordsIndex++]=y+h,glCoords[glCoordsIndex++]=x,glCoords[glCoordsIndex]=y+h;else{var vv=this.__transformAABB(x,y,w,h,this._currentContext._currentMatrix);glCoords[glCoordsIndex++]=vv[0].x,glCoords[glCoordsIndex++]=vv[0].y,glCoords[glCoordsIndex++]=vv[1].x,glCoords[glCoordsIndex++]=vv[1].y,glCoords[glCoordsIndex++]=vv[2].x,glCoords[glCoordsIndex++]=vv[2].y,glCoords[glCoordsIndex++]=vv[3].x,glCoords[glCoordsIndex]=vv[3].y}this.vertexPositionArrayIndex+=8;var uvBuffer=this.vertexUVArray,uvIndex=this.vertexUVArrayIndex;uvBuffer[uvIndex++]=si._u0,uvBuffer[uvIndex++]=si._v0,uvBuffer[uvIndex++]=si._u1,uvBuffer[uvIndex++]=si._v0,uvBuffer[uvIndex++]=si._u1,uvBuffer[uvIndex++]=si._v1,uvBuffer[uvIndex++]=si._u0,uvBuffer[uvIndex]=si._v1,this.vertexUVArrayIndex+=8;var rgb=this._currentContext._tintColor,colorBuffer=this.vertexColorArray,colorIndex=this.vertexColorArrayIndex,alpha=this._currentContext._globalAlpha*rgb[3];colorBuffer[colorIndex++]=rgb[0],colorBuffer[colorIndex++]=rgb[1],colorBuffer[colorIndex++]=rgb[2],colorBuffer[colorIndex++]=alpha,colorBuffer[colorIndex++]=rgb[0],colorBuffer[colorIndex++]=rgb[1],colorBuffer[colorIndex++]=rgb[2],colorBuffer[colorIndex++]=alpha,colorBuffer[colorIndex++]=rgb[0],colorBuffer[colorIndex++]=rgb[1],colorBuffer[colorIndex++]=rgb[2],colorBuffer[colorIndex++]=alpha,colorBuffer[colorIndex++]=rgb[0],colorBuffer[colorIndex++]=rgb[1],colorBuffer[colorIndex++]=rgb[2],colorBuffer[colorIndex]=alpha,this.vertexColorArrayIndex+=16;var indexBuffer=this.vertexIndexArray,indexBufferIndex=this.vertexIndexArrayIndex;indexBuffer[indexBufferIndex]=this._elementIndex,indexBuffer[indexBufferIndex+1]=this._elementIndex+1,indexBuffer[indexBufferIndex+2]=this._elementIndex+2,indexBuffer[indexBufferIndex+3]=this._elementIndex,indexBuffer[indexBufferIndex+4]=this._elementIndex+2,indexBuffer[indexBufferIndex+5]=this._elementIndex+3,this.vertexIndexArrayIndex+=6,this._elementIndex+=4},addPath:function(vertexData,modelViewMatrix,style){var fillStyle=parseStyle(style),fillStyleInfo=FillStyleInfo.getFromStyle(fillStyle);(this.__needsFlush(fillStyle,fillStyleInfo)||this._currentContext._globalCompositeOperation!==this._currentGlobalCompositeOperation||GS.Math.Matrix.notEquals(this._currentModelViewMatrix,modelViewMatrix)||this.vertexPositionArrayIndex+vertexData.length>=this.vertexPositionArray.length)&&(this.flush(),this._currentFillStyleInfo=fillStyleInfo,this._currentTransformMatrix.set(this._currentContext._currentMatrix),this._currentModelViewMatrix=modelViewMatrix,this._currentGlobalCompositeOperation=this._currentContext._globalCompositeOperation),this._currentFillStyle=fillStyle,this.addPathImpl(vertexData)},addPathImpl:function(vertexData){this.vertexPositionArray.set(vertexData,this.vertexPositionArrayIndex),this.vertexPositionArrayIndex+=vertexData.length;for(var numTris=vertexData.length/6,indexBuffer=this.vertexIndexArray,indexBufferIndex=this.vertexIndexArrayIndex,i=0;numTris>i;i++)indexBuffer[indexBufferIndex++]=this._elementIndex,indexBuffer[indexBufferIndex++]=this._elementIndex+1,indexBuffer[indexBufferIndex++]=this._elementIndex+2,this._elementIndex+=3;this.vertexIndexArrayIndex=indexBufferIndex;var rgb=this._currentFillStyleInfo===FillStyleInfo.SOLID?this._currentFillStyle:__defaultRGB,colorBuffer=this.vertexColorArray,colorIndex=this.vertexColorArrayIndex,numVertex=vertexData.length/2,alpha=rgb[3]*this._currentContext._globalAlpha;for(i=0;numVertex>i;i++)colorBuffer[colorIndex++]=rgb[0],colorBuffer[colorIndex++]=rgb[1],colorBuffer[colorIndex++]=rgb[2],colorBuffer[colorIndex++]=alpha;this.vertexColorArrayIndex=colorIndex},currentCompositeOperationRequiresClearingNotStenciledArea:function(){var cco=this._currentGlobalCompositeOperation;return"destination-in"===cco||"destination-atop"===cco||"copy"===cco||"source-in"===cco||"source-out"===cco},beginStencilForCustomDraw:function(bColorMask){this.__enableStencil(),bColorMask&&this._gl.colorMask(!1,!1,!1,!1)},endStencilForCustomDraw:function(bColorMask){var gl=this._gl;bColorMask&&gl.colorMask(!0,!0,!0,!0),gl.stencilOp(gl.KEEP,gl.KEEP,gl.KEEP),gl.stencilFunc(gl.LEQUAL,this.stencilClipValue,255)},__clearNotStenciledArea:function(){this.beginStencilForCustomDraw(!0),this.__renderGeometrySolid(),this.vertexPositionArrayIndex=0,this.vertexColorArrayIndex=0,this.vertexIndexArrayIndex=0,this.endStencilForCustomDraw(!0),this.__clearNotStenciledAreaEnd(),this.__restoreClippingRegions()},__clearNotStenciledAreaEnd:function(){var gl=this._gl;gl.stencilFunc(gl.EQUAL,this.stencilClipValue-1,255),gl.disable(gl.BLEND),this.vertexPositionArray.set(new Float32Array([0,0,this._width,0,this._width,this._height,0,this._height]),0),this.vertexPositionArrayIndex=8,this.vertexColorArray.set(GS.FloatArray(16,0),0),this.vertexIndexArray.set(GS.UInt16Array([0,1,2,0,2,3]),0),this.vertexColorArrayIndex=16,this.vertexIndexArrayIndex=6;var pm=this._currentModelViewMatrix;this._currentModelViewMatrix=this._currentContext._currentMatrix,this.__renderGeometrySolid(),this._currentModelViewMatrix=pm,gl.enable(gl.BLEND)},__setBlendMode:function(blendMode){var gl=this._gl;if(blendMode!==this._blendModeSet){switch(this._blendModeSet=blendMode,gl.enable(gl.BLEND),blendMode){case"source-over":gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA);break;case"source-out":gl.blendFunc(gl.ONE_MINUS_DST_ALPHA,gl.ZERO);break;case"source-in":gl.blendFunc(gl.DST_ALPHA,gl.ZERO);break;case"source-atop":gl.blendFunc(gl.DST_ALPHA,gl.ONE_MINUS_SRC_ALPHA);break;case"destination-over":gl.blendFunc(gl.ONE_MINUS_DST_ALPHA,gl.DST_ALPHA);break;case"destination-in":gl.blendFunc(gl.ZERO,gl.SRC_ALPHA);break;case"destination-out":gl.blendFunc(gl.ZERO,gl.ONE_MINUS_SRC_ALPHA);break;case"destination-atop":gl.blendFunc(gl.ONE_MINUS_DST_ALPHA,gl.SRC_ALPHA);break;case"multiply":gl.blendFunc(gl.DST_COLOR,gl.ONE_MINUS_SRC_ALPHA);break;case"screen":gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_COLOR);break;case"copy":gl.blendFunc(gl.ONE,gl.ZERO);break;case"lighter":gl.blendFunc(gl.ONE,gl.ONE);break;case"darker":gl.blendFunc(gl.DST_COLOR,gl.ONE_MINUS_SRC_ALPHA);break;case"xor":gl.blendFunc(gl.ONE_MINUS_DST_ALPHA,gl.ONE_MINUS_SRC_ALPHA);break;case"add":gl.blendFunc(gl.SRC_ALPHA,gl.DST_ALPHA);break;default:blendMode="source-over",gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA)}this._currentGlobalCompositeOperation=blendMode}},clearQuad:function(x,y,w,h){this.flush();var _pfs=this._currentContext._fillStyle;this._currentContext._fillStyle=[0,0,0,0],this.addQuad(x,y,w,h);var gl=this._gl;gl.disable(gl.BLEND),this.flush(),this._currentContext._fillStyle=_pfs,gl.enable(gl.BLEND)},pushClipPath:function(){this.flush(),this._currentContext._clipPaths.push(this._currentContext._pathTracer.clone()),this.__enableStencil(),this.__fillClipPath(this._pathTracer),this.__disableStencil()},__enableStencil:function(){var gl=this._gl;gl.enable(gl.STENCIL_TEST),gl.colorMask(!1,!1,!1,!1),1===this._currentContext._clipPaths.length?(gl.stencilFunc(gl.ALWAYS,1,255),gl.stencilOp(gl.KEEP,gl.KEEP,gl.REPLACE),this.stencilClipValue=1):(gl.stencilFunc(gl.ALWAYS,1,255),gl.stencilOp(gl.KEEP,gl.KEEP,gl.INCR),this.stencilClipValue+=1)},__enableStencilDecrease:function(){var gl=this._gl;gl.enable(gl.STENCIL_TEST),gl.colorMask(!1,!1,!1,!1),gl.stencilFunc(gl.ALWAYS,1,255),gl.stencilOp(gl.KEEP,gl.KEEP,gl.DECR),this.stencilClipValue-=1},__disableStencil:function(){var gl=this._gl;gl.colorMask(!0,!0,!0,!0),gl.stencilFunc(gl.EQUAL,this.stencilClipValue,255),gl.stencilOp(gl.KEEP,gl.KEEP,gl.KEEP)},popClipPaths:function(){if(!this._currentContext._clipPaths.length)return void(this.stencilClipValue=0);this.flush();var gl=this._gl;gl.enable(gl.STENCIL_TEST),gl.colorMask(!1,!1,!1,!1),gl.stencilFunc(gl.ALWAYS,1,255),gl.stencilOp(gl.KEEP,gl.KEEP,gl.DECR);for(var i=this._currentContext._clipPaths.length-1;i>=0;i--){var cs=this._currentContext._clipPaths[i];this.__fillClipPath(cs)}this.stencilClipValue-=1,gl.colorMask(!0,!0,!0,!0),gl.stencilFunc(gl.EQUAL,this.stencilClipValue,255),gl.stencilOp(gl.KEEP,gl.KEEP,gl.KEEP),this._currentContext._clipPaths=[]},setTransform:function(m00,m01,m10,m11,m02,m12){GS.Math.Matrix.setTransform(this._currentContext._currentMatrix,m00,m01,m10,m11,m02,m12)},transform:function(m00,m01,m10,m11,m02,m12){GS.Math.Matrix.transform(this._currentContext._currentMatrix,m00,m01,m10,m11,m02,m12)},save:function(){var context=this._currentContext.clone();this._contextStack.push(context),this._currentContext=context,this._pathTracer=this._currentContext._pathTracer},restore:function(){if(this._contextStack.length>1){this.popClipPaths();var prevContext=this._contextStack.pop(),context=this._contextStack[this._contextStack.length-1];if(this._currentContext=context,this._pathTracer=context._pathTracer,prevContext._globalCompositeOperation!==context._globalCompositeOperation&&(prevContext._globalCompositeOperation=context._globalCompositeOperation),1===this._contextStack.length){var gl=this._gl;gl.disable(gl.STENCIL_TEST)}}else console.log("restoring context underflow.")},clip:function(){this.pushClipPath()},clipPath:function(path){path.fill(this),this.pushClipPath(path)},translate:function(tx,ty){return GS.Math.Matrix.multiply(this._currentContext._currentMatrix,GS.Math.Matrix.createTranslate(tx,ty)),this},rotate:function(angle){return GS.Math.Matrix.multiply(this._currentContext._currentMatrix,GS.Math.Matrix.createRotate(angle)),this},scale:function(sx,sy){return GS.Math.Matrix.multiply(this._currentContext._currentMatrix,GS.Math.Matrix.createScale(sx,sy)),this},strokeRect:function(x0,y0,w,h){this.beginPath(),this.moveTo(x0,y0),this.lineTo(x0+w,y0),this.lineTo(x0+w,y0+h),this.lineTo(x0,y0+h),this.closePath(),this.stroke()},stroke:function(path){var movelViewMatrix=__identityMatrix;if(path)movelViewMatrix=this._currentContext._currentMatrix,path.prepareStroke(pt,this._currentContext._lineWidth,this._currentContext._miterLimit);else{path=this._pathTracer;var dx,dy;__p0.set(0,0),__p1.set(0,this._currentContext._lineWidth),GS.Math.Matrix.transformPoint(__p0,this._currentContext._currentMatrix),GS.Math.Matrix.transformPoint(__p1,this._currentContext._currentMatrix),dx=__p1.x-__p0.x,dy=__p1.y-__p0.y;var lineWidth=Math.sqrt(dx*dx+dy*dy);path.prepareStroke(pt,lineWidth,this._currentContext._miterLimit)}this.addPath(path._strokeGeometryBufferData,movelViewMatrix,this._currentContext._strokeStyle)},fill:function(path){var modelViewMatrix=__identityMatrix;path?modelViewMatrix=this._currentContext._currentMatrix:path=this._pathTracer,path.prepareFill(ear),this.addPath(path._fillGeometryBufferData,modelViewMatrix,this._currentContext._fillStyle)},__fillClipPath:function(path){path.prepareFill(ear),this.addPathImpl(path._fillGeometryBufferData),this.__renderGeometrySolid(),this.flushCounters()},isClipping:function(){return this.stencilClipValue>0},__restoreClippingRegions:function(){var gl=this._gl,cco=this._currentContext._globalCompositeOperation;this._currentContext._globalCompositeOperation="source-over",gl.clear(gl.STENCIL_BUFFER_BIT),this.stencilClipValue=0,gl.enable(gl.STENCIL_TEST),gl.colorMask(!1,!1,!1,!1),gl.stencilFunc(gl.ALWAYS,1,255),gl.stencilOp(gl.KEEP,gl.KEEP,gl.INCR);for(var i=0;i<this._contextStack.length;i++)for(var j=0;j<this._contextStack[i]._clipPaths.length;j++){var cs=this._contextStack[i]._clipPaths[j];this.stencilClipValue++,this.__fillClipPath(cs)}gl.colorMask(!0,!0,!0,!0),gl.stencilFunc(gl.EQUAL,this.stencilClipValue,255),gl.stencilOp(gl.KEEP,gl.KEEP,gl.KEEP),this._currentContext._globalCompositeOperation=cco},beginPath:function(){return this._pathTracer.beginPath()},moveTo:function(x,y){return this._pathTracer.moveTo(x,y,this._currentContext._currentMatrix)},lineTo:function(x,y){return this._pathTracer.lineTo(x,y,this._currentContext._currentMatrix)},rect:function(x,y,w,h){return this._pathTracer.rect(x,y,w,h,this._currentContext._currentMatrix)},oval:function(x,y,r,startAngle,endAngle,cc){return this._pathTracer.oval(x,y,r,startAngle,endAngle,cc,this._currentContext._currentMatrix)},arcTo:function(x1,y1,x2,y2,radius){return this._pathTracer.arcTo(x1,y1,x2,y2,radius,this._currentContext._currentMatrix)},closePath:function(){return this._pathTracer.closePath()},quadraticCurveTo:function(x0,y0,x1,y1){return this._pathTracer.quadraticCurveTo(x0,y0,x1,y1,this._currentContext._currentMatrix)},bezierCurveTo:function(x0,y0,x1,y1,x2,y2){return this._pathTracer.bezierCurveTo(x0,y0,x1,y1,x2,y2,this._currentContext._currentMatrix)},addCustomShader:function(shader){return this._customShaders.push(shader),this._customShaders.length-1},__drawStencilMask:function(sid,x,y){this.flush(),this.__enableStencil(),this.addQuadWithTexture(x,y,sid._width,sid._height,0,0,sid._u1,sid._v1,sid._owner._textureId),this._currentFillStyleInfo=FillStyleInfo.IMAGE_ALPHA_THRESHOLD,this.flush(),this.__disableStencil()},fillText:function(text,x,y){this.__drawText(this._textCache.getTextInfo(text,this._currentContext._fontDefinition,!0),x,y,!0)},__drawText:function(textInfo,x,y,isFill){var pFillStyleInfo=this._currentFillStyleInfo,pTintColor=this._currentContext._tintColor,baseline=this._currentContext._textBaseline;switch(baseline){case"top":break;case"bottom":y-=textInfo.height;break;case"middle":y-=textInfo.height/2;break;case"alphabetic":y-=textInfo.baseline}var textalign=this._currentContext._textAlign;switch(textalign){case"left":break;case"center":x-=textInfo.width/2;break;case"right":x-=textInfo.width}var si=textInfo.spriteImage.getImageSprite();this.__drawStencilMask(si,x,y),x>>=0,y>>=0;var cfillStyle=GS.RendererUtils.parseStyle(isFill?this._currentContext._fillStyle:this._currentContext._strokeStyle);FillStyleInfo.getFromStyle(cfillStyle)===FillStyleInfo.SOLID?(this._currentContext._tintColor=cfillStyle,this.addQuadWithTexture(x,y,si._width,si._height,0,0,si._u1,si._v1,si._owner._textureId)):this.addQuad(x,y,si._width,si._height),this.flush(),this.__enableStencilDecrease(),this.addQuadWithTexture(x,y,si._width,si._height,0,0,si._u1,si._v1,si._textureId),this.flush(),this.__disableStencil(),this._currentContext._tintColor=pTintColor,this._currentFillStyleInfo=pFillStyleInfo},strokeText:function(text,x,y){this.__drawText(this._textCache.getTextInfo(text,this._currentContext._fontDefinition,!1,this._currentContext._lineWidth),x,y,!1)}},GS.WebGLRenderingContext=function(canvas){try{var obj={premultipliedAlpha:GS.WebGL.UNPACK_PREMULTIPLY_ALPHA_WEBGL,antialias:GS.WebGL.ANTIALIAS,alpha:GS.WebGL.CTX_ALPHA,stencil:!0};this._gl=canvas.getContext("webgl",obj)||canvas.getContext("experimental-webgl",obj),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,GS.WebGL.UNPACK_PREMULTIPLY_ALPHA_WEBGL)}catch(e){alert(e)}if(!this._gl)throw new Error("WebGL is not available.");return this._width=canvas.width,this._height=canvas.height,this._batch=new Batch(this._gl,this._width,this._height),this._frameBufferInfo={},this._currentFrameBufferInfo=null,this._texturePacker=new GS.Plugin.TexturePacker({gl:this._gl,reusePages:!0,clusterImages:!0,padding:1}),this.canvas=canvas,this._filters={},this._filterBuffers=null,this};var __GS_WebGLRenderingContext={setTexturePacker:function(packer){this._texturePacker=packer},getWebGLCanvasContext:function(){return this._gl},createPattern:function(spriteImageData,type){return"no-repeat"!==type&&"repeat"!==type&&"repeat-x"!==type&&"repeat-y"!==type&&(type="repeat"),spriteImageData instanceof GS.SpriteImage&&(spriteImageData=spriteImageData.getImageSprite()),new Pattern(spriteImageData,type)},createLinearGradient:function(x0,y0,x1,y1){return new LinearGradient(x0,y0,x1,y1)},createRadialGradient:function(x0,y0,r0,x1,y1,r1){return new RadialGradient(x0,y0,r0,x1,y1,r1)},clearRect:function(x,y,w,h){this._batch.clearQuad(x,y,w,h)},fillRect:function(_x,_y,_w,_h,isAA){this._batch.addQuad(_x,_y,_w,_h,isAA)},filterRect:function(_x,_y,_w,_h,si,isAA){this._batch.addQuadFilter(_x,_y,_w,_h,si,isAA)},drawImage:function(_image,_x,_y,__w,__h,__dx,__dy,__dw,__dh){if(_image){if(_image.width){if(!_image.__id&&-1===this._texturePacker.addImage(_image))return;_image=this._texturePacker.getSpriteImageDataById(_image.__id)}var _w,_h,_sx,_sy,_sw,_sh,u0,v0,u1,v1,len=arguments.length,isAA=!1;if(len>=9)_w=__dw,_h=__dh,_sx=_x,_sy=_y,_sw=__w,_sh=__h,_x=__dx,_y=__dy,u0=(_image._x+_sx)/_image._owner._imageWidth,v0=(_image._y+_sy)/_image._owner._imageHeight,u1=(_image._x+_sx+_sw)/_image._owner._imageWidth,v1=(_image._y+_sy+_sh)/_image._owner._imageHeight,10===len&&(isAA=arguments[9]);else if(len>=5)_w=__w,_h=__h,u0=_image._u0,v0=_image._v0,u1=_image._u1,v1=_image._v1,6===len&&(isAA=arguments[5]);else{if(!(arguments.length>=3))return;_w=_image._width,_h=_image._height,u0=_image._u0,v0=_image._v0,u1=_image._u1,v1=_image._v1,4===len&&(isAA=arguments[3])}this._batch.addQuadWithTexture(_x,_y,_w,_h,u0,v0,u1,v1,_image._owner._textureId,isAA)}},flush:function(){this._batch.flush()},createOffscreenCanvas:function(id,pwidth,pheight,flags){var gl=this._gl;if(!this._frameBufferInfo[id]){pwidth=pwidth||this._width,pheight=pheight||this._height;var width=GS.WebGLUtils.nextPowerOf2(pwidth),height=GS.WebGLUtils.nextPowerOf2(pheight),frameBuffer=gl.createFramebuffer();gl.bindFramebuffer(gl.FRAMEBUFFER,frameBuffer);var frameBufferTexture=gl.createTexture();if(gl.bindTexture(gl.TEXTURE_2D,frameBufferTexture),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,width,height,0,gl.RGBA,gl.UNSIGNED_BYTE,null),flags&&flags.depth){var renderbuffer=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,renderbuffer),gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_COMPONENT16,width,height),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.RENDERBUFFER,renderbuffer)}gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,frameBufferTexture,0),gl.bindTexture(gl.TEXTURE_2D,null),flags&&flags.depth&&gl.bindRenderbuffer(gl.RENDERBUFFER,null),gl.bindFramebuffer(gl.FRAMEBUFFER,null),this._frameBufferInfo[id]={flags:flags,textureWidth:width,textureHeight:height,width:pwidth,height:pheight,frameBuffer:frameBuffer,frameBufferTexture:frameBufferTexture,spriteImage:(new GS.SpriteImage).setFrameBuffer(frameBufferTexture,pwidth,pheight,width,height)}}return this._frameBufferInfo[id]},getOffscreenCanvasSpriteImage:function(id){var fbi=this._frameBufferInfo[id];return fbi?fbi.spriteImage:null},enableOffscreenCanvas:function(id){var fbi=this._frameBufferInfo[id],gl=this._gl;this._currentFrameBufferInfo=fbi,gl.bindFramebuffer(gl.FRAMEBUFFER,fbi?fbi.frameBuffer:null)},startRender:function(){var gl=this._gl;gl.clear(gl.DEPTH_BUFFER_BIT|gl.STENCIL_BUFFER_BIT)},setTransform:function(m00,m01,m10,m11,m02,m12){this._batch.setTransform(m00,m01,m10,m11,m02,m12)},transform:function(m00,m01,m10,m11,m02,m12){this._batch.transform(m00,m01,m10,m11,m02,m12)},save:function(){this._batch.save()},restore:function(){this._batch.restore()},clip:function(){this._batch.clip()},clipPath:function(path){this._batch.clipPath(path)},fillGeometry:function(vertices,indices){return this._batch.fillGeometry(vertices,indices)},fillGeometryQuadWithTexture:function(_image,vertices,indices){if(_image){if(_image.width){if(!_image.__id&&-1===this._texturePacker.addImage(_image))return;
_image=this._texturePacker.getSpriteImageDataById(_image.__id)}var u0,v0,u1,v1;u0=_image._u0,v0=_image._v0,u1=_image._u1,v1=_image._v1,this._batch.fillGeometryQuadWithTexture(vertices,indices,_image._owner._textureId,u0,v0,u1,v1)}},translate:function(tx,ty){return this._batch.translate(tx,ty)},rotate:function(angle){return this._batch.rotate(angle)},scale:function(sx,sy){return this._batch.scale(sx,sy)},beginPath:function(){return this._batch.beginPath()},moveTo:function(x,y){return this._batch.moveTo(x,y)},lineTo:function(x,y){return this._batch.lineTo(x,y)},rect:function(x,y,w,h){return this._batch.rect(x,y,w,h)},arc:function(x,y,r,startAngle,endAngle,cc){return this._batch.oval(x,y,r,startAngle,endAngle,cc)},arcTo:function(x1,y1,x2,y2,radius){return this._batch.arcTo(x1,y1,x2,y2,radius)},closePath:function(){return this._batch.closePath()},quadraticCurveTo:function(x0,y0,x1,y1){return this._batch.quadraticCurveTo(x0,y0,x1,y1)},bezierCurveTo:function(x0,y0,x1,y1,x2,y2){return this._batch.bezierCurveTo(x0,y0,x1,y1,x2,y2)},strokeRect:function(x0,y0,w,h){this._batch.strokeRect(x0,y0,w,h)},stroke:function(path){this._batch.stroke(path)},fill:function(path){this._batch.fill(path)},fillText:function(text,x,y){this._batch.fillText(text,x,y)},strokeText:function(text,x,y){this._batch.strokeText(text,x,y)},addFilter:function(Filter,id){null===this._filterBuffers&&(this._filterBuffers=[],this._filterBuffers.push(this.createOffscreenCanvas("filter0")),this._filterBuffers.push(this.createOffscreenCanvas("filter1")));var programFilter=new Filter(this._gl);this._filters[id]=programFilter},getFilter:function(id){return this._filters[id]},startFiltering:function(){this.flush(),this.enableOffscreenCanvas("filter0"),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.STENCIL_BUFFER_BIT),this._indexFilter=0},applyFilters:function(actor,time){this.flush();var source;GS.Math.Matrix.copy(this._batch._currentContext._currentMatrix,__matrixCopy),GS.Math.Matrix.identity(this._batch._currentContext._currentMatrix);for(var filters=actor._filters,i=0;i<filters.length;i++){var filter=this._filters[filters[i]];if(filter){source="filter"+this._indexFilter,this._indexFilter=(this._indexFilter+1)%2;var sourcenext="filter"+this._indexFilter;i===filters.length-1?this.enableOffscreenCanvas():(this.enableOffscreenCanvas(sourcenext),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.STENCIL_BUFFER_BIT)),this.fillStyle=filter,this.fillStyle.setSourceTexture(this.getOffscreenCanvasSpriteImage(source)._textureId),this.fillStyle.setTime(time),this.filterRect(0,0,this._width,this._height,this.getOffscreenCanvasSpriteImage(source)._mainImageElement),this.flush()}GS.Math.Matrix.copy(__matrixCopy,this._batch._currentContext._currentMatrix)}}};GS.Object.extend(GS.WebGLRenderingContext,__GS_WebGLRenderingContext);var parseStyle=GS.RendererUtils.parseStyle;Object.defineProperty(GS.WebGLRenderingContext.prototype,"type",{get:function(){return"webgl"},set:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(GS.WebGLRenderingContext.prototype,"tintColor",{get:function(){return this._batch._currentContext._tintColor},set:function(v){this._batch._currentContext._tintColor=v},enumerable:!0,configurable:!0}),Object.defineProperty(GS.WebGLRenderingContext.prototype,"fillStyle",{get:function(){return this._batch._currentContext._fillStyle},set:function(v){this._batch._currentContext._fillStyle=v},enumerable:!0,configurable:!0}),Object.defineProperty(GS.WebGLRenderingContext.prototype,"strokeStyle",{get:function(){return this._batch._currentContext._strokeStyle},set:function(v){this._batch._currentContext._strokeStyle=v},enumerable:!0,configurable:!0}),Object.defineProperty(GS.WebGLRenderingContext.prototype,"lineWidth",{get:function(){return this._batch._currentContext._lineWidth},set:function(v){this._batch._currentContext._lineWidth=v},enumerable:!0,configurable:!0}),Object.defineProperty(GS.WebGLRenderingContext.prototype,"lineJoin",{get:function(){return this._batch._pathTracer.lineJoin},set:function(v){this._batch._pathTracer.lineJoin=v},enumerable:!0,configurable:!0}),Object.defineProperty(GS.WebGLRenderingContext.prototype,"lineCap",{get:function(){return this._batch._pathTracer.lineCap},set:function(v){this._batch._pathTracer.lineCap=v},enumerable:!0,configurable:!0}),Object.defineProperty(GS.WebGLRenderingContext.prototype,"globalCompositeOperation",{get:function(){return this._batch._currentContext._globalCompositeOperation},set:function(blendMode){this._batch._currentContext._globalCompositeOperation=blendMode},enumerable:!0,configurable:!0}),Object.defineProperty(GS.WebGLRenderingContext.prototype,"miterLimit",{get:function(){return this._batch._currentContext._miterLimit},set:function(limit){this._batch._currentContext._miterLimit=limit},enumerable:!0,configurable:!0}),Object.defineProperty(GS.WebGLRenderingContext.prototype,"globalAlpha",{get:function(){return this._batch._currentContext._globalAlpha},set:function(alpha){this._batch._currentContext._globalAlpha=alpha},enumerable:!0,configurable:!0}),Object.defineProperty(GS.WebGLRenderingContext.prototype,"font",{get:function(){return this._batch._currentContext._fontDefinition},set:function(font){this._batch._currentContext._fontDefinition=font},enumerable:!0,configurable:!0}),Object.defineProperty(GS.WebGLRenderingContext.prototype,"textBaseline",{get:function(){return this._batch._currentContext._textBaseline},set:function(tbl){this._batch._currentContext._textBaseline=tbl},enumerable:!0,configurable:!0}),Object.defineProperty(GS.WebGLRenderingContext.prototype,"textAlign",{get:function(){return this._batch._currentContext._textAlign},set:function(ta){this._batch._currentContext._textAlign=ta},enumerable:!0,configurable:!0})}(),function(){"use strict";var _unitsMatrix=GS.Math.Matrix.IDENTITY;CanvasRenderingContext2D.prototype._createPattern=CanvasRenderingContext2D.prototype.createPattern,CanvasRenderingContext2D.prototype.createPattern=function(image,type){if(image instanceof GS.SpriteImage&&(image=image._mainImageElement),image instanceof GS.SpriteImageData){var c=document.createElement("canvas");c.width=image._width,c.height=image._height;var ctx=c.getContext("2d");image.drawInCanvasAtPosWithSize(ctx,0,0,c.width,c.height),image=c}return this._createPattern(image,type)},CanvasRenderingContext2D.prototype.flush=function(){},CanvasRenderingContext2D.prototype.setTexturePacker=function(){},CanvasRenderingContext2D.prototype._drawImage=CanvasRenderingContext2D.prototype.drawImage,CanvasRenderingContext2D.prototype.drawImage=function(image,p0,p1,p2,p3,p4,p5,p6,p7){return image instanceof GS.SpriteImageData?void(arguments.length>=8?image.drawInCanvasAtPosWithSizeAndSource(this,p0,p1,p2,p3,p4,p5,p6,p7):arguments.length>=5?image.drawInCanvasAtPosWithSize(this,p0,p1,p2,p3):image.drawInCanvasAtPos(this,p0,p1)):arguments.length>=9?this._drawImage.call(this,image,p0,p1,p2,p3,p4,p5,p6,p7):arguments.length>=5?this._drawImage.call(this,image,p0,p1,p2,p3):this._drawImage.call(this,image,p0,p1)},CanvasRenderingContext2D.prototype._setTransform=CanvasRenderingContext2D.prototype.setTransform,CanvasRenderingContext2D.prototype.setTransform=function(m00,m01,m10,m11,m02,m12){_unitsMatrix!==GS.Math.Matrix.IDENTITY?(this._setTransform(_unitsMatrix[0],_unitsMatrix[3],_unitsMatrix[1],_unitsMatrix[4],_unitsMatrix[2],_unitsMatrix[5]),this.transform(m00,m01,m10,m11,m02,m12)):this._setTransform(m00,m01,m10,m11,m02,m12)},GS.RendererCanvas=function(w,h,surface){return this._surface=null,this._ctx=null,w&&h&&this.initialize(w,h,surface),this._sizeInUnits={width:w,height:h},this._sizeInPixels={width:w,height:h},this},GS.RendererCanvas.prototype={initialize:function(w,h,surface){this._surface=surface?surface:document.createElement("canvas"),this._surface.width=w,this._surface.height=h,this._ctx=this._surface.getContext("2d"),Object.defineProperty(this._ctx,"type",{get:function(){return"canvas"},set:function(){},enumerable:!0,configurable:!0})},getContext:function(){return this._ctx},getRenderingContext:function(){return this.getContext()},render:function(scene,elapsedTimeBetweenFrames){scene.incrementTimeLineBy(elapsedTimeBetweenFrames),scene.processFrame(this._ctx,scene._time)},startRender:function(){},__setUnitsMatrix:function(matrix){_unitsMatrix=matrix},getUnitsMatrix:function(){return _unitsMatrix},flush:function(){},getSizeInPixels:function(){return this._sizeInPixels},getSize:function(){return this._sizeInUnits},addFilter:function(){},orientationChange:function(){var tmp;tmp=this._sizeInPixels.width,this._sizeInPixels.width=this._sizeInPixels.height,this._sizeInPixels.height=tmp,tmp=this._sizeInUnits.width,this._sizeInUnits.width=this._sizeInUnits.height,this._sizeInUnits.height=tmp,this.initialize(this._sizeInPixels.width,this._sizeInPixels.height),tmp=_unitsMatrix[0],_unitsMatrix[0]=_unitsMatrix[4],_unitsMatrix[4]=tmp},scaleToScreen:function(){var surface=this._surface,scale=Math.min(window.innerWidth/surface.width,window.innerHeight/surface.height);return surface.style.width=surface.width*scale+"px",surface.style.height=surface.height*scale+"px",this},setUnits:function(unitsInfo){var sp=this.getSizeInPixels();if(unitsInfo=unitsInfo||{},unitsInfo.width=unitsInfo.width||sp.width,unitsInfo.height=unitsInfo.height||sp.height,unitsInfo.strategy=unitsInfo.strategy||"fit","resize"===unitsInfo.strategy){var unitsSize=GS.RendererUtils.calculatePreferredUnitsForViewport(unitsInfo.width,unitsInfo.height,sp.width,sp.height);unitsInfo.width=unitsSize.width,unitsInfo.height=unitsSize.height,unitsInfo.strategy="fit",console.log("New units size: "+unitsInfo.width+","+unitsInfo.height)}this._sizeInUnits={width:unitsInfo.width,height:unitsInfo.height},this.__setUnitsMatrix(GS.RendererUtils.getUnitsMatrix(unitsInfo.strategy,unitsInfo.width,unitsInfo.height,sp.width,sp.height))},prepareImage:function(){}}}(),function(){var _mat4=GS.FloatArray(16,0);_mat4[0]=_mat4[5]=_mat4[10]=_mat4[15]=1,GS.WebGL.PlasmaShader=function(gl,ortho){return GS.WebGL.PlasmaShader._superclass.constructor.call(this,gl,{vertexShader:"uniform vec2 uResolution; \nattribute vec2 aVertexPosition; \nvarying vec2 surfacePosition;\nvoid main(void) { \ngl_Position = vec4( aVertexPosition.x / (uResolution.x/2.0) -1.0, aVertexPosition.y / (-uResolution.y/2.0) + 1.0, 0.0, 1.0 );\n}\n",fragmentShader:"precision mediump float; \nuniform float uGlobalTime; \nconst float PI = 3.14159265;\nfloat time = uGlobalTime;\nvarying vec2 surfacePosition;\nuniform mat4 uTransform; \nuniform mat4 uOrtho; \nvoid main(void ) {\nvec4 surfacePosition=   uTransform * gl_FragCoord;\nfloat color1, color2, color;\ncolor1 = (sin(dot(surfacePosition.xy,vec2(sin(time*3.0),cos(time*3.0)))*0.02+time*3.0)+1.0)/2.0;\nvec2 center = vec2(640.0/2.0, 360.0/2.0) + vec2(640.0/2.0*sin(-time*3.0),360.0/2.0*cos(-time*3.0));\ncolor2 = (cos(length(surfacePosition.xy - center)*0.03)+1.0)/2.0;\ncolor = (color1+ color2)/2.0;\nfloat red	= (cos(PI*color/0.5+time*3.0)+1.0)/2.0;\nfloat green	= (sin(PI*color/0.5+time*3.0)+1.0)/2.0;\nfloat blue	= (sin(+time*3.0)+1.0)/2.0;\ngl_FragColor = vec4(red, green, blue, 1.0);\n}\n",uniforms:{uTransform:{type:"m4v",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},uOrtho:{type:"m4v",value:ortho},uGlobalTime:{type:"1f",value:0},uResolution:{type:"2fv",value:[0,0]}},attributes:{aVertexPosition:{}}}),this._uModelView=this.findUniform("uTransform"),this._uGlobalTime=this.findUniform("uGlobalTime"),this._uResolution=this.findUniform("uResolution"),this._attributePosition=this.findAttribute("aVertexPosition"),this};var __GS_WebGL_PlasmaShader={updateUniformValues:function(shaderTransform,modelViewTransform,resolution){var _mat=GS.Math.Matrix.inverse(modelViewTransform);this._uModelView.value=this.mat4_from_mat3(_mat,_mat4),this._uResolution.value=resolution},flushBuffersWithContent:function(vertexPositionBuffer,vertexPositionArray,vertexColorBuffer,vertexColorArray,vertexUVBuffer,vertexUVArray,vertexIndexBuffer,vertexIndexArray,numVertex){var gl=this._gl;gl.bindBuffer(gl.ARRAY_BUFFER,vertexPositionBuffer),gl.bufferSubData(gl.ARRAY_BUFFER,0,vertexPositionArray),gl.vertexAttribPointer(this._attributePosition.location,2,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,vertexIndexBuffer),gl.bufferSubData(gl.ELEMENT_ARRAY_BUFFER,0,vertexIndexArray),gl.drawElements(gl.TRIANGLES,numVertex,gl.UNSIGNED_SHORT,0)}};GS.WebGLShaderProgram.extend(GS.WebGL.PlasmaShader,__GS_WebGL_PlasmaShader)}(),function(){var _mat4=GS.FloatArray(16,0);_mat4[0]=_mat4[5]=_mat4[10]=_mat4[15]=1,GS.WebGL.TurbulenceShader=function(gl,ortho){return GS.WebGL.TurbulenceShader._superclass.constructor.call(this,gl,{vertexShader:"uniform vec2 uResolution; \nuniform mat4 uModelView; \nuniform mat4 uOrtho; \nattribute vec2 aVertexPosition; \nvarying vec2 surfacePosition;\nvoid main(void) { \ngl_Position = vec4( aVertexPosition.x / (uResolution.x/2.0) -1.0, aVertexPosition.y / (-uResolution.y/2.0) + 1.0, 0, 1.0 );\nsurfacePosition= (uOrtho * uModelView * vec4(aVertexPosition, 0.0, 1.0)).xy;\n}\n",fragmentShader:"precision mediump float;                                                           \n\nuniform float uGlobalTime;\nvarying vec2 surfacePosition;\n\n#define MAX_ITER 3\nvoid main( void ) {\n	vec2 p = surfacePosition*8.0- vec2(20.0);\n	vec2 i = p;\n	float c = 1.0;\n	float inten = .05;\n\n	for (int n = 0; n < MAX_ITER; n++) \n	{\n		float t = uGlobalTime * (1.0 - (3.0 / float(n+1)));\n		i = p + vec2(cos(t - i.x) + sin(t + i.y), sin(t - i.y) + cos(t + i.x));\n		c += 1.0/length(vec2(p.x / (sin(i.x+t)/inten),p.y / (cos(i.y+t)/inten)));\n	}\n	c /= float(MAX_ITER);\n	c = 1.5-sqrt(c);\n	gl_FragColor = vec4(vec3(c*c*c*c), 1.0);\n\n}\n",uniforms:{uResolution:{type:"2fv",value:[]},uGlobalTime:{type:"1f",value:0},uModelView:{type:"m4v",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},uOrtho:{type:"m4v",value:ortho}},attributes:{aVertexPosition:{}}}),this._uResolution=this.findUniform("uResolution"),this._uGlobalTime=this.findUniform("uGlobalTime"),this._uModelView=this.findUniform("uModelView"),this._attributePosition=this.findAttribute("aVertexPosition"),this};var __GS_WebGL_TurbulenceShader={updateUniformValues:function(shaderTransform,modelViewTransform,resolution){var _mat=GS.Math.Matrix.inverse(modelViewTransform);this._uModelView.value=this.mat4_from_mat3(_mat,_mat4),this._uResolution.value=resolution},flushBuffersWithContent:function(vertexPositionBuffer,vertexPositionArray,vertexColorBuffer,vertexColorArray,vertexUVBuffer,vertexUVArray,vertexIndexBuffer,vertexIndexArray,numVertex){var gl=this._gl;gl.bindBuffer(gl.ARRAY_BUFFER,vertexPositionBuffer),gl.bufferSubData(gl.ARRAY_BUFFER,0,vertexPositionArray),gl.vertexAttribPointer(this._attributePosition.location,2,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,vertexIndexBuffer),gl.bufferSubData(gl.ELEMENT_ARRAY_BUFFER,0,vertexIndexArray),gl.drawElements(gl.TRIANGLES,numVertex,gl.UNSIGNED_SHORT,0)}};GS.WebGLShaderProgram.extend(GS.WebGL.TurbulenceShader,__GS_WebGL_TurbulenceShader)}(),function(){var _mat4=GS.FloatArray(16,0);_mat4[0]=_mat4[5]=_mat4[10]=_mat4[15]=1,GS.WebGL.SpiralShader=function(gl,ortho){return GS.WebGL.SpiralShader._superclass.constructor.call(this,gl,{vertexShader:"uniform vec2 uResolution; \nattribute vec2 aVertexPosition; \nvarying vec2 position;\nvoid main(void) { \ngl_Position = vec4( aVertexPosition.x / (uResolution.x/2.0) -1.0, aVertexPosition.y / (-uResolution.y/2.0) + 1.0, 0.0, 1.0 );\nposition= aVertexPosition.xy;\n}\n",fragmentShader:"precision mediump float; \nuniform float uGlobalTime; \nfloat time = uGlobalTime;\nvarying vec2 position;\nuniform mat4 uTransform; \nuniform mat4 uOrtho; \nvoid main(void ) {\nfloat angle= degrees(atan(400.0-position.x, 300.0-position.y));\nfloat r= length(vec2(400.0-position.x, 300.0-position.y));\nfloat fc= 1.0 - 1.0 * r/500.0;\nfloat f= mod( angle/2.0 - time*5.0 + log(r) * 50.0, 30.0) ;\nif ( f<15.0 ) {\n  gl_FragColor = vec4(1.0*fc, 1.0*fc, 1.0*fc, 1.0-1.0*fc);\n} else {\n  gl_FragColor = vec4(1.0*fc, 0.0, 1.0*fc, 1.0-1.0*fc);\n}\n}\n",uniforms:{uTransform:{type:"m4v",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},uOrtho:{type:"m4v",value:ortho},uGlobalTime:{type:"1f",value:0},uResolution:{type:"2fv",value:[0,0]}},attributes:{aVertexPosition:{}}}),this._uModelView=this.findUniform("uTransform"),this._uGlobalTime=this.findUniform("uGlobalTime"),this._uResolution=this.findUniform("uResolution"),this._attributePosition=this.findAttribute("aVertexPosition"),this};var __GS_WebGL_PlasmaShader={updateUniformValues:function(shaderTransform,modelViewTransform,resolution){var _mat=GS.Math.Matrix.inverse(modelViewTransform);this._uModelView.value=this.mat4_from_mat3(_mat,_mat4),this._uResolution.value=resolution},flushBuffersWithContent:function(vertexPositionBuffer,vertexPositionArray,vertexColorBuffer,vertexColorArray,vertexUVBuffer,vertexUVArray,vertexIndexBuffer,vertexIndexArray,numVertex){var gl=this._gl;gl.bindBuffer(gl.ARRAY_BUFFER,vertexPositionBuffer),gl.bufferSubData(gl.ARRAY_BUFFER,0,vertexPositionArray),gl.vertexAttribPointer(this._attributePosition.location,2,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,vertexIndexBuffer),gl.bufferSubData(gl.ELEMENT_ARRAY_BUFFER,0,vertexIndexArray),gl.drawElements(gl.TRIANGLES,numVertex,gl.UNSIGNED_SHORT,0)}};GS.WebGLShaderProgram.extend(GS.WebGL.SpiralShader,__GS_WebGL_PlasmaShader)}(),function(){GS.WebGL.WaveShader=function(gl,textureId){return GS.WebGL.WaveShader._superclass.constructor.call(this,gl,{vertexShader:"precision mediump float;    \nattribute vec2 aVertexPosition; \nattribute vec2 aTextureCoord; \nattribute vec4 aColor; \nuniform vec2 uResolution; \nvarying vec2 vTextureCoord; \nvarying vec4 vAttrColor; \nvarying vec2 vpos; \nvoid main(void) { \n  gl_Position = vec4( (aVertexPosition.x / (uResolution.x/2.0)) -1.0, (aVertexPosition.y / (-uResolution.y/2.0)) + 1.0, 0, 1.0 );\n  vTextureCoord = aTextureCoord;\n  vAttrColor = aColor;\n}\n",fragmentShader:"precision mediump float;                                   \nuniform vec2 uResolution; \nuniform float uGlobalTime; \nuniform sampler2D uSampler; \nvarying vec2 vTextureCoord; \nvarying vec4 vAttrColor;\nvoid main(void) { \nfloat f= uGlobalTime / 16.0;\nfloat offset  =  .05 * sin( vTextureCoord.y*15.0 + 5.0*f );\nfloat offset2 = .025 * cos( vTextureCoord.x*20.0 + 3.0*f );\ngl_FragColor = vAttrColor * texture2D(uSampler, vec2( vTextureCoord.x + offset , vTextureCoord.y + offset2 ) );\n}\n",uniforms:{uResolution:{type:"2fv",value:[]},uSampler:{type:"t",value:textureId},uGlobalTime:{type:"1f",value:0}},attributes:{aVertexPosition:{},aTextureCoord:{},aColor:{}}}),this._uSampler=this.findUniform("uSampler"),this._uResolution=this.findUniform("uResolution"),this._uGlobalTime=this.findUniform("uGlobalTime"),this._attrPosition=this.findAttribute("aVertexPosition"),this._attrTexture=this.findAttribute("aTextureCoord"),this._attrColor=this.findAttribute("aColor"),this};var __GS_WebGL_WaveShader={updateUniformValues:function(shaderTransform,modelViewTransform,resolution){this._uResolution.value=resolution},setSourceTexture:function(texture){this._uSampler.value=texture},setTime:function(time){this._uGlobalTime.value=time/100},flushBuffersWithContent:function(vertexPositionBuffer,vertexPositionArray,vertexColorBuffer,vertexColorArray,vertexUVBuffer,vertexUVArray,vertexIndexBuffer,vertexIndexArray,numVertex){var gl=this._gl;gl.bindBuffer(gl.ARRAY_BUFFER,vertexPositionBuffer),gl.bufferSubData(gl.ARRAY_BUFFER,0,vertexPositionArray),gl.vertexAttribPointer(this._attrPosition.location,2,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,vertexColorBuffer),gl.bufferSubData(gl.ARRAY_BUFFER,0,vertexColorArray),gl.vertexAttribPointer(this._attrColor.location,4,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,vertexUVBuffer),gl.bufferSubData(gl.ARRAY_BUFFER,0,vertexUVArray),gl.vertexAttribPointer(this._attrTexture.location,2,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,vertexIndexBuffer),gl.bufferSubData(gl.ELEMENT_ARRAY_BUFFER,0,vertexIndexArray),gl.drawElements(gl.TRIANGLES,numVertex,gl.UNSIGNED_SHORT,0)}};GS.WebGLShaderProgram.extend(GS.WebGL.WaveShader,__GS_WebGL_WaveShader)}(),function(){GS.WebGL.GrayFilter=function(gl,textureId){return GS.WebGL.GrayFilter._superclass.constructor.call(this,gl,{vertexShader:"precision mediump float;    \nattribute vec2 aVertexPosition; \nattribute vec2 aTextureCoord; \nattribute vec4 aColor; \nuniform vec2 uResolution; \nvarying vec2 vTextureCoord; \nvarying vec4 vAttrColor; \nvarying vec2 vpos; \nvoid main(void) { \n  gl_Position = vec4( (aVertexPosition.x / (uResolution.x/2.0)) -1.0, (aVertexPosition.y / (-uResolution.y/2.0)) + 1.0, 0, 1.0 );\n  vTextureCoord = aTextureCoord;\n  vAttrColor = aColor;\n}\n",fragmentShader:"precision mediump float;                                   \nuniform sampler2D uSampler; \nvarying vec2 vTextureCoord; \nvarying vec4 vAttrColor;\nvoid main(void) { \n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n   float g= 0.2126*gl_FragColor.r + 0.7152*gl_FragColor.g + 0.0722*gl_FragColor.b;\n   gl_FragColor = vec4(g,g,g, gl_FragColor.w);\n}\n",uniforms:{uResolution:{type:"2fv",value:[]},uSampler:{type:"t",value:textureId},uGlobalTime:{type:"1f",value:0}},attributes:{aVertexPosition:{},aTextureCoord:{},aColor:{}}}),this._uSampler=this.findUniform("uSampler"),this._uResolution=this.findUniform("uResolution"),this._uGlobalTime=this.findUniform("uGlobalTime"),this._attrPosition=this.findAttribute("aVertexPosition"),this._attrTexture=this.findAttribute("aTextureCoord"),this._attrColor=this.findAttribute("aColor"),this};var __GS_WebGL_WaveShader={updateUniformValues:function(shaderTransform,modelViewTransform,resolution){this._uResolution.value=resolution},setSourceTexture:function(texture){this._uSampler.value=texture},setTime:function(){},flushBuffersWithContent:function(vertexPositionBuffer,vertexPositionArray,vertexColorBuffer,vertexColorArray,vertexUVBuffer,vertexUVArray,vertexIndexBuffer,vertexIndexArray,numVertex){var gl=this._gl;gl.bindBuffer(gl.ARRAY_BUFFER,vertexPositionBuffer),gl.bufferSubData(gl.ARRAY_BUFFER,0,vertexPositionArray),gl.vertexAttribPointer(this._attrPosition.location,2,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,vertexColorBuffer),gl.bufferSubData(gl.ARRAY_BUFFER,0,vertexColorArray),gl.vertexAttribPointer(this._attrColor.location,4,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,vertexUVBuffer),gl.bufferSubData(gl.ARRAY_BUFFER,0,vertexUVArray),gl.vertexAttribPointer(this._attrTexture.location,2,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,vertexIndexBuffer),gl.bufferSubData(gl.ELEMENT_ARRAY_BUFFER,0,vertexIndexArray),gl.drawElements(gl.TRIANGLES,numVertex,gl.UNSIGNED_SHORT,0)}};GS.WebGLShaderProgram.extend(GS.WebGL.GrayFilter,__GS_WebGL_WaveShader)}(),function(){var __matrix0=GS.Math.Matrix.create(),__p0=new GS.Point,__quadIndices=[0,1,2,0,2,3];GS.Actor=function(){return this._id=0,this._x=Number.MAX_VALUE,this.x=0,this._y=Number.MAX_VALUE,this.y=0,this._width=0,this._height=0,this._rotationAngle=0,this.rotationAngle=0,this._scaleX=1,this.scaleX=1,this._scaleY=1,this.scaleY=1,this._positionAnchorX=.5,this._positionAnchorY=.5,this._transformationAnchorX=.5,this._transformationAnchorY=.5,this._color=GS.FloatArray(4,1),this._parent=null,this._modelViewMatrix=GS.FloatArray(9,0),this._worldModelViewMatrix=GS.FloatArray(9,0),this._isAA=!0,this._AABB=new GS.Math.Rectangle,this._dirty=!0,this._viewVertices=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],this._spriteImageData=null,this._clip=!1,this._clipPath=null,this._fillStyle=null,this._originalFillStyle=null,this._filters=null,this._eventsEnabled=!1,this._visible=!0,this._readyToPaint=!1,GS.Math.Matrix.identity(this._modelViewMatrix),GS.Math.Matrix.identity(this._worldModelViewMatrix),this};var __GS_ActorPrototype={setPosition:function(x,y){return this.x=x,this.y=y,this},setSize:function(w,h){return this._width=w,this._height=h,this},setAlpha:function(alpha){return this._color[3]=alpha,this},setColor:function(r,g,b,a){return this._color[0]="undefined"!=typeof r?r:0,this._color[1]="undefined"!=typeof g?g:0,this._color[2]="undefined"!=typeof b?b:0,this._color[3]="undefined"!=typeof a?a:1,this},setBounds:function(x,y,w,h){return this.x=x,this.y=y,this._width=w,this._height=h,this},setRotation:function(angle){return this.rotationAngle=angle,this},setScale:function(scaleX,scaleY){return this.scaleX=scaleX,this.scaleY=scaleY,this},setPositionAnchor:function(ax,ay){return this._positionAnchorX=ax,this._positionAnchorY=ay,this},setTransformationAnchor:function(ax,ay){return this._transformationAnchorX=ax,this._transformationAnchorY=ay,this},__setModelViewMatrixAll:function(){var c,s,_m00,_m01,_m10,_m11,m00,m01,m02,m10,m11,m12;m00=1,m01=0,m10=0,m11=1,m02=this.x-this._positionAnchorX*this._width,m12=this.y-this._positionAnchorY*this._height;var rx=this._transformationAnchorX*this._width,ry=this._transformationAnchorY*this._height;m02+=m00*rx+m01*ry,m12+=m10*rx+m11*ry,c=Math.cos(this.rotationAngle),s=Math.sin(this.rotationAngle),_m00=m00,_m01=m01,_m10=m10,_m11=m11,m00=_m00*c+_m01*s,m01=-_m00*s+_m01*c,m10=_m10*c+_m11*s,m11=-_m10*s+_m11*c,m00*=this.scaleX,m01*=this.scaleY,m10*=this.scaleX,m11*=this.scaleY,m02+=-m00*rx-m01*ry,m12+=-m10*rx-m11*ry,this._rotationAngle=this.rotationAngle,this._scaleX=this.scaleX,this._scaleY=this.scaleY,this._x=this.x,this._y=this.y,this._dirty=!0;var mm=this._modelViewMatrix;mm[0]=m00,mm[1]=m01,mm[3]=m10,mm[4]=m11,mm[2]=m02,mm[5]=m12},__setModelViewMatrixScale:function(){var m00,m01,m02,m10,m11,m12;m00=1,m01=0,m10=0,m11=1,m02=this.x-this._positionAnchorX*this._width,m12=this.y-this._positionAnchorY*this._height;var rx=this._transformationAnchorX*this._width,ry=this._transformationAnchorY*this._height;m02+=m00*rx+m01*ry,m12+=m10*rx+m11*ry,m00*=this.scaleX,m01*=this.scaleY,m10*=this.scaleX,m11*=this.scaleY,m02+=-m00*rx-m01*ry,m12+=-m10*rx-m11*ry,this._scaleX=this.scaleX,this._scaleY=this.scaleY,this._x=this.x,this._y=this.y,this._dirty=!0;var mm=this._modelViewMatrix;mm[0]=m00,mm[1]=m01,mm[3]=m10,mm[4]=m11,mm[2]=m02,mm[5]=m12},__setModelViewMatrix:function(){var mm;if(0!==this.rotationAngle||this._rotationAngle!==this.rotationAngle)this.__setModelViewMatrixAll();else if(1!==this.scaleX||1!==this.scaleY||this._scaleX!==this.scaleX||this._scaleY!==this.scaleY)this.__setModelViewMatrixScale();else if(this.x!==this._x||this.y!==this._y){GS.Math.Matrix.identity(this._modelViewMatrix),mm=this._modelViewMatrix;var x=this.x-this._positionAnchorX*this._width,y=this.y-this._positionAnchorY*this._height;mm[2]=x,mm[5]=y,this._x=this.x,this._y=this.y,this._dirty=!0}this.__setWorldModelViewMatrix()},__setWorldModelViewMatrix:function(){var mmm,mm;if(this._parent){if(this._isAA=this._parent._isAA&&0===this._rotationAngle&&1===this._scaleX&&1===this._scaleY,this._dirty||this._parent._dirty){var pmm=this._parent._worldModelViewMatrix;mmm=this._worldModelViewMatrix,mmm[0]=pmm[0],mmm[1]=pmm[1],mmm[2]=pmm[2],mmm[3]=pmm[3],mmm[4]=pmm[4],mmm[5]=pmm[5],this._isAA?(mm=this._modelViewMatrix,mmm[2]+=mm[2]*mmm[0],mmm[5]+=mm[5]*mmm[4]):GS.Math.Matrix.multiply(this._worldModelViewMatrix,this._modelViewMatrix),this._dirty=!0}}else if(this._dirty){var wmm=this._worldModelViewMatrix;mmm=this._modelViewMatrix,wmm[0]=mmm[0],wmm[1]=mmm[1],wmm[2]=mmm[2],wmm[3]=mmm[3],wmm[4]=mmm[4],wmm[5]=mmm[5],this._isAA=0===this._rotationAngle}},modelToScreen:function(point){var x,y,tm;return tm=this._worldModelViewMatrix,x=point.x,y=point.y,point.x=x*tm[0]+y*tm[1]+tm[2],point.y=x*tm[3]+y*tm[4]+tm[5],point},getScreenToModelMatrix:function(matrix){return GS.Math.Matrix.inverse(this._worldModelViewMatrix,matrix),matrix},screenToModel:function(point,matrix){var tm=matrix||this.getScreenToModelMatrix(__matrix0),x=point.x,y=point.y;return point.x=x*tm[0]+y*tm[1]+tm[2],point.y=x*tm[3]+y*tm[4]+tm[5],point},modelToModel:function(point,otherActor,matrix){return otherActor.screenToModel(this.modelToScreen(point),matrix)},__setScreenBoundsAA:function(){var vvv,x,y,w,h,vv=this._viewVertices,_w=this._width,_h=this._height;x=this._worldModelViewMatrix[2],y=this._worldModelViewMatrix[5],w=_w*this._worldModelViewMatrix[0],h=_h*this._worldModelViewMatrix[4],vvv=vv[0],vvv.x=x,vvv.y=y,vvv=vv[1],vvv.x=x+w,vvv.y=y,vvv=vv[2],vvv.x=x+w,vvv.y=y+h,vvv=vv[3],vvv.x=x,vvv.y=y+h},__setScreenBoundsNAA:function(){var vvv,vv=this._viewVertices,_x=0,_y=0,_w=this._width,_h=this._height;vvv=vv[0],vvv.x=_x,vvv.y=_y,this.modelToScreen(vvv),vvv=vv[1],vvv.x=_x+_w,vvv.y=_y,this.modelToScreen(vvv),vvv=vv[2],vvv.x=_x+_w,vvv.y=_y+_h,this.modelToScreen(vvv),vvv=vv[3],vvv.x=_x,vvv.y=_y+_h,this.modelToScreen(vvv)},__setScreenBounds:function(){var vvv,AABB=this._AABB,vv=this._viewVertices;this._isAA?this.__setScreenBoundsAA():this.__setScreenBoundsNAA();var xmin=Number.MAX_VALUE,xmax=-Number.MAX_VALUE,ymin=Number.MAX_VALUE,ymax=-Number.MAX_VALUE;return vvv=vv[0],vvv.x<xmin&&(xmin=vvv.x),vvv.x>xmax&&(xmax=vvv.x),vvv.y<ymin&&(ymin=vvv.y),vvv.y>ymax&&(ymax=vvv.y),vvv=vv[1],vvv.x<xmin&&(xmin=vvv.x),vvv.x>xmax&&(xmax=vvv.x),vvv.y<ymin&&(ymin=vvv.y),vvv.y>ymax&&(ymax=vvv.y),vvv=vv[2],vvv.x<xmin&&(xmin=vvv.x),vvv.x>xmax&&(xmax=vvv.x),vvv.y<ymin&&(ymin=vvv.y),vvv.y>ymax&&(ymax=vvv.y),vvv=vv[3],vvv.x<xmin&&(xmin=vvv.x),vvv.x>xmax&&(xmax=vvv.x),vvv.y<ymin&&(ymin=vvv.y),vvv.y>ymax&&(ymax=vvv.y),AABB.x=xmin,AABB.y=ymin,AABB.width=xmax-xmin,AABB.height=ymax-ymin,this},processFrame:function(ctx,time){this.__animate(ctx,time),this._readyToPaint&&this.__paint(ctx,time)},__animate:function(ctx){var ret=!1;return this.isVisible()&&(this._dirty=!1,this.__setModelViewMatrix(),this._dirty&&this.__setScreenBounds(),ret=this._AABB.intersectsWithRectByCoords(0,0,ctx.canvas.width,ctx.canvas.height)),this._readyToPaint=ret,ret},__paint:function(ctx,time){0!==this._color[3]&&(GS.Math.Matrix.transformRenderingContextSet(ctx,this._worldModelViewMatrix),this._clip&&(ctx.save(),ctx.beginPath(),ctx.rect(0,0,this._width,this._height),ctx.clip()),this.paint(ctx,time),this._clip&&ctx.restore())},setClip:function(clip){return this._clip=clip,this},setFilters:function(sfilters){return this._filters=sfilters.split(" "),this},isFiltered:function(){return null!==this._filters},paint:function(ctx){ctx.globalAlpha=this._color[3],"canvas"===ctx.type?(this._originalFillStyle&&(ctx.fillStyle=this._originalFillStyle,ctx.fillRect(0,0,this._width,this._height)),this._spriteImageData&&this._spriteImageData.drawInCanvasAtPosWithSize(ctx,0,0,this._width,this._height,this._isAA)):(this._fillStyle&&(ctx.fillStyle=this._fillStyle,ctx.fillGeometry(this._viewVertices,__quadIndices)),this._spriteImageData&&(ctx.tintColor=this._color,ctx.fillGeometryQuadWithTexture(this._spriteImageData,this._viewVertices,__quadIndices)))},setSpriteImageData:function(sid,adjustActorToImageSize){return sid instanceof GS.SpriteImage&&(sid=sid.getImageSprite()),this._spriteImageData=sid,adjustActorToImageSize&&(this._width=sid._width,this._height=sid._height),this},getSpriteImageData:function(){return this._spriteImageData},setClipPath:function(clipPath){return this.setClip(!0,clipPath)},setFillStyle:function(f){return this._originalFillStyle=f,this._fillStyle=GS.RendererUtils.parseStyle(f),this},isScreenPointIn:function(x,y){if(this._isAA){x/=this._worldModelViewMatrix[0],y/=this._worldModelViewMatrix[4];var xx=this._worldModelViewMatrix[2]/this._worldModelViewMatrix[0],yy=this._worldModelViewMatrix[5]/this._worldModelViewMatrix[4];x-=xx,y-=yy}else GS.Math.Matrix.inverse(this._worldModelViewMatrix,__matrix0),__p0.set(x,y),GS.Math.Matrix.transformPoint(__p0,__matrix0),x=__p0.x,y=__p0.y;return this.contains(x,y)},contains:function(x,y){return x>=0&&x<this._width&&y>=0&&y<this._height},findActorAtPosition:function(x,y){return this._eventsEnabled&&this.isVisible()&&this.isScreenPointIn(x,y)?this:null},enableMouseEvents:function(){return this._eventsEnabled=!0,this.onGestureChange=this.onGestureChange||function(){return!0},this.onMouseEnter=this.onMouseEnter||function(){return!0
},this.onMouseExit=this.onMouseExit||function(){return!0},this.onMouseOut=this.onMouseOut||function(){return!0},this.onMouseOver=this.onMouseOver||function(){return!0},this.onMouseMove=this.onMouseMove||function(){return!0},this.onMouseDrag=this.onMouseDrag||function(){return!0},this.onMouseDown=this.onMouseDown||function(){return!0},this.onMouseUp=this.onMouseUp||function(){return!0},this.onMouseClick=this.onMouseClick||function(){return!0},this.onMouseDblClick=this.onMouseDblClick||function(){return!0},this},disableEvents:function(){this._eventsEnabled=!1},setVisible:function(v){return this._visible=v,this},isVisible:function(){return this._visible},findActorById:function(id){return this._id===id?this:null},setId:function(id){return this._id=id,this}};GS.Object.extend(GS.Actor,__GS_ActorPrototype),Object.defineProperty(GS.Actor.prototype,"fillStyle",{get:function(){return this._originalFillStyle},set:function(v){this.setFillStyle(v)},enumerable:!0,configurable:!0}),Object.defineProperty(GS.Actor.prototype,"alpha",{get:function(){return this._color[3]},set:function(v){this._color[3]=v},enumerable:!0,configurable:!0})}(),function(){GS.ActorContainer=function(){return GS.ActorContainer._superclass.constructor.call(this),this._actors=[],this};var __GS_ActorContainerPrototype={__animate:function(ctx,time){var i,l;if(this.isVisible()&&GS.ActorContainer._superclass.__animate.call(this,ctx))for(i=0,l=this._actors.length;l>i;++i)this._actors[i].isVisible()&&this._actors[i].__animate(ctx,time)},__paint:function(ctx,time){var i,l;if(0!==this.alpha){for(GS.Math.Matrix.transformRenderingContextSet(ctx,this._worldModelViewMatrix),this.isFiltered()&&ctx.startFiltering(),this._clip&&(ctx.save(),ctx.beginPath(),ctx.rect(0,0,this._width,this._height),ctx.clip()),this.paint(ctx,time),i=0,l=this._actors.length;l>i;++i)this._actors[i].__paint(ctx,time);this._clip&&ctx.restore(),this.isFiltered()&&ctx.applyFilters(this,time)}},findActorAtPosition:function(x,y){if(!this.isVisible()||!this.isScreenPointIn(x,y))return null;for(var i=this._actors.length-1;i>=0;i--){var actor=this._actors[i].findActorAtPosition(x,y);if(actor)return actor}return this},getActorIndex:function(actor){for(var i=0;i<this._actors.length;i++)if(this._actors[i]===actor)return i;return-1},removeActorAtIndex:function(index){return 0>index||index>=this._actors.length?null:this._actors.splice(index,1)[0]},removeActor:function(actor){return this.removeActorAtPos(this.getActorIndex(actor))},removeActorAtPos:function(index){return 0>index||index>this._actors.length?null:this._actors.splice(index,1)[0]},removeAllActors:function(){return this._actors=[],this},setZOrder:function(actor,newIndex){if(0>newIndex)return-1;var pos=this.getActorIndex(actor);return-1===pos?-1:pos===newIndex?pos:(this._actors.splice(pos,1),newIndex>=this._actors.length?(this._actors.push(actor),newIndex=this._actors.length-1):0===newIndex?this._actors.unshift(actor):this._actors.splice(newIndex,0,actor),newIndex)},findActorById:function(id){if(null!==GS.ActorContainer._superclass.findActorById.call(this,id))return this;for(var i=0;i<this._actors.length;i++){var actor=this._actors[i],ret=actor.findActorById(id);if(null!==ret)return ret}return null},addSprite:function(x,y,image,sequence){var actor=new GS.Sprite;return sequence=sequence||[image._id],"[object Array]"===Object.prototype.toString.call(sequence)?actor.addAnimation("default",image,sequence):actor.addAnimationWithIndices("default",image,sequence.withIndices),actor.setPosition(x,y),actor.playAnimation("default"),this.addActor(actor),actor},addContainer:function(x,y,w,h){var c;return c=4===arguments.length?(new GS.ActorContainer).setBounds(x,y,w,h):x,this.addActor(c),c},addButton:function(callback,images,is9patch){var button=new GS.Actor;return GS.ActorUtils.setAsButton(button,callback,images,is9patch),this.addActor(button),button},addActor:function(x,y,w,h){var actor;return actor=4===arguments.length?(new GS.Actor).setBounds(x,y,w,h):x,this._actors.push(actor),actor._parent=this,actor}};GS.Actor.extend(GS.ActorContainer,__GS_ActorContainerPrototype)}(),function(){var point=new GS.Point;GS.ActorUtils={enableDrag:function(actor){return actor.enableMouseEvents(),actor.onMouseEnter=function(){this.__d_ax=-1,this.__d_ay=-1},actor.onMouseExit=function(){this.__d_ax=-1,this.__d_ay=-1},actor.onMouseUp=function(){this.__d_ax=-1,this.__d_ay=-1},actor.onMouseDown=function(e){var pt=this.modelToScreen(point.set(e.x,e.y));this._parent.screenToModel(pt),this.__d_ax=pt.x,this.__d_ay=pt.y,this._parent.setZOrder(this,Number.MAX_VALUE)},actor.onMouseDrag=function(e){var pt;pt=this.modelToScreen(point.set(e.x,e.y)),this._parent.screenToModel(pt),(-1===this.__d_ax||-1===this.__d_ay)&&(this.__d_ax=pt.x,this.__d_ay=pt.y),this.x+=pt.x-this.__d_ax,this.y+=pt.y-this.__d_ay,this.__d_ax=pt.x,this.__d_ay=pt.y},this},enableGesture:function(actor){actor.enableMouseEvents(),actor.onGestureChange=function(rotation,scale){this.setRotation(rotation),this.setScale(scale,scale)}},setAsButton:function(actor,callback,images,is9patch){if(actor.enableMouseEvents(),images||(images={}),images["default"]&&actor.setSpriteImageData(images["default"],!0),actor.onMouseMove=function(){images.enter&&this.setSpriteImageData(images.enter)},actor.onMouseEnter=function(e){e.dragging&&images.down?this.setSpriteImageData(images.down):images.enter&&this.setSpriteImageData(images.enter)},actor.onMouseExit=function(){images["default"]&&this.setSpriteImageData(images["default"])},actor.onMouseDown=function(){images.down&&this.setSpriteImageData(images.down)},actor.onMouseUp=function(e){images["default"]&&this.setSpriteImageData(images["default"]),this.contains(e.x,e.y)&&callback(this)},is9patch){actor.getSpriteImageData().set9patch();var si=actor.getSpriteImageData(),topleft=si.getSpriteImageDataById("topleft"),topright=si.getSpriteImageDataById("topright"),bottomleft=si.getSpriteImageDataById("bottomleft"),bottomright=si.getSpriteImageDataById("bottomright"),top=si.getSpriteImageDataById("top"),bottom=si.getSpriteImageDataById("bottom"),left=si.getSpriteImageDataById("left"),right=si.getSpriteImageDataById("right"),center=si.getSpriteImageDataById("center");actor.paint=function(ctx){ctx.drawImage(topleft,0,0),ctx.drawImage(topright,this._width-topright._width,0),ctx.drawImage(bottomleft,0,this._height-bottomleft._height),ctx.drawImage(bottomright,this._width-bottomright._width,this._height-bottomright._height),ctx.drawImage(top,topleft._width,0,this._width-2*topleft._width,top._height),ctx.drawImage(bottom,topleft._width,this._height-bottom._height,this._width-2*topleft._width,bottom._height),ctx.drawImage(left,0,topleft._height,left._width,this._height-2*topleft._height),ctx.drawImage(right,this._width-right._width,topleft._height,right._width,this._height-2*topright._height),ctx.drawImage(center,topleft._width,topleft._height,this._width-2*topleft._width,this._height-2*topleft._height)}}return this}}}(),function(){function PriorityQueueManager(){return this._inputPriorityQueues={},this._sortedQueues=[],this._length=0,this.addElement=function(queueId,positionInQueue,element){var queue=this._inputPriorityQueues[queue];queue||(queue=new Queue(queueId),this._inputPriorityQueues[queueId]=queue,this._sortedQueues.push(queue),this.__sortQueues()),0>=positionInQueue?queue._elements.unshift(element):positionInQueue>=queue.length?queue._elements.push(element):queue._elements.splice(positionInQueue,0,element),this._length++},this.findActorAtPosition=function(x,y){for(var i=0;i<this._sortedQueues.length;i++){var actor=this._sortedQueues[i].findActorAtPosition(x,y);if(actor)return actor}return null},this.__sortQueues=function(){this._sortedQueues.sort(function(q0,q1){return q0._id===q1._id?0:q0._id<q1._id?1:-1})},this}var Queue=function(id){return this._id=id,this._elements=[],this.findActorAtPosition=function(x,y){for(var i=0;i<this._elements.length;i++){var actor=this._elements[i].findActorAtPosition(x,y);if(actor)return actor}return null},this};GS.Scene=function(){GS.Scene._superclass.constructor.call(this),this._inputPriorityQueues=new PriorityQueueManager,this._time=0,this._tweenManager=new GS.TweenManager,this._timerManager=new GS.Timer.TimerManager,this._unitsMatrix=GS.Math.Matrix.IDENTITY,this.setTransformationAnchor(.5,.5),this.setPositionAnchor(0,0),this.setPosition(0,0)};var __GS_ScenePrototype={addPriorityInput:function(queueId,positionInQueue,actor){this._inputPriorityQueues.addElement(queueId,positionInQueue,actor)},getInputPriorityQueues:function(){return this._inputPriorityQueues},incrementTimeLineBy:function(elapsedTime){elapsedTime>500&&(elapsedTime=500),this._time+=elapsedTime,this._timerManager.tick(this._time),this._tweenManager.tick(elapsedTime)},getTime:function(){return this._time},getTweenManager:function(){return this._tweenManager},addTimerTask:function(delay,duration){return this._timerManager.createTask(start,duration)},setUnitsMatrix:function(matrix){this._unitsMatrix=matrix},__setModelViewMatrix:function(){GS.Scene._superclass.__setModelViewMatrix.call(this),this._dirty&&(this._worldModelViewMatrix[0]*=this._unitsMatrix[0],this._worldModelViewMatrix[1]*=this._unitsMatrix[0],this._worldModelViewMatrix[2]*=this._unitsMatrix[0],this._worldModelViewMatrix[3]*=this._unitsMatrix[4],this._worldModelViewMatrix[4]*=this._unitsMatrix[4],this._worldModelViewMatrix[5]*=this._unitsMatrix[4])},onOrientationChange:function(){}};GS.ActorContainer.extend(GS.Scene,__GS_ScenePrototype)}(),function(){GS.SpriteAnimation=function(si,frames,framesAreIndices){var i;if(si instanceof GS.SpriteImage&&(si=si.getImageSprite()),this._spriteImage=si,this._animationFrames=[],"undefined"==typeof frames)this._animationFrames=[si];else if(framesAreIndices)for(i=0;i<frames.length;i++)this._animationFrames[i]=si.getChild(frames[i]);else for(i=0;i<frames.length;i++)this._animationFrames[i]=si.getSpriteImageDataById(frames[i]);return this._loop=!0,this.onStart=null,this.onLoop=null,this.onStop=null,this},GS.SpriteAnimation.prototype={setLoop:function(l){this._loop=l}},GS.Sprite=function(){return GS.Sprite._superclass.constructor.call(this),this._animations={},this._currentAnimation=null,this._animationStartTime=-1,this._boundsSet=!1,this._currentAnimationIndex=-1,this._interval=100,this._animationStopped=!0,this};var __GS_Sprite={addAnimation:function(name,si,animationFramesIndexes){var sa=new GS.SpriteAnimation(si,animationFramesIndexes);return this._animations[name]=sa,sa},addAnimationWithIndices:function(name,si,animationFramesIndexes){var sa=new GS.SpriteAnimation(si,animationFramesIndexes,!0);return this._animations[name]=sa,sa},setBounds:function(x,y,w,h){return this._boundsSet=!0,GS.Sprite._superclass.setBounds.call(this,x,y,w,h)},playAnimation:function(name,interval){if(null===name)return null!==this._currentAnimation&&(this._currentAnimation.onStop&&this._currentAnimation.onStop(this,this._currentAnimation),this._currentAnimationIndex=-1),this;var animation=this._animations[name];if(!animation||this._currentAnimation===animation)return this;this._interval=interval||100,this._currentAnimation=animation,this._animationStartTime=-1;var spriteImageData=this._currentAnimation._animationFrames[0];return this.setSpriteImageData(spriteImageData,!this._boundsSet),this._currentAnimation.onStart&&this._currentAnimation.onStart(this,this._currentAnimation),this},__animate:function(ctx,time){var spriteImageData;if(!this._currentAnimation)return GS.Sprite._superclass.__animate.call(this,ctx,time);if(-1===this._animationStartTime&&(this._animationStartTime=time),null!==this._currentAnimation){var elapsedAnimationTime=time-this._animationStartTime,animationIndex=(elapsedAnimationTime/this._interval|0)%this._currentAnimation._animationFrames.length;if(this._currentAnimationIndex!==animationIndex){if(animationIndex<this._currentAnimationIndex){if(!this._currentAnimation._loop)return this._currentAnimation.onStop&&this._currentAnimation.onStop(this,this._currentAnimation),spriteImageData=this._currentAnimation._spriteImage.getImageData(this._currentAnimation._animationFrames[this._currentAnimation._animationFrames.length-1]),this.setSpriteImageData(spriteImageData,!this._boundsSet),this._currentAnimation=null,GS.Sprite._superclass.__animate.call(this,ctx,time);this._currentAnimation.onLoop&&this._currentAnimation.onLoop(this,this._currentAnimation)}this._currentAnimationIndex=animationIndex,spriteImageData=this._currentAnimation._animationFrames[animationIndex],this.setSpriteImageData(spriteImageData,!this._boundsSet)}}return GS.Sprite._superclass.__animate.call(this,ctx,time)}};GS.Actor.extend(GS.Sprite,__GS_Sprite)}(),function(){var __index=0;GS.SpriteImage=function(image,id){return this._textureId=-1,this._image=image,this._imageWidth=image&&image.width||0,this._imageHeight=image&&image.height||0,this._imageMap={},this._elementCount=0,this._mainImageElement=this.createSpriteImageData(0,0,this._imageWidth,this._imageHeight,id),this._gl=null,this},GS.SpriteImage.prototype={createSpriteImageData:function(x,y,w,h,id){var data=new GS.SpriteImageData(x,y,w,h);return data._id="undefined"==typeof id?"sid"+__index++:id,this.addSpriteElement(data),data},addSpriteElement:function(data){var inc=data._width!==this._imageWidth?-.5:0;return data._u0=(data._x-inc)/this._imageWidth,data._u1=(data._x+data._width+inc)/this._imageWidth,inc=data._height!==this._imageHeight?-.5:0,data._v0=(data._y-inc)/this._imageHeight,data._v1=(data._y+data._height+inc)/this._imageHeight,data._owner=this,data._id?(this._imageMap[data._id]=data,this._elementCount++):console.log("ImageData w/o id."),this},getImagesMap:function(){return this._imageMap},getImageSprite:function(){return this._mainImageElement},setFrameBuffer:function(glTextureId,width,height,textureWidth,textureHeight){return this._textureId=glTextureId,this._imageWidth=textureWidth,this._imageHeight=textureHeight,this._mainImageElement=new GS.SpriteImageData(0,0,width,height),this._mainImageElement._u1=1,this._mainImageElement._v1=1,this._mainImageElement._owner=this,this},getImageData:function(name){var ret=this._imageMap[name];return ret||this._mainImageElement},getSpriteImageDataById:function(id){return this.getImageData(id)},getImageDataByIndex:function(index){return this._mainImageElement.getImageDataByIndex(index)},getImageDataById:function(id){return this._mainImageElement.getImageDataById(id)},getTextureId:function(){return this._textureId},dispose:function(){this._gl&&this._gl.deleteTexture(this._textureId)},setAsTexture:function(gl){if(gl&&-1===this._textureId){this._gl=gl,this._textureId=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,this._textureId);var nw=GS.WebGLUtils.nextPowerOf2(this._imageWidth),nh=GS.WebGLUtils.nextPowerOf2(this._imageHeight);if(nw!==this._imageWidth||nh!==this._imageHeight){var canvas=document.createElement("canvas");canvas.width=nw,canvas.height=nh;var ctx=canvas.getContext("2d");ctx.drawImage(this._image,0,0);for(var el in this._imageMap){var sid=this._imageMap[el],rw=this._imageWidth/nw,rh=this._imageHeight/nh;sid._u0*=rw,sid._u1*=rw,sid._v0*=rh,sid._v1*=rh}this._mainImageElement._u1=this._imageWidth/nw,this._mainImageElement._v1=this._imageHeight/nh,this._imageWidth=nw,this._imageHeight=nh,this._image=canvas}return gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,this._image),GS.WebGL.MIPMAP?(gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_NEAREST),gl.generateMipmap(gl.TEXTURE_2D)):(gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE)),this._image=null,this}},setSpriteRegionWithImage:function(id,image,sx,sy,sw,sh,dx,dy,dw,dh){var ctx,spriteImageData=this.createSpriteImageData(dx,dy,dw,dh,id);if(this._image)this._image=GS.ImageUtils.getCanvasFromImage(this._image),ctx=this._image.getContext("2d"),ctx.drawImage(image,sx,sy,sw,sh,dx,dy,dw,dh);else{var canvas;dw===image.width&&dh===image.height?canvas=image:(canvas=GS.ImageUtils.createCanvas(dw,dh),ctx=canvas.getContext("2d"),ctx.drawImage(image,sx,sy,sw,sh,0,0,dw,dh)),this._gl.bindTexture(this._gl.TEXTURE_2D,this._textureId),this._gl.texSubImage2D(this._gl.TEXTURE_2D,0,dx,dy,this._gl.RGBA,this._gl.UNSIGNED_BYTE,canvas)}return spriteImageData},createWithRowsAndColumnsById:function(id,rows,columns,nameFactory,extents,padding,gap){var sid=this._imageMap[id];return sid&&sid.createWithRowsAndColumns(rows,columns,nameFactory,extents,padding,gap),this},createWithRowsAndColumns:function(rows,columns,nameFactory,extents,padding,gap){return this._mainImageElement.createWithRowsAndColumns(rows,columns,nameFactory,extents,padding,gap),this},createWithTexturePackerJSONById:function(id,map){var sid=this._imageMap[id];return sid&&sid.createWithTexturePackerJSON(map),this},createWithTexturePackerJSON:function(map){return this._mainImageElement.createWithTexturePackerJSON(map),this},getElementCount:function(){return this._elementCount-1}}}(),function(){GS.SpriteImageData=function(x,y,w,h){return this._x=x||0,this._y=y||0,this._width=w||0,this._height=h||0,this._u0=0,this._v0=0,this._u1=0,this._v1=0,this._owner=null,this._parent=null,this._id="",this._children=[],this._imageMap={},this},GS.SpriteImageData.prototype={drawInCanvasAtPos:function(ctx,x,y){ctx._drawImage(this._owner._image,this._x,this._y,this._width,this._height,x,y,this._width,this._height)},drawInCanvasAtPosWithSize:function(ctx,x,y,w,h){ctx._drawImage(this._owner._image,this._x,this._y,this._width,this._height,x,y,w,h)},drawInCanvasAtPosWithSizeAndSource:function(ctx,sx,sy,sw,sh,tx,ty,tw,th){ctx._drawImage(this._owner._image,this._x+sx,this._y+sy,sw,sh,tx,ty,tw,th)},getImageData:function(id){return this._imageMap[id]},getImageDataByIndex:function(index){return this._children[index]},getSpriteImageDataById:function(id){return id===this._id?this:this._imageMap[id]},getChild:function(index){return this._children[index]},addChild:function(sid){sid._parent=this,this._children.push(sid),this._imageMap[sid._id]=sid},getChildrenAsArray:function(){return this._children},set9patch:function(){var w=this._width/3,h=this._height/3,topleft=this.createSpriteImageData(0,0,w,h,"topleft"),topright=this.createSpriteImageData(2*w,0,w,h,"topright"),bottomleft=this.createSpriteImageData(0,2*h,w,h,"bottomleft"),bottomright=this.createSpriteImageData(2*w,2*h,w,h,"bottomright"),top=this.createSpriteImageData(w,0,w,h,"top"),bottom=this.createSpriteImageData(w,2*h,w,h,"bottom"),left=this.createSpriteImageData(0,h,w,h,"left"),right=this.createSpriteImageData(2*w,h,w,h,"right"),center=this.createSpriteImageData(w,h,w,h,"center");this.addChild(topleft),this.addChild(topright),this.addChild(bottomleft),this.addChild(bottomright),this.addChild(top),this.addChild(right),this.addChild(left),this.addChild(bottom),this.addChild(center)},createSpriteImageData:function(x,y,w,h,id){return this._owner.createSpriteImageData(this._x+x,this._y+y,w,h,id)},createWithRowsAndColumns:function(rows,columns,nameFactory,extents,padding,gap){if(0>=rows||0>=columns)return[];var ww=extents&&extents.width||this._width,hh=extents&&extents.height||this._height,left=padding&&(padding.left||0)>>0||0;left+=this._x;var top=padding&&(padding.top||0)>>0||0;top+=this._y;var right=ww-(padding&&(padding.right||0)>>0||0);right+=left;var bottom=hh-(padding&&(padding.bottom||0)>>0||0);bottom+=top;for(var width=(right-left)/columns-(gap?gap.width||0:0),height=(bottom-top)/rows-(gap?gap.height||0:0),i=0;rows>i;++i)for(var j=0;columns>j;++j){var name=nameFactory?nameFactory(i,j):this._id+""+(j+i*columns),sid=this._owner.createSpriteImageData(left+j*width,top+i*height,width,height,name);this.addChild(sid)}return this},createWithTexturePackerJSON:function(map){map=map.frames||map;for(var element in map)if(map.hasOwnProperty(element)){var frame=map[element].frame,sid=this._owner.createSpriteImageData(parseFloat(frame.x+this._x),parseFloat(frame.y+this._y),parseFloat(frame.w),parseFloat(frame.h),element);this.addChild(sid)}return this}}}(),function(){function setAudioFormatExtensions(ext){for(var audio=new Audio,i=0,l=ext.length;l>i;i+=1){var res=audio.canPlayType(audioTypes[ext[i]]).toLowerCase();if("no"!==res&&""!==res)return currentAudioFormatExtension=ext[i],void console.log("Audio type set to: "+currentAudioFormatExtension)}console.log("No suitable audio format found.")}var __groupIndex=0,audioTypes={ogg:"audio/ogg",mp3:"audio/mpeg;",wav:"audio/wav","x-wav":"audio/x-wav",mp4:'audio/mp4"'},currentAudioFormatExtension=".ogg",extensionsSoundSet=[],AssetEvent=function(mgr,groupId,assetId,count,totalCount){return this.manager=mgr,this.groupId=groupId,this.assetId=assetId,this.count=count,this.totalCount=totalCount,this},AssetGroup=function(loader,id,group){return this.assets=[],this.g_onLoaded=group.onLoaded,this.g_onProgress=group.onProgress,this.g_onError=group.onError,this.count=0,this.group=group,this.loader=loader,this.id=id,this.__setupGroupAssets(),this};AssetGroup.prototype={__setupGroupAssets:function(){for(var base=this.group.base||"",i=0;i<this.group.assets.length;i++){var asset,extension=this.group.assets[i].url.substr(this.group.assets[i].url.lastIndexOf(".")+1,this.group.assets[i].url.length),constructor=GS.Plugin.AssetLoader.AssetTypeByExtension[extension];constructor||(console.log("Unknown file type on loader. Assuming text loading."),constructor=GS.Plugin.AssetLoader.AssetTypeByExtension.txt),asset=new constructor(this,this.group.assets[i].id,this.group.assets[i].url,base,!0),this.assets.push(asset)}},getAsset:function(id){for(var i=0;i<this.assets.length;i++)if(this.assets[i].id===id)return this.assets[i].asset},load:function(){for(var i=0;i<this.assets.length;i++)this.assets[i].load()},onError:function(asset){var e=new AssetEvent(this.loader,this.id,asset.id);this.g_onError&&this.g_onError(e),this.loader.__onError(e)},onProgress:function(asset){this.count++,this.g_onProgress&&this.g_onProgress(new AssetEvent(this.loader,this.id,asset.id,this.count,this.assets.length)),this.loader.__onProgress(this.id,asset.id),this.count===this.assets.length&&(this.g_onLoaded&&this.g_onLoaded(new AssetEvent(this.loader,this.id)),this.loader.__onLoaded())},size:function(){return this.assets.length}},GS.Plugin.AssetLoader=function(){this._loadingGroups=[],this._onLoaded=null,this._onProgress=null,this._onError=null,this._currentGroup=0,this._currentAssetLoadedCount=0,this._currentAssetCount=0},GS.Plugin.AssetLoader.prototype={addGroup:function(group,id){id=id||"Group"+__groupIndex++;var gr=new AssetGroup(this,id,group);return this._loadingGroups.push({id:id,group:gr}),this._currentAssetCount+=gr.size(),this},getAsset:function(id,gid){var gr,ret;if(gid){if(gr=this.getGroup(gid))return gr.group.getAsset(id)}else for(var i=0;i<this._loadingGroups.length;i++)if(gr=this._loadingGroups[i],ret=gr.group.getAsset(id))return ret;return null},getGroup:function(gid){for(var i=0;i<this._loadingGroups.length;i++)if(this._loadingGroups[i].id===gid)return this._loadingGroups[i];return null},load:function(onLoaded,onProgress,onError){return this._onLoaded=onLoaded,this._onProgress=onProgress,this._onError=onError,this.__loadImpl(),this},__loadImpl:function(){return this._loadingGroups[this._currentGroup].group.load(),this},__onLoaded:function(){this._currentGroup++,this._currentGroup===this._loadingGroups.length?this._onLoaded&&this._onLoaded(this):this.__loadImpl()},__onProgress:function(groupId,assetId){this._currentAssetLoadedCount++,this._onProgress&&this._onProgress(new AssetEvent(this,groupId,assetId,this._currentAssetLoadedCount,this._currentAssetCount))},__onError:function(e){this._onError&&this._onError(e)},getAllAssetsArray:function(){for(var assets=[],i=0;i<this._loadingGroups.length;i++)assets=assets.concat(this._loadingGroups[i].group.assets);return assets}},GS.Plugin.AssetLoader.Asset=function(group,id,url,base){return this.base=base,this.id=id||url,-1!==this.id.indexOf("/")&&(this.id=this.id.substring(this.id.indexOf("/")+1)),-1===url.indexOf("http")&&(url=base+url),this.url=url,this.asset=null,this.group=group,this},GS.Plugin.AssetLoader.Asset.prototype={load:function(){},onLoad:function(asset){this.asset=asset,this.group.onProgress(this)},onError:function(){this.group.onError(this)}},GS.Object.extend(GS.Plugin.AssetLoader.Asset,GS.Plugin.AssetLoader.Asset.prototype),GS.Plugin.AssetLoader.AssetImage=function(group,id,url,base){return GS.Plugin.AssetLoader.AssetImage._superclass.constructor.call(this,group,id,url,base),this.type="image",this},GS.Plugin.AssetLoader.AssetImage.prototype={load:function(){this.asset=new Image,this.asset.onload=this.__load.bind(this),this.asset.onerror=this.__error.bind(this),this.asset.src=this.url},__load:function(e){this.onLoad(e.target)},__error:function(e){this.onError(e.target)}},GS.Plugin.AssetLoader.Asset.extend(GS.Plugin.AssetLoader.AssetImage,GS.Plugin.AssetLoader.AssetImage.prototype),GS.Plugin.AssetLoader.AssetText=function(group,id,url,base){return GS.Plugin.AssetLoader.AssetText._superclass.constructor.call(this,group,id,url,base),this.type="text",this},GS.Plugin.AssetLoader.AssetText.prototype={load:function(){var me=this,req=null;if(window.XMLHttpRequest&&!window.ActiveXObject)try{req=new XMLHttpRequest}catch(e){req=null}else if(window.ActiveXObject)try{req=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{req=new ActiveXObject("Microsoft.XMLHTTP")}catch(e1){req=null}}req&&(req.open("GET",me.url,!1),req.onreadystatechange=function(e){if(200!=req.status)return void me.group.onError(me);var text=e.currentTarget?e.currentTarget.responseText:e.target.responseText;me.onLoad(text)}.bind(this),req.send())}},GS.Plugin.AssetLoader.Asset.extend(GS.Plugin.AssetLoader.AssetText,GS.Plugin.AssetLoader.AssetText.prototype),GS.Plugin.AssetLoader.AssetJSON=function(group,id,url,base){return GS.Plugin.AssetLoader.AssetJSON._superclass.constructor.call(this,group,id,url,base),this.type="json",this},GS.Plugin.AssetLoader.AssetJSON.prototype={onLoad:function(e){try{e=JSON.parse(e),GS.Plugin.AssetLoader.AssetJSON._superclass.onLoad.call(this,e)}catch(x){this.onError(e)}}},GS.Plugin.AssetLoader.AssetText.extend(GS.Plugin.AssetLoader.AssetJSON,GS.Plugin.AssetLoader.AssetJSON.prototype),GS.Plugin.AssetLoader.AssetAudio=function(group,id,url,base){return GS.Plugin.AssetLoader.AssetAudio._superclass.constructor.call(this,group,id,url,base),this.type="audio",this},GS.Plugin.AssetLoader.AssetAudio.prototype={load:function(){var audio=document.createElement("audio");audio.addEventListener("canplaythrought",this.__onLoad.bind(this),!1);try{audio.src=this.url,audio.preload="auto",audio.load()}catch(e){this.onError(this)}},__onLoad:function(e){this.onLoad(e.target)}},GS.Plugin.AssetLoader.Asset.extend(GS.Plugin.AssetLoader.AssetAudio,GS.Plugin.AssetLoader.AssetAudio.prototype),GS.Plugin.AssetLoader.AssetAtlas=function(group,id,url,base){return GS.Plugin.AssetLoader.AssetAudio._superclass.constructor.call(this,group,id,url,base),this.type="atlas",this.images=[],this.atlas={meta:{image:[]},frames:[]},this},GS.Plugin.AssetLoader.AssetAtlas.prototype={onLoad:function(text){function imageLoadedCallback(){if(currentLoadedImages++,currentLoadedImages===numImagesToLoad){for(var images=[],i=0;i<this.atlas.frames.length;i++){var image=new GS.SpriteImage(this.images[i]);images.push(image);for(var frame_key in this.atlas.frames[i]){var frame=this.atlas.frames[i][frame_key];image.createSpriteImageData(frame.frame.x,frame.frame.y,frame.frame.width,frame.frame.height,frame.name)}}this.asset=images,GS.Plugin.AssetLoader.AssetAtlas._superclass.onLoad.call(this,images)}}var i,j,result=text.split(/\r?\n/),lineCount=-3,currentImageId=0,currentFrame=null,nameInNextLine=!1;for(i=0;i<result.length;i++)if(result[i]=result[i].replace(/^\s+|\s+$/g,""),""===result[i]&&(nameInNextLine=i+1),result[i].length>0){if(nameInNextLine===i)this.atlas.meta.image.push(result[i]),currentImageId=this.atlas.meta.image.length-1,this.atlas.frames.push({}),lineCount=-3;else if(lineCount>0)if(lineCount%7===1)null!=currentFrame&&(this.atlas.frames[currentImageId][currentFrame.name]=currentFrame),currentFrame={name:result[i],frame:{}};else if(text=result[i].split(" "),lineCount%7===3)currentFrame.frame.x=Number(text[1].replace(",","")),currentFrame.frame.y=Number(text[2]);else if(lineCount%7===4)currentFrame.frame.w=Number(text[1].replace(",","")),currentFrame.frame.h=Number(text[2]);else if(lineCount%7===5){var realSize={x:0,y:0,w:Number(text[1].replace(",","")),h:Number(text[2])};realSize.w>currentFrame.frame.w||realSize.h>currentFrame.frame.h?(currentFrame.trimmed=!0,currentFrame.realSize=realSize):currentFrame.trimmed=!1}lineCount++}null!=currentFrame&&(this.atlas.frames[currentImageId][currentFrame.name]=currentFrame);var numImagesToLoad=0,currentLoadedImages=0;if(this.atlas.meta.image.length>0)for(numImagesToLoad=this.atlas.meta.image.length,j=0;j<this.atlas.meta.image.length;j++){var textureUrl,lio=this.url.lastIndexOf("/");textureUrl=-1===lio?this.atlas.meta.image[j]:this.url.substring(0,lio+1)+this.atlas.meta.image[j];var image=new Image;image.onload=imageLoadedCallback.bind(this),this.images.push(image),image.src=textureUrl}}},GS.Plugin.AssetLoader.AssetText.extend(GS.Plugin.AssetLoader.AssetAtlas,GS.Plugin.AssetLoader.AssetAtlas.prototype),GS.Plugin.AssetLoader.AssetTypeByExtension={png:GS.Plugin.AssetLoader.AssetImage,jpg:GS.Plugin.AssetLoader.AssetImage,jpeg:GS.Plugin.AssetLoader.AssetImage,gif:GS.Plugin.AssetLoader.AssetImage,txt:GS.Plugin.AssetLoader.AssetText,fnt:GS.Plugin.AssetLoader.AssetText,ogg:GS.Plugin.AssetLoader.AssetAudio,mp3:GS.Plugin.AssetLoader.AssetAudio,wav:GS.Plugin.AssetLoader.AssetAudio,json:GS.Plugin.AssetLoader.AssetJSON,atlas:GS.Plugin.AssetLoader.AssetAtlas},Object.defineProperty(GS.Plugin.AssetLoader,"ExtensionsSound",{get:function(){return currentAudioFormatExtension},set:function(values){extensionsSoundSet=values,setAudioFormatExtensions(values)},enumerable:!0,configurable:!0}),GS.Plugin.AssetLoader.ExtensionsSound=["ogg","mp3","wav","x-wav"]}(),function(){function getFontMetrics(font){var ret;try{return ret=getFontMetricsCSS(font)}catch(e){}return getFontMetricsNoCSS(font)}function getFontMetricsNoCSS(font){var height,re=/(\d+)p[x|t]\s*/i,res=re.exec(font);height=res?0|res[1]:32;var ascent=height-1,h=height+.2*height|0;return{height:h,ascent:ascent,descent:h-ascent}}function getFontMetricsCSS(font){function offset(elem){var box,docElem,body,win,clientTop,clientLeft,scrollTop,scrollLeft,top,left,doc=elem&&elem.ownerDocument;return docElem=doc.documentElement,box=elem.getBoundingClientRect(),body=document.body,win=9===doc.nodeType?doc.defaultView||doc.parentWindow:!1,clientTop=docElem.clientTop||body.clientTop||0,clientLeft=docElem.clientLeft||body.clientLeft||0,scrollTop=win.pageYOffset||docElem.scrollTop,scrollLeft=win.pageXOffset||docElem.scrollLeft,top=box.top+scrollTop-clientTop,left=box.left+scrollLeft-clientLeft,{top:top,left:left}}try{var text=document.createElement("span");text.style.font=font,text.innerHTML="Hg";var block=document.createElement("div");block.style.display="inline-block",block.style.width="1px",block.style.heigh="0px";var div=document.createElement("div");div.appendChild(text),div.appendChild(block);var body=document.body;body.appendChild(div);try{var result={};return block.style.verticalAlign="baseline",result.ascent=offset(block).top-offset(text).top,block.style.verticalAlign="bottom",result.height=offset(block).top-offset(text).top,result.ascent=Math.ceil(result.ascent),result.height=Math.ceil(result.height),result.descent=result.height-result.ascent,result}finally{body.removeChild(div)}}catch(e){return null}}var GlypthInfo=function(){return this._spriteImageData=new GS.SpriteImageData,this._id=0,this._xadvance=0,this._xoffset=0,this._yoffset=0,this._kerning={},this.__set_id=function(id){this._id=id
},this.__set_x=function(x){this._spriteImageData._x=window.parseFloat(x)},this.__set_y=function(y){this._spriteImageData._y=window.parseFloat(y)},this.__set_width=function(width){this._spriteImageData._width=window.parseFloat(width)},this.__set_height=function(height){this._spriteImageData._height=parseFloat(height)},this.__set_xadvance=function(xadvance){this._xadvance=parseFloat(xadvance)},this.__set_xoffset=function(xoffset){this._xoffset=parseFloat(xoffset)},this.__set_yoffset=function(yoffset){this._yoffset=parseFloat(yoffset)},this.__setupGlypth=function(spriteImageData){var spriteImage=spriteImageData._owner;this._spriteImageData._x+=spriteImageData._x,this._spriteImageData._y+=spriteImageData._y,spriteImage.addSpriteElement(this._spriteImageData)},this.width=function(){return this._spriteImageData._width},this.addKerning=function(nextChar,amount){this._kerning[nextChar]=parseInt(amount)},this.drawChar=function(ctx,x,y,nextChar){if(!(this._spriteImageData._width<=0||this._spriteImageData._height<=0)){var kerning=0;if(nextChar){var _kerning=this._kerning[nextChar];_kerning&&(kerning+=_kerning)}ctx.drawImage(this._spriteImageData,x+kerning+this._xoffset,y+this._yoffset)}},this};GS.Plugin.SpriteFont=function(){return this._spriteImageData=null,this._glypthInfo={},this._fontHeight=1,this._fontDescent=1,this};var __GS_Plugin_SpriteFontPrototype={fillText:function(ctx,text,x,y){for(var i=0;i<text.length;i++){var _char=this._glypthInfo[text.charAt(i)];_char&&(_char.drawChar(ctx,x,y,text.charAt(i+1)),x+=_char._xadvance)}},strokeText:function(ctx,text,x,y){this.fillText(ctx,text,x,y)},stringWidth:function(str){for(var width=0,i=0;i<str.length;i++){var glypth=this._glypthInfo[str.charAt(i)];glypth&&(width+=glypth.width())}return width},getHeight:function(){return this._fontDescent},__addGlypthInfo:function(spriteImageData,charCode,glypthInfo){glypthInfo.__setupGlypth(spriteImageData),this._glypthInfo[charCode]=glypthInfo},createFromGlyphDesignerOutput:function(spriteImageData,text){spriteImageData instanceof GS.SpriteImage&&(spriteImageData=spriteImageData.getImageData()),this._spriteImageData=spriteImageData,"string"==typeof text&&(text=text.split("\n"));for(var str,pairs,key,value,j,i=0;i<text.length;i++)if(0===text[i].indexOf("char ")){str=text[i].substring(5),pairs=str.split(" ");var obj=new GlypthInfo;for(j=0;j<pairs.length;j++){var pair=pairs[j],pairData=pair.split("=");"page"!==pairData[0]&&"chnl"!==pairData[0]&&"letter"!==pairData[0]&&(key="__set_"+pairData[0],value=pairData[1],'"'===value.charAt(0)&&'"'===value.charAt(value.length-1)&&value.substring(1,value.length-1),obj[key]?obj[key](value):console.log("Building glyph got unk property: "+key))}this.__addGlypthInfo(spriteImageData,String.fromCharCode(obj._id),obj)}else if(0===text[i].indexOf("kerning "))for(str=text[i].substring(8),pairs=str.split(" "),j=0;j<pairs.length;j++){var first=pairs[0].split("=")[1],second=pairs[1].split("=")[1],amount=pairs[2].split("=")[1],glypth=this._glypthInfo[String.fromCharCode(first)];glypth&&glypth.addKerning(String.fromCharCode(second),amount)}else if(0===text[i].indexOf("common"))for(str=text[i].substring(7),pairs=str.split(" "),j=0;j<pairs.length;j++){var vv=pairs[i].split("=");key=vv[0],value=vv[1],"lineHeight"===key?this._fontHeight=parseFloat(value):"base"===key&&(this._baseLine=parseFloat(value))}return this},createFromSystemFont:function(name,chars,font,fontsize,fontstyle,fillStyle,strokeStyle,strokesize,padding,tm){padding=0|padding;var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");ctx.textBaseline="bottom",ctx.font=fontstyle+" "+fontsize+"px "+font;var i,x,cchar,textWidth=0,charWidth=[];for(i=0;i<chars.length;i++){var cw=Math.max(1,(ctx.measureText(chars.charAt(i)).width>>0)+1)+2*padding;charWidth.push(cw),textWidth+=cw}var yoffset,canvasheight,fontMetrics=getFontMetrics(ctx.font),baseline="alphabetic";canvasheight=fontMetrics.height,this._fontDescent=fontMetrics.descent,this._fontHeight=fontMetrics.height,yoffset=fontMetrics.ascent,canvas.width=textWidth>1024?1024:textWidth,canvas.height=canvasheight*(1+(textWidth/1024>>0)),ctx=canvas.getContext("2d"),ctx.textBaseline=baseline,ctx.font=fontstyle+" "+fontsize+"px "+font,ctx.fillStyle=fillStyle,ctx.strokeStyle=strokeStyle;var charMap={};x=0;var y=0;for(i=0;i<chars.length;i++)x+charWidth[i]>=1024&&(x=0,y+=this._fontHeight),cchar=chars.charAt(i),ctx.fillText(cchar,x+padding,yoffset+y),strokeStyle&&(ctx.beginPath(),ctx.lineWidth=strokesize,ctx.strokeText(cchar,x+padding,yoffset+y)),charMap[cchar]={x:x+padding,y:y,width:charWidth[i]-2*padding,height:this._fontHeight},x+=charWidth[i];var si=new GS.SpriteImage(canvas,name);this._spriteImageData=si.getImageSprite();for(var _char in charMap){var obj=new GlypthInfo,sid=si.createSpriteImageData(charMap[_char].x,charMap[_char].y,charMap[_char].width,charMap[_char].height,_char);obj._spriteImageData=sid,obj._xadvance=charMap[_char].width,this._glypthInfo[_char]=obj}return tm&&tm.addSpriteImage(si),this}};GS.Object.extend(GS.Plugin.SpriteFont,__GS_Plugin_SpriteFontPrototype),GS.Plugin.FontManager=function(){return this._fonts={},this};var __GS_Plugin_FontManagerPrototype={addGlypthDesignerFont:function(name,spriteImage,fontdef){var font=new GS.Plugin.SpriteFont;return font.createFromGlyphDesignerOutput(spriteImage,fontdef),this._fonts[name]=font,font},loadAddGlypthDesignerFont:function(){},addSystemFont:function(name,chars,font,fontsize,fontstyle,fillstyle,strokestyle,strokesize,padding,tm){var _font=new GS.Plugin.SpriteFont;return _font.createFromSystemFont(name,chars,font,fontsize,fontstyle,fillstyle,strokestyle,strokesize,padding,tm),this._fonts[name]=_font,_font},getFont:function(name){return this._fonts[name]}};GS.Object.extend(GS.Plugin.FontManager,__GS_Plugin_FontManagerPrototype)}(),function(){GS.ImageUtils={createCanvas:function(w,h){var canvas=document.createElement("canvas");return canvas.width=w,canvas.height=h,canvas},getCanvasFromImage:function(image){if(image instanceof HTMLCanvasElement)return image;var canvas=this.createCanvas(image.width,image.height),ctx=canvas.getContext("2d");return ctx.drawImage(image,0,0),canvas}}}(),function(){var __atlas_image_id=0,ATLAS_WIDTH=2048,ATLAS_HEIGHT=2048,SortStrategies={perimeter:function(a1,a2){a1 instanceof GS.Plugin.AssetLoader.Asset&&(a1=a1.asset,a2=a2.asset);var perimeter1=2*a1.width+2*a1.height,perimeter2=2*a2.width+2*a2.height;return perimeter1===perimeter2?0:perimeter1>perimeter2?-1:1},area:function(a1,a2){a1 instanceof GS.Plugin.AssetLoader.Asset&&(a1=a1.asset,a2=a2.asset);var area1=a1.width*a1.height,area2=a2.width*a2.height;return area1===area2?0:area1>area2?-1:1},width:function(a1,a2){a1 instanceof GS.Plugin.AssetLoader.Asset&&(a1=a1.asset,a2=a2.asset);var width1=a1.width,width2=a2.width;return width1===width2?0:width1>width2?-1:1},height:function(a1,a2){a1 instanceof GS.Plugin.AssetLoader.Asset&&(a1=a1.asset,a2=a2.asset);var height1=a1.height,height2=a2.height;return height1===height2?0:height1>height2?-1:1}},Node=function(w,h){return this._children=[],this._x=0,this._y=0,this._width="undefined"!=typeof w?w:0,this._height="undefined"!=typeof h?h:0,this._image=null,this.insert=function(sw,sh){if(this._children.length>0){var newNode=this._children[0].insert(sw,sh);return null!==newNode?newNode:this._children[1].insert(sw,sh)}if(null!==this._image)return null;if(sw>this._width||sh>this._height)return null;if(sw===this._width&&sh===this._height)return this;this._children[0]=new Node,this._children[1]=new Node;var dw=this._width-sw,dh=this._height-sh;return dw>=dh?(this._children[0]._x=this._x,this._children[0]._y=this._y,this._children[0]._width=sw,this._children[0]._height=this._height,this._children[1]._x=this._x+sw,this._children[1]._y=this._y,this._children[1]._width=this._width-sw,this._children[1]._height=this._height):(this._children[0]._x=this._x,this._children[0]._y=this._y,this._children[0]._width=this._width,this._children[0]._height=sh,this._children[1]._x=this._x,this._children[1]._y=this._y+sh,this._children[1]._width=this._width,this._children[1]._height=this._height-sh),this._children[0].insert(sw,sh)},this},SpritePage=function(padding){return this._root=new Node(ATLAS_WIDTH,ATLAS_HEIGHT),this._spriteImage=new GS.SpriteImage(GS.ImageUtils.createCanvas(ATLAS_WIDTH,ATLAS_HEIGHT)),this._padding=padding,this.setAsTexture=function(gl){this._spriteImage.setAsTexture(gl)},this.insert=function(router,id,img,flags){flags=flags||{};var rect=flags.rect,sx=rect?rect.x:0,sy=rect?rect.y:0,sw=rect?rect.width:img.width,sh=rect?rect.height:img.height,node=this._root.insert(sw+padding,sh+padding);if(null===node)return!1;node._image=img;var rows=flags.rows||1,columns=flags.columns||1;if(router[id]=this._spriteImage.setSpriteRegionWithImage(id,img,sx,sy,sw,sh,node._x,node._y,sw,sh),rows>1||columns>1)for(var swc=sw/columns,shr=sh/rows,i=0;rows>i;i++)for(var j=0;columns>j;j++)router[id+count++]=this._spriteImage.setSpriteRegionWithImage(id,img,sx+swc*j,sy+shr*i,swc,shr,node._x,node._y,swc,shr);return!0},this.getOccupationRatio=function(){var area=0;for(var pr in this._spriteImage._imageMap){var spriteImageData=this._spriteImage._imageMap[pr];area+=spriteImageData._width*spriteImageData._height}return area/(ATLAS_WIDTH*ATLAS_HEIGHT)},this};GS.Plugin.TexturePacker=function(params){return this._gl=params.gl?params.gl:null,this._reusePages=params.reusePages,this._clusterImages=params.clusterImages,this._padding=0|params.padding,this._spritePages=[],this._currentSpritePage=null,this._router={},this},GS.Plugin.TexturePacker.prototype={getCacheSize:function(){return this._spritePages.length},getOccupationRatio:function(){for(var ratios=[],i=0;i<this._spritePages.length;i++)ratios.push(this._spritePages[i].getOccupationRatio());return ratios},__createSpritePage:function(){var spritepage=new SpritePage(this._padding);this._gl&&spritepage.setAsTexture(this._gl),this._spritePages.push(spritepage),this._currentSpritePage=spritepage},addImage:function(img,flags){var id=flags&&flags.id||__atlas_image_id++;if(img.width>ATLAS_WIDTH||img.height>ATLAS_HEIGHT)return console.log("GS.Plugin.TexturePacker can't allocate space for an image bigger than "+ATLAS_WIDTH+"x"+ATLAS_HEIGHT+"px."),-1;var sid=null;if(0===this._spritePages.length&&this.__createSpritePage(),sid=!this._clusterImages&&this._reusePages?this._spritePages[0].insert(this._router,id,img,flags):this._currentSpritePage.insert(this._router,id,img,flags),!sid){if(this._reusePages&&this._spritePages.length>1){var index=0;do sid=this._spritePages[index].insert(this._router,id,img,flags),index++;while(index<this._spritePages.length&&!sid)}sid||(this.__createSpritePage(),this._currentSpritePage.insert(this._router,id,img,flags))}return img.__id=id,id},getSpriteImageDataByImage:function(image){return this._router[image.__id]},getSpriteImageDataById:function(id){return this._router[id]},createWithRowsAndColumnsById:function(id,rows,columns){var spriteImageData=this._router[id],elements=spriteImageData.createWithRowsAndColumns(rows,columns).getChildrenAsArray(),router=this._router;elements.map(function(e){router[e._id]=e})},getSpriteImage:function(i){return this._spritePages[i]._spriteImage},packAssetLoader:function(assetloader,strategy){var elements=assetloader.getAllAssetsArray();strategy=SortStrategies[strategy]||SortStrategies.perimeter,elements.sort(strategy);for(var i=0;i<elements.length;i++)elements[i]instanceof GS.Plugin.AssetLoader.AssetImage&&this.addImage(elements[i].asset,{id:elements[i].id});return this}}}(),function(){function parsePaddingValue(padding,ref){return!isNaN(parseFloat(padding))&&isFinite(padding)?padding:-1!==padding.indexOf("px")?parseFloat(padding.substr(0,padding.length-2)):-1!==padding.indexOf("u")?parseFloat(padding.substr(0,padding.length-1)):-1!==padding.indexOf("%")?parseFloat(padding.substr(0,padding.length-1))/100*ref:0|padding}function calculatePadding(padding,w,h){var x0=parsePaddingValue(padding.left,w),y0=parsePaddingValue(padding.top,h),x1=parsePaddingValue(padding.right,w),y1=parsePaddingValue(padding.bottom,h);return{left:x0,top:y0,right:x1,bottom:y1}}function calculateGap(gap,w,h){var _w=parsePaddingValue(gap.h,w),_h=parsePaddingValue(gap.v,h);return{v:_w,h:_h}}GS.Layout=GS.Layout||{};var LayoutElement=function(id){return this.id=id,this.area=new GS.Math.Rectangle,this.preferredSize={width:-1,height:-1},this.minimumSize={width:30,height:30},this.padding={left:0,top:0,right:0,bottom:0},this},__LayoutElement_prototype={setPreferredWidth:function(w){this.preferredSize.width=w},setPreferredHeight:function(h){this.preferredSize.height=h},setMinimumWidth:function(w){this.minimumSize.width=w},setMinimumHeight:function(h){this.minimumSize.height=h},doLayout:function(x,y,w,h){this.area.setBounds(x,y,w,h)},getPreferredLayoutSize:function(){var _w=Math.max(parsePaddingValue(this.minimumSize.width,this.area.width),parsePaddingValue(this.preferredSize.width,this.area.width)),_h=Math.max(parsePaddingValue(this.minimumSize.height,this.area.height),parsePaddingValue(this.preferredSize.height,this.area.height));return{width:_w,height:_h}},setSize:function(w,h){this.area.width=w,this.area.height=h}};GS.Object.extend(LayoutElement,__LayoutElement_prototype);var Layout=function(padding,gap){return this.layoutElements=[],this._padding=padding,this.area=new GS.Math.Rectangle,this._gap=gap,this},__Layout_prototype={layoutElements:null,_padding:null,_gap:null,padding:null,gap:null,area:null,addElement:function(element,constraint){if("[object Array]"===Object.prototype.toString.call(element))for(var i=0;i<element.length;i++)this.__addElement(element[i],constraint);else this.__addElement(element,constraint)},__addElement:function(element){this.layoutElements.push(element)},getPreferredLayoutSize:function(x,y,w,h){return this.padding=calculatePadding(this._padding,w,h),this.gap=calculateGap(this._gap,w,h),{width:0,height:0}},setSize:function(w,h){this.area.width=w,this.area.height=h},doLayout:function(x,y,w,h){this.area.setBounds(x,y,w,h),this.padding=calculatePadding(this._padding,w,h),this.gap=calculateGap(this._gap,w,h)}};GS.Object.extend(Layout,__Layout_prototype),StackLayout=function(padding,gap){return StackLayout._superclass.constructor.call(this,padding,gap),this},__StackLayout_prototype={doLayout:function(x,y,w,h){StackLayout._superclass.doLayout.call(this,x,y,w,h);for(var padding=this.padding,i=0;i<this.layoutElements.length;i++)this.layoutElements[i].doLayout(x+padding.left,y+padding.top,w-padding.left-padding.right,h-padding.top-padding.bottom)},getPreferredLayoutSize:function(x,y,w,h){return StackLayout._superclass.getPreferredLayoutSize.call(this,x,y,w,h),{width:w,height:h}}},Layout.extend(StackLayout,__StackLayout_prototype),BorderLayout=function(padding,gap){return BorderLayout._superclass.constructor.call(this,padding,gap),this},__BorderLayout_prototype={top:null,bottom:null,left:null,right:null,center:null,__addElement:function(element,constraint){"undefined"!=typeof this[constraint]?this[constraint]=element:this.center=element},getPreferredLayoutSize:function(x,y,w,h){BorderLayout._superclass.getPreferredLayoutSize.call(this,x,y,w,h);var c,d,dim={width:0,height:0};return null!==(c=this.left)&&(d=c.getPreferredLayoutSize(),dim.width+=d.width+this.gap.h,dim.height=Math.max(d.height,dim.height)),null!==(c=this.right)&&(d=c.getPreferredLayoutSize(),dim.width+=d.width+this.gap.h,dim.height=Math.max(d.height,dim.height)),null!==(c=this.center)&&(d=c.getPreferredLayoutSize(),dim.width+=d.width,dim.height=Math.max(d.height,dim.height)),null!==(c=this.top)&&(d=c.getPreferredLayoutSize(),dim.width=Math.max(d.width,dim.width),dim.height+=d.height+this.gap.v),null!==(c=this.bottom)&&(d=c.getPreferredLayoutSize(),dim.width=Math.max(d.width,dim.width),dim.height+=d.height+this.gap.v),dim.width+=this.padding.left+this.padding.right,dim.height+=this.padding.top+this.padding.bottom,dim},doLayout:function(x,y,w,h){BorderLayout._superclass.doLayout.call(this,x,y,w,h);var d,top=this.area.y+this.padding.top,left=this.area.x+this.padding.left,bottom=this.area.y1-this.padding.bottom,right=this.area.x1-this.padding.right;this.top&&(this.top.setSize(right-left,this.top.area.height),d=this.top.getPreferredLayoutSize(),this.top.doLayout(left,top,right-left,d.height),top+=d.height+this.gap.v),this.bottom&&(this.bottom.setSize(right-left,this.bottom.area.height),d=this.bottom.getPreferredLayoutSize(),this.bottom.doLayout(left,bottom-d.height,right-left,d.height),bottom-=d.height+this.gap.v),this.right&&(this.right.setSize(this.right.area.width,bottom-top),d=this.right.getPreferredLayoutSize(),this.right.doLayout(right-d.width,top,d.width,bottom-top),right-=d.width+this.gap.h),this.left&&(this.left.setSize(this.left.area.width,bottom-top),d=this.left.getPreferredLayoutSize(),this.left.doLayout(left,top,d.width,bottom-top),left+=d.width+this.gap.h),this.center&&this.center.doLayout(left,top,right-left,bottom-top),this.valid=!0}},Layout.extend(BorderLayout,__BorderLayout_prototype),GridLayout=function(padding,gap){return GridLayout._superclass.constructor.call(this,padding,gap),this},__GridLayout_prototype={numElements:0,rows:0,columns:0,setOrganization:function(num,org){return this.numElements=0|num,"rows"===org?this.rows=0|this.numElements:this.columns=0|this.numElements,this},getPreferredLayoutSize:function(_x,_y,_w,_h){GridLayout._superclass.getPreferredLayoutSize.call(this,_x,_y,_w,_h);var i,nrows=this.rows,ncols=this.columns,nactors=this.layoutElements.length,w=0,h=0;for(nrows>0?ncols=Math.floor((nactors+nrows-1)/nrows):nrows=Math.floor((nactors+ncols-1)/ncols),i=0;nactors>i;i+=1){var actor=this.layoutElements[i];if(actor){var d=actor.getPreferredLayoutSize();w<d.width&&(w=d.width),h<d.height&&(h=d.height)}}return{width:this.padding.left+this.padding.right+ncols*w+(ncols-1)*this.gap.h,height:this.padding.top+this.padding.bottom+nrows*h+(nrows-1)*this.gap.v}},doLayout:function(_x,_y,_w,_h){GridLayout._superclass.doLayout.call(this,_x,_y,_w,_h);var nactors=this.layoutElements.length;if(0!==nactors.length){var nrows=this.rows,ncols=this.columns;nrows>0?ncols=Math.floor((nactors+nrows-1)/nrows):nrows=Math.floor((nactors+ncols-1)/ncols);for(var totalGapsWidth=(ncols-1)*this.gap.h,widthWOInsets=_w-(this.padding.left+this.padding.right),widthOnComponent=(widthWOInsets-totalGapsWidth)/ncols,extraWidthAvailable=(widthWOInsets-(widthOnComponent*ncols+totalGapsWidth))/2,totalGapsHeight=(nrows-1)*this.gap.v,heightWOInsets=_h-(this.padding.top+this.padding.bottom),heightOnComponent=(heightWOInsets-totalGapsHeight)/nrows,extraHeightAvailable=(heightWOInsets-(heightOnComponent*nrows+totalGapsHeight))/2,c=0,x=this.padding.left+extraWidthAvailable;ncols>c;c++,x+=widthOnComponent+this.gap.h)for(var r=0,y=this.padding.top+extraHeightAvailable;nrows>r;r++,y+=heightOnComponent+this.gap.v){var i=r*ncols+c;if(i<this.layoutElements.length){var child=this.layoutElements[i];null!==child&&child.doLayout(_x+x,_y+y,widthOnComponent,heightOnComponent)}}}}},Layout.extend(GridLayout,__GridLayout_prototype),GS.Layout.LayoutManager={root:null,layoutElements:{},layout:null,doLayout:function(model,layout,w,h,scene){this.layoutElements={};for(var i=0;i<model.length;i++)this.layoutElements[model[i]]=new LayoutElement(model[i]);this.layout=layout,this.root=this.__parse(this.layout),this.__doLayout(0,0,w,h),this.__setLayout(scene)},__setLayout:function(container){if(container)for(var id in this.layoutElements){var area=GS.Layout.LayoutManager.getRectangleForId(id),actor=container.findActorById(id);if(actor){var p0=new GS.Point(area.x,area.y),p1=new GS.Point(area.x+area.width,area.y+area.height);container&&(container.modelToModel(p0,actor._parent),container.modelToModel(p1,actor._parent)),actor.setBounds(p0.x+(p1.x-p0.x)*actor._positionAnchorX,p0.y+(p1.y-p0.y)*actor._positionAnchorY,p1.x-p0.x,p1.y-p0.y)}else console.log("Laying out '"+id+" and is not found.")}},getRectangleForId:function(id){var el=this.layoutElements[id];return el?el.area:new GS.Math.Rectangle},__doLayout:function(x,y,w,h){this.root&&this.root.doLayout(x,y,w,h)},__parse:function(layout){if(layout.type){if(0===layout.type.indexOf("border"))return this.__parseBorder(layout);if(0===layout.type.indexOf("grid"))return this.__parseGrid(layout);if(0===layout.type.indexOf("stack"))return this.__parseStack(layout);throw new Error("Unkonwn layout type: '"+layout.type+"'")}if(layout.elements)return this.__parseLayoutElement(layout.elements);throw new Error("layout error: '"+layout+"'")},__parsePadding:function(padding){var rpadding={left:0,right:0,top:0,bottom:0};return padding&&(padding=Array.prototype.slice.call(padding),rpadding.left=padding.shift(),rpadding.top=padding.shift(),rpadding.right=padding.shift(),rpadding.bottom=padding.shift()),rpadding},__parseGap:function(gap){var _gap={h:0,v:0};return gap&&(gap=Array.prototype.slice.call(gap),_gap.h=gap.shift()||0,_gap.v=gap.shift()||0),_gap},__parseBorder:function(layout){var l=new BorderLayout(this.__parsePadding(layout.padding),this.__parseGap(layout.gap));return layout.top&&l.addElement(this.__parse(layout.top),"top"),layout.bottom&&l.addElement(this.__parse(layout.bottom),"bottom"),layout.left&&l.addElement(this.__parse(layout.left),"left"),layout.right&&l.addElement(this.__parse(layout.right),"right"),layout.center&&l.addElement(this.__parse(layout.center),"center"),l},__parseLayoutElements:function(elements,l){if("[object Array]"===Object.prototype.toString.call(elements))for(var i=0;i<elements.length;i++)"string"==typeof elements[i]?l.addElement(this.__parseLayoutElement(elements[i])):l.addElement(this.__parse(elements[i]),null);else l.addElement(this.__parseLayoutElement(elements))},__parseStack:function(layout){var l=new StackLayout(this.__parsePadding(layout.padding),this.__parseGap(layout.gap));return this.__parseLayoutElements(layout.elements,l),l},__parseGrid:function(layout){var l=new GridLayout(this.__parsePadding(layout.padding),this.__parseGap(layout.gap)),description=layout.type.split(" "),len=description[1]||0,rows_or_columns=description[2];return l.setOrganization(len,rows_or_columns),this.__parseLayoutElements(layout.elements,l),l},__applyStyle:function(le){var st,elementStyle="";if(this.layout.style){var elementId=le.id;for(st in this.layout.style)if(st===elementId){elementStyle=JSON.parse(JSON.stringify(this.layout.style[st]));break}for(st in this.layout.style)if((-1!==st.indexOf("*")||-1!==st.indexOf("[")&&-1!==st.indexOf("]"))&&elementId.match(new RegExp(st))){var ps=JSON.parse(JSON.stringify(this.layout.style[st]));elementStyle=ps}}for(var pr in elementStyle)"preferredWidth"===pr?le.setPreferredWidth(elementStyle[pr]):"preferredHeight"===pr?le.setPreferredHeight(elementStyle[pr]):"minimumWidth"===pr?le.setMinimumWidth(elementStyle[pr]):"minimumHeight"===pr&&le.setMinimumHeight(elementStyle[pr])},__parseLayoutElement:function(elements){elements=elements.split(" ");for(var ret=[],i=0;i<elements.length;i++){var element=elements[i];if(""!==element){var le=null;if(-1!==element.indexOf("*")||-1!==element.indexOf("[")&&-1!==element.indexOf("]")){var exp=new RegExp(element);for(var elementId in this.layoutElements)this.layoutElements.hasOwnProperty(elementId)&&elementId.match(exp)&&(le=this.layoutElements[elementId],this.__applyStyle(le),ret.push(le))}else if(this.layoutElements.hasOwnProperty(element))le=this.layoutElements[element],this.__applyStyle(le),ret.push(le);else{if("Filler"!==element)throw new Error("Unknown id to layout: "+element);ret.push(null)}le&&le.preferredWidth&&le.setPreferredWidth(le.preferredWidth),le&&le.preferredHeight&&le.setPreferredHeight(le.preferredHeight)}}return ret}}}(),function(){GS.Game=function(w,h,unitsInfo,canvas){return this._textureManager=new GS.Game.TextureManager(this),this._unitsInfo=unitsInfo||{},this._renderer=GS.RendererUtils.autoDetectRenderer(w,h,this._unitsInfo,canvas),this._unitsMatrix=this._renderer.getUnitsMatrix(),this._inputManager=new GS.InputManager(this).enableDefaults(this._renderer),this._sceneManager=new GS.Game.SceneManager(this),this._fontManager=new GS.Plugin.FontManager,this._soundManager=null,this._startTime=-1,this._rafId=-1,this};var __GS_GamePrototype={getRendererType:function(){return this._renderer.getContext().type},getCurrentScene:function(){return this._sceneManager.getCurrentScene()},getUnitsMatrix:function(){return this._unitsMatrix},createScene:function(id){return this._sceneManager.createScene(id)},addScene:function(scene){this._sceneManager.addScene(scene)},loop:function(){-1===this._startTime&&(this._startTime=performance.now(),this._rafId=window.requestAnimationFrame(this.__tick.bind(this),null))},endLoop:function(){this._startTime=-1,window.cancelRequestAnimationFrame(this._rafId)},__tick:function(){this.__renderFrame(),this._rafId=window.requestAnimationFrame(this.__tick.bind(this),null)},__renderFrame:function(){var now=performance.now(),elapsed=now-this._startTime;this._startTime=now,this._renderer.startRender(),this._sceneManager.render(this._renderer,elapsed),this._renderer.getContext().flush()},addImage:function(img,id){this._textureManager.addImage(img,id)},addTexturePack:function(tp){this._textureManager.addTexturePack(tp)},addSpriteImage:function(si){this._textureManager.addSpriteImage(si)},getSpriteImageDataById:function(id){return this._textureManager.getSpriteImageDataById(id)},createCursor:function(up,down,left,right){return this._inputManager.enableKeyboard(),"undefined"==typeof up&&(up="up"),"undefined"==typeof down&&(down="down"),"undefined"==typeof left&&(left="left"),"undefined"==typeof right&&(right="right"),this._inputManager._keyboard.createCursorKeys(up,down,left,right)},showSceneById:function(id){this._sceneManager.showSceneById(id)},tweenToSceneById:function(sceneId,tweens){this._sceneManager.tweenToSceneById(sceneId,tweens)},getSizeInPixels:function(){return this._renderer.getSizeInPixels()},getSize:function(){return this._renderer.getSize()},loadTextures:function(_assets,base,onload,onprogress,onerror){this._textureManager.loadTextures(_assets,base,onload,onprogress,onerror)},loadTexturePackerAtlas:function(image,json,onload,onprogress,onerror){this._textureManager.loadTexturePackerAtlas(image,json,onload,onprogress,onerror)},createWithRowsAndColumnsById:function(id,rows,columns){return this._textureManager.createWithRowsAndColumnsById(id,rows,columns),this},createWithTexturePackerJSONById:function(id,json){this._textureManager.createWithTexturePackerJSONById(id,json)},tweenTarget:function(t){return this.getCurrentScene().getTweenManager().tweenTarget(t)},addSprite:function(x,y,imageId,sequence){return this._sceneManager.addSprite(x,y,this.getSpriteImageDataById(imageId),sequence)},addContainer:function(x,y,w,h){return this._sceneManager.addContainer(x,y,w,h)},addButton:function(callback,_images,is9patch){var images={};for(var image in _images)_images.hasOwnProperty(image)&&(images[image]=this._textureManager.getSpriteImageDataById(_images[image]));return this._sceneManager.addButton(callback,images,is9patch)},addActor:function(x,y,w,h){return this._sceneManager.addActor(x,y,w,h)},addGlypthDesignerFont:function(name,spriteImageId,fontdef){return this._fontManager.addGlypthDesignerFont(name,this._textureManager.getSpriteImageDataById(spriteImageId),fontdef)},removeSceneById:function(id){this._sceneManager.removeSceneById(id)},addSpritedFont:function(name,chars,_font,fontsize,fontstyle,fillstyle,strokestyle,strokesize,padding){var font=this._fontManager.addSystemFont(name,chars,_font,fontsize,fontstyle,fillstyle,strokestyle,strokesize,padding,this._textureManager);return"webgl"===this._renderer.getContext().type&&font._spriteImageData._owner.setAsTexture(this._renderer.getWebGLCanvasContext()),font},loadGlypthDesignerFont:function(){},getSpriteFont:function(name){return this._fontManager.getFont(name)},getRenderingContext:function(){return this._renderer.getContext()},enableScreenOrientationChange:function(){return window.addEventListener("orientationchange",this.__orientationChange.bind(this),!1),window.addEventListener("resize",this.__resize.bind(this),!1),this.__resize(),this},__orientationChange:function(){this._renderer.orientationChange(),this._sceneManager.orientationChange(),this._unitsMatrix=this._renderer.getUnitsMatrix()},__resize:function(){var screenLandscape=window.innerWidth>window.innerHeight,size=this.getSize(),unitsLandscape=size.width>size.height;screenLandscape!==unitsLandscape&&this.__orientationChange(),this._renderer.scaleToScreen()}};GS.Object.extend(GS.Game,__GS_GamePrototype)}(),function(){var __defaultTweens;GS.Game.SceneManager=function(game){this._game=game,this._scenes=[],this._currentScene=null,this._tweeningScene=null,this._tweenManager=new GS.TweenManager,this._unitsMatrix=game.getUnitsMatrix();var size=game.getSize(),tme=new GS.TweenManager;tme.tweenTarget(null).tweenProperty().from({x:-size.width,y:0}).to({x:0,y:0},0,2e3,GS.Interpolator.ExponentialOutInterpolator(3));var tmx=new GS.TweenManager;tmx.tweenTarget(null).tweenProperty().from({x:0,y:0}).to({x:size.width,y:0},0,2e3,GS.Interpolator.ExponentialOutInterpolator(3)),__defaultTweens={enter:tme,exit:tmx}},GS.Game.SceneManager.prototype={createScene:function(id){var scene=new GS.Scene,size=this._game.getSize();return scene.setBounds(0,0,size.width,size.height),id&&(scene._id=id),this.addScene(scene),this._currentScene=scene,this._game._inputManager.filterInput(scene),scene},addScene:function(scene,id){return!scene._id&&id&&(scene._id=id),this._scenes.push(scene),this._currentScene||(this._currentScene=scene,this._game._inputManager.filterInput(scene)),scene.setUnitsMatrix(this._unitsMatrix),this},findSceneById:function(id){for(var i=0;i<this._scenes.length;i++)if(this._scenes[i]._id===id)return this._scenes[i];return null},showSceneById:function(id){var scene=this.findSceneById(id);scene&&(this._currentScene=scene,this._game._inputManager.filterInput(scene))},getCurrentScene:function(){return this._currentScene||this.createScene(),this._currentScene},addActor:function(x,y,w,h){return this._currentScene.addActor(x,y,w,h)},render:function(renderer,elapsedTime){elapsedTime>500&&(elapsedTime=500),this._tweenManager.tick(elapsedTime),renderer.render(this._currentScene,elapsedTime),this._tweeningScene&&renderer.render(this._tweeningScene,0)},removeSceneById:function(id){for(var i=0;i<this._scenes.length;i++)if(this._scenes[i]._id===id)return void this._scenes.splice(i,1)},tweenToSceneById:function(sceneId,tweens){if(!this._tweeningScene){var currentScene=this.getCurrentScene(),tweenToScene=this.findSceneById(sceneId);if(tweenToScene&&currentScene!==tweenToScene){tweens?(tweens.enter||(tweens.enter=__defaultTweens.enter),tweens.exit||(tweens.exit=__defaultTweens.exit)):tweens=__defaultTweens;var me=this;currentScene.setPosition(0,0),currentScene.setRotation(0),currentScene.setScale(1,1),currentScene.setTransformationAnchor(.5,.5),currentScene.setPositionAnchor(0,0),this._tweeningScene=tweenToScene,this._tweeningScene.setPosition(0,0),this._tweeningScene.setRotation(0),this._tweeningScene.setScale(1,1),this._tweeningScene.setTransformationAnchor(.5,.5),this._tweeningScene.setPositionAnchor(0,0),tweens.enter&&(tweens.enter instanceof GS.TweenManager||(tweens.enter=tweens.enter._owner),tweens.enter.setTarget(this._tweeningScene),this._tweenManager.addTweenManager(tweens.enter)),tweens.exit&&(tweens.exit instanceof GS.TweenManager||(tweens.exit=tweens.exit._owner),tweens.exit.setTarget(currentScene),this._tweenManager.addTweenManager(tweens.exit));var bh=tweens.enter.getLastTween()._behavior,prevOnEnd=bh._onEnd;bh.onEnd(function(behavior,target){me._tweeningScene=null,me.showSceneById(sceneId),prevOnEnd&&prevOnEnd(behavior,target),behavior._onEnd=prevOnEnd})}}},orientationChange:function(){this._unitsMatrix=this._game.getUnitsMatrix();for(var size=this._game.getSize(),i=0;i<this._scenes.length;i++)this._scenes[i].setSize(size.width,size.height),this._scenes[i].onOrientationChange()},addSprite:function(x,y,image,sequence){return this.getCurrentScene().addSprite(x,y,image,sequence)
},addContainer:function(x,y,w,h){return this.getCurrentScene().addContainer(x,y,w,h)},addButton:function(callback,images,is9patch){return this.getCurrentScene().addButton(callback,images,is9patch)}}}(),function(){GS.Game.TextureManager=function(game){return this._game=game,this._spriteImages={},this},GS.Game.TextureManager.prototype={addImage:function(img,id){if(img instanceof HTMLCanvasElement||img instanceof Image||img instanceof HTMLImageElement){var si=new GS.SpriteImage(img);this.__addSpriteImageData(si._mainImageElement,id)}},addSpriteImage:function(si){var map=si.getImagesMap();for(var name in map)this.__addSpriteImageData(map[name],name)},addTexturePack:function(tp){for(var i=0;i<tp.getCacheSize();i++)this.addSpriteImage(tp.getSpriteImage(i))},__addSpriteImageData:function(sid,id){this._spriteImages[id]?console.log("Collision for image: '"+id+"'. Not Added"):("webgl"===this._game.getRendererType()&&-1===sid._owner._textureId&&sid._owner.setAsTexture(this._game._renderer.getWebGLCanvasContext()),this._spriteImages[id]=sid)},getSpriteImageDataById:function(id){return this._spriteImages[id]},createWithTexturePackerJSONById:function(id,json){var sid=this.getSpriteImageDataById(id);if(sid)for(var elements=sid.createWithTexturePackerJSON(json),i=0;i<elements.length;i++)this._spriteImages[elements[i]._id]=elements[i]},createWithRowsAndColumnsById:function(id,rows,columns){var sid=this.getSpriteImageDataById(id);if(sid){sid.createWithRowsAndColumns(rows,columns);for(var i=0;i<sid.getChildrenAsArray().length;i++)this._spriteImages[sid.getChildrenAsArray()[i]._id]=sid.getChildrenAsArray()[i]}},__setupAssetArrayAsAssetLoaderData:function(_assets){for(var assets=[],i=0;i<_assets.length;i++)assets.push({url:_assets[i]});return assets},__buildAssetLoaderGroupFromAssetsArray:function(_assets,base){var assets=this.__setupAssetArrayAsAssetLoaderData(_assets),group={};return base&&(group.base=base),group.assets=assets,group},loadTextures:function(_assets,base,onload,onprogress,onerror){var me=this,group=this.__buildAssetLoaderGroupFromAssetsArray(_assets,base),loader=new GS.Plugin.AssetLoader;loader.addGroup(group,"__main"),loader.load(function(assetLoader){for(var elements=assetLoader.getAllAssetsArray(),i=0;i<elements.length;i++)"image"===elements[i].type&&me.addSpriteImage(new GS.SpriteImage(elements[i].asset,elements[i].id));onload(loader)},function(ev){onprogress&&onprogress(ev)},function(ev){onerror&&onerror(ev)})},loadTexturePackerAtlas:function(image,json,onload,onprogress,onerror){var me=this,assets=[];GS.isArray(image)?image.map(function(e){assets.push(e)}):assets.push(image),assets.push(json);var group=this.__buildAssetLoaderGroupFromAssetsArray(assets),loader=new GS.Plugin.AssetLoader;loader.addGroup(group,"__main"),loader.load(function(assetLoader){var elements=assetLoader.getAllAssetsArray(),si=new GS.SpriteImage(elements[0].asset);si.createWithTexturePackerJSON(elements[1].asset),me.addSpriteImage(si),onload()},function(ev){onprogress&&onprogress(ev)},function(ev){onerror&&onerror(ev)})}}}(),function(){var fontSizeCalcCanvas=document.createElement("canvas"),fontSizeCalcCanvasCtx=fontSizeCalcCanvas.getContext("2d");GS.Widget.TextActor=function(fontManager){return GS.Widget.TextActor._superclass.constructor.call(this),this._fontManager=fontManager,this._fontDescription="10px sans-serif",this._text="",this._currentSpriteFont=null,this._textBaseline="middle",this._textAlign="center",this._strokeWidth=1,this._textFillStyle=null,this._textStrokeStyle=null,this};var __GS_Widget_TextActorProrotype={setTextAlign:function(align){return this._textAlign=align,this},setTextBaseline:function(baseline){return this._textBaseline=baseline,this},setFont:function(fontDesc){return this._fontDescription=fontDesc,this.setText(this._text,!1),this},setText:function(text,noCalcultateBounds){return this._text=text,noCalcultateBounds||this.__calculateBounds(),this},__calculateBounds:function(){var fontComponents=this._fontDescription.trim().split(" "),fontHeight=fontComponents[0].match(/\d+/)[0]>>0,fontName=fontComponents[1],fontWidth=0;if(this._fontManager){var font=this._fontManager.getFont(fontName);font&&(this._currentSpriteFont=font,fontHeight=this._currentSpriteFont.getHeight(),fontWidth=this._currentSpriteFont.stringWidth(this._text))}else{fontSizeCalcCanvasCtx.font=this._fontDescription;var mt=fontSizeCalcCanvasCtx.measureText(this._text);fontWidth=mt.width,mt.fontBoundingBoxAscent&&(fontHeight=mt.fontBoundingBoxDescent+mt.fontBoundingBoxAscent)}this._width=fontWidth,this._height=fontHeight},paint:function(ctx){""!==this._text&&(this._currentSpriteFont?this._currentSpriteFont.fillText(ctx,this._text,0,0):(ctx.textBaseline="top",ctx.textAlign="left",ctx.font=this._fontDescription,null!==this._textFillStyle&&(ctx.fillStyle=this._textFillStyle,ctx.fillText(this._text,this._width*this._positionAnchorX,this._height*this._positionAnchorY)),null!==this._textStrokeStyle&&(ctx.lineWidth=this._strokeWidth,ctx.strokeStyle=this._textStrokeStyle,ctx.strokeText(this._text,this._width*this._positionAnchorX,this._height*this._positionAnchorY))))},setTextFillStyle:function(fs){return this._textFillStyle=fs,this},setTextStrokeStyle:function(fs){return this._textStrokeStyle=fs,this},setStrokeWidth:function(lw){this._strokeWidth=lw},set:function(obj){return this.setFont(obj.font||this._fontDescription),this.setText(obj.text||""),obj.fill&&this.setTextFillStyle(obj.fill),obj.stroke&&this.setTextStrokeStyle(obj.stroke),obj.strokeWidth&&this.setStrokeWidth(obj.strokeWidth),obj.align&&this.setTextAlign(obj.align),obj.baseline&&this.setTextBaseline(obj.baseline),this}};GS.Actor.extend(GS.Widget.TextActor,__GS_Widget_TextActorProrotype)}();
//# sourceMappingURL=all.min.js.map